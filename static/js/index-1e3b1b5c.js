var e=Object.defineProperty,t=(t,r,i)=>(((t,r,i)=>{r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[r]=i})(t,"symbol"!=typeof r?r+"":r,i),i);import{M as r,b as i,T as s}from"./map-base-54533b47.js";import{a}from"./axios-88d2cb22.js";import{R as o}from"./index-37de66d9.js";class n{constructor(e){t(this,"viewer"),t(this,"dataSource"),t(this,"options"),this.viewer=e,this.dataSource=new Map,this.options=new Map}async add(e){const t=e.feature,r=await Cesium.GeoJsonDataSource.load(e.url,{stroke:t.stroke||Cesium.Color.HOTPINK,strokeWidth:t.strokeWidth||3,fill:Cesium.Color.fromCssColorString(t.fill).withAlpha(.6)||Cesium.Color.PINK.withAlpha(.6),markerColor:Cesium.Color.fromCssColorString(t.markerColor)||Cesium.Color.PINK,clampToGround:t.clampToGround||!0});this.viewer.dataSources.add(r),this.dataSource.set(e.id,r),this.options.set(e.id,e),this.viewer.flyTo(r)}getLayerById(e){return this.dataSource.get(e)}delete(e){const t=this.getLayerById(e);t&&(this.viewer.dataSources.remove(t),this.options.delete(e))}setVisibleById(e,t){const r=this.getLayerById(e);r&&(r.show=t)}flyTo(e){const t=this.getLayerById(e);t&&this.viewer.flyTo(t)}getLoadedSource(){return{type:r.FEATURE,value:Object.fromEntries(this.options)}}}class l{constructor(e){t(this,"viewer"),t(this,"dataSource"),t(this,"options"),this.viewer=e,this.dataSource=new Map,this.options=new Map}async add(e){try{const{longitude:t,latitude:r,altitude:i}=e.position,s=Cesium.Transforms.eastNorthUpToFixedFrame(Cesium.Cartesian3.fromDegrees(t,r,i)),a=await Cesium.Model.fromGltfAsync({url:e.url,modelMatrix:s,scale:e.scale||100,heightReference:e.heightReference});this.viewer.scene.primitives.add(a),this.dataSource.set(e.id,a),this.options.set(e.id,e),a.readyEvent.addEventListener((()=>this.flyTo(e.id)))}catch(t){}}getModelById(e){return this.dataSource.get(e)}delete(e){const t=this.getModelById(e);t&&(this.viewer.scene.primitives.remove(t),this.options.delete(e))}setVisibleById(e,t){const r=this.getModelById(e);r&&(r.show=t)}flyTo(e){const t=this.getModelById(e);if(!t)return;const r=t.boundingSphere;this.viewer.camera.flyToBoundingSphere(r)}getLoadedSource(){return{type:r.GLTF_MODEL,value:Object.fromEntries(this.options)}}}const d={arcGisMapServer:function(e){return Cesium.ArcGisMapServerImageryProvider.fromUrl(e,{enablePickFeatures:!1})},bingMap:function(e,t){return Cesium.BingMapsImageryProvider.fromUrl(e,{key:t.key,mapStyle:Cesium.BingMapsStyle.AERIAL})},tileMapServer:function(e){return Cesium.TileMapServiceImageryProvider.fromUrl(e,{})},mapBox:function(e,t){const r=Cesium.defaultValue(t.mapId,"mapbox.satellite");return new Cesium.MapboxImageryProvider({mapId:r,accessToken:i})},singleTile:function(e,t){return t.rectangle=Cesium.defaultValue(t.rectangle,Cesium.Rectangle.fromDegrees(-180,-90,180,90)),Cesium.SingleTileImageryProvider.fromUrl(e,{rectangle:t.rectangle})},urlTemplate:function(e){return new Cesium.UrlTemplateImageryProvider({url:e})},webMapService:function(e,t){return new Cesium.WebMapServiceImageryProvider({url:e,layers:t.laers,parameters:t.parameters})},webMapTileService:function(e,t){return new Cesium.WebMapTileServiceImageryProvider({url:e,layer:t.layer,style:t.style,tileMatrixSetID:t.tileMatrixSetID,format:t.format,maximumLevel:t.maximumLevel})}};class c{constructor(e){t(this,"viewer"),t(this,"dataSource"),t(this,"options"),this.viewer=e,this.dataSource=new Map,this.options=new Map}async add(e){const t=e.imageryType,r=d[t],i=await r(e.url,e),s=new Cesium.ImageryLayer(i,{});this.viewer.imageryLayers.add(s),this.dataSource.set(e.id,s),this.options.set(e.id,e),this.viewer.flyTo(s)}getLayerById(e){return this.dataSource.get(e)}delete(e){const t=this.getLayerById(e);t&&(this.viewer.imageryLayers.remove(t),this.options.delete(e),window.$message.success("影像服务删除成功！"))}setVisibleById(e,t){const r=this.getLayerById(e);r&&(r.show=t)}flyTo(e){const t=this.getLayerById(e);t&&this.viewer.flyTo(t)}getLoadedSource(){return{type:r.IMAGE_SERVICE,value:Object.fromEntries(this.options)}}}class u{constructor(e){t(this,"viewer"),t(this,"dataSource"),t(this,"options"),this.viewer=e,this.dataSource=new Map,this.options=new Map}async add(e){const t=await this.getFeatures(e.url),r=this.createCollectioon(t,e);this.viewer.scene.primitives.add(r),this.dataSource.set(e.id,r),this.options.set(e.id,e),this.flyTo(e.id)}async getFeatures(e){var t;try{const r=await a.get(e);return(null==(t=null==r?void 0:r.data)?void 0:t.features)||[]}catch(r){}}createCollectioon(e,t){const r=new Cesium.BillboardCollection({scene:this.viewer.scene});return e.forEach((async e=>{const i=e.geometry.coordinates,s=await o.imageOverlayText(t.special.icon,e.properties[t.special.label]);r.add({position:Cesium.Cartesian3.fromDegrees(...i),image:s,scale:.6,width:t.special.size,disableDepthTestDistance:Number.POSITIVE_INFINITY,heightReference:Cesium.HeightReference.RELATIVE_TO_GROUND})})),r}getLayerById(e){return this.dataSource.get(e)}delete(e){const t=this.getLayerById(e);t&&(this.viewer.scene.primitives.remove(t),this.options.delete(e))}setVisibleById(e,t){const r=this.getLayerById(e);r&&(r.show=t)}flyTo(e){const t=this.getLayerById(e);if(!t)return;const r=t._billboards.map((e=>e.position)),i=Cesium.Rectangle.fromCartesianArray(r);this.viewer.camera.flyTo({destination:i})}getLoadedSource(){return{type:r.SPECIAL_SUBJECT,value:Object.fromEntries(this.options)}}}function h(){return new Cesium.EllipsoidTerrainProvider}class m{constructor(e){t(this,"viewer"),t(this,"terrainProvider"),t(this,"visible"),t(this,"options"),this.viewer=e,this.terrainProvider=h(),this.visible=!1,this.options=new Map}async add(e={}){const t=Cesium.defaultValue(e.terrainType,s.ellipsoidTerrain);t===s.ellipsoidTerrain?this.terrainProvider=h():t===s.cesiumTerrain?this.terrainProvider=await async function(e,t){return await Cesium.CesiumTerrainProvider.fromUrl(e,{requestVertexNormals:t.requestVertexNormals})}(e.url,e):t===s.worldTerrain&&(this.terrainProvider=await async function(e){return await Cesium.createWorldTerrainAsync({requestVertexNormals:null==e?void 0:e.requestVertexNormals,requestWaterMask:null==e?void 0:e.requestWaterMask})}(e)),this.viewer.terrainProvider=this.terrainProvider,this.options.set(e.id,e)}show(e){if(e!==this.visible){const t=new Cesium.EllipsoidTerrainProvider;this.viewer.terrainProvider=e?this.terrainProvider:t,this.visible=e}}delete(){const e=new Cesium.EllipsoidTerrainProvider;this.viewer.terrainProvider=e}flyTo(){}getLoadedSource(){return{type:r.TERRAIN_SERVICE,value:Object.fromEntries(this.options)}}}class y{constructor(e){t(this,"viewer"),t(this,"dataSource"),t(this,"options"),this.viewer=e,this.dataSource=new Map,this.options=new Map}async add(e){const t=await Cesium.Cesium3DTileset.fromUrl(e.url,{cacheBytes:e.cacheBytes||128,maximumScreenSpaceError:e.maximumScreenSpaceError||64});this.viewer.scene.primitives.add(t),this.dataSource.set(e.id,t),this.options.set(e.id,e),this.viewer.flyTo(t)}getTilesetById(e){return this.dataSource.get(e)}delete(e){const t=this.getTilesetById(e);t&&(this.viewer.scene.primitives.remove(t),this.options.delete(e))}setVisibleById(e,t){const r=this.getTilesetById(e);r&&(r.show=t)}flyTo(e){const t=this.getTilesetById(e);t&&this.viewer.flyTo(t)}getLoadedSource(){return{type:r.TILE_SET,value:Object.fromEntries(this.options)}}}class p{constructor(e){t(this,"imageryLayerManager"),t(this,"tilesetLayerManager"),t(this,"gltfModelManager"),t(this,"terrainManager"),t(this,"featureLayerManager"),t(this,"specialLayerManager"),this.imageryLayerManager=new c(e),this.tilesetLayerManager=new y(e),this.gltfModelManager=new l(e),this.terrainManager=new m(e),this.featureLayerManager=new n(e),this.specialLayerManager=new u(e)}get typeManager(){return{[r.IMAGE_SERVICE]:this.imageryLayerManager,[r.TERRAIN_SERVICE]:this.terrainManager,[r.TILE_SET]:this.tilesetLayerManager,[r.GLTF_MODEL]:this.gltfModelManager,[r.FEATURE]:this.featureLayerManager,[r.SPECIAL_SUBJECT]:this.specialLayerManager}}addSource(e,t){this.typeManager[e].add(t)}deleteSource(e,t){this.typeManager[t].delete(e)}flyTo(e,t){this.typeManager[t].flyTo(e)}getTypeDataSource(){return Object.keys(this.typeManager).map((e=>this.typeManager[e].getLoadedSource()))}}export{p as C};
//# sourceMappingURL=index-1e3b1b5c.js.map
