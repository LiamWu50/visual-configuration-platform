var e=Object.defineProperty,t=(t,n,o)=>(((t,n,o)=>{n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o})(t,"symbol"!=typeof n?n+"":n,o),o);import{a7 as n,k as o,d as l,m as r,B as i,Q as a,z as s,s as c,v as u,C as d,y as h,a8 as p,a9 as v,D as f,aa as m,ab as y,ac as g,H as w,w as b,I as S,ad as A,ae as C,af as x,x as R,F as N,ag as E,ah as B,ai as O,aj as k,ak as L,R as D,a3 as I,P as M,h as P,al as X}from"./index-108e70ad.js";import{u as Y}from"./index-016f87a7.js";import{l as j}from"./lodash-701d4bf6.js";const T=n("areaSelect",(()=>{const e=o(null),t=o([]),n=o(!1);return{groupStyle:e,selectedPrimitives:t,areaSelectVisible:n,clearPrimitives:()=>{t.value=[]},setAreaSelectOptions:(n,o)=>{e.value=n,t.value=o},setAreaSelectVisible:e=>{n.value=e}}}));function Q(e){return 100*e+"%"}const U=["fontSize","width","height","top","left","borderWidth","letterSpacing","borderRadius"];function F(e){return{top:e.top,left:e.left,right:e.left+e.width,bottom:e.top+e.height}}function G(e,t=[]){const n={};return Object.keys(e).forEach((o=>{t.includes(o)||e[o]&&(n[o]=e[o],U.includes(o)&&(n[o]+="px"))})),n}function V(e){const t={};for(const[n,o]of Object.entries(e))o&&(t[n]=`${o}px`);return t}function _(e,t,n){const o=document.getElementById(`primitive${e.id}`).getBoundingClientRect(),l=o.left-t.left+o.width/2,r=o.top-t.top+o.height/2;e.style.width=parseFloat(e.groupStyle.width)/100*n.width,e.style.height=parseFloat(e.groupStyle.height)/100*n.height,e.style.left=l-e.style.width/2,e.style.top=r-e.style.height/2,e.groupStyle={}}const q="_areaSelect_1o3j5_1",K=l({name:"AreaSelect",props:{options:{type:Object,default:()=>{}}},setup:e=>({style:r((()=>({left:e.options.start.x+"px",top:e.options.start.y+"px",width:e.options.width+"px",height:e.options.height+"px"})))}),render(){return i("div",{style:this.style,class:q},null)}});const W=new class{constructor(){t(this,"events",{})}on(e,t){this.events[e]||(this.events[e]=[]),this.events[e].includes(t)||this.events[e].push(t)}off(e,t){const n=this.events[e];n&&(this.events[e]=n.filter((e=>e!==t)))}emit(e,t){const n=this.events[e];if(n&&n.length>0)for(const o of n)o(t)}once(e,t){const n=o=>{t(o),this.off(e,n)};this.on(e,n)}},z="_markLine_18mj9_1",H="_line_18mj9_5",Z="_xline_18mj9_11",J="_yline_18mj9_16",$=l({name:"AuxiliaryLine",setup(){const e=Y(),t=o([]),n=["xt","xc","xb","yl","yc","yr"],l=o(3),r=a({xt:!1,xc:!1,xb:!1,yl:!1,yc:!1,yr:!1}),d=e=>{t.value.push(e)},h=()=>{Object.keys(r).forEach((e=>{r[e]=!1}))},p=(n,o)=>{const{primitives:l}=e,r=e.curPrimitive;if(!r)return;const{top:i,left:a,right:s,bottom:c}=F(r.style),u=(s-a)/2,d=(c-i)/2;h(),l.forEach((e=>{if(e==r)return;const l=F(e.style),{top:h,left:p,bottom:m,right:y}=l,g=(y-p)/2,w=(m-h)/2,b={top:[{isNearly:f(i,h),lineNode:t.value[0],line:"xt",dragShift:h,lineShift:h},{isNearly:f(c,h),lineNode:t.value[0],line:"xt",dragShift:h-(c-i||0),lineShift:h},{isNearly:f((i||0)+d,h+w),lineNode:t.value[1],line:"xc",dragShift:h+w-d,lineShift:h+w},{isNearly:f(i,m),lineNode:t.value[2],line:"xb",dragShift:m,lineShift:m},{isNearly:f(c,m),lineNode:t.value[2],line:"xb",dragShift:m-(c-i||0),lineShift:m}],left:[{isNearly:f(a,p),lineNode:t.value[3],line:"yl",dragShift:p,lineShift:p},{isNearly:f(s,p),lineNode:t.value[3],line:"yl",dragShift:p-(s-a||0),lineShift:p},{isNearly:f((a||0)+u,p+g),lineNode:t.value[4],line:"yc",dragShift:p+g-u,lineShift:p+g},{isNearly:f(a,y),lineNode:t.value[5],line:"yr",dragShift:y,lineShift:y},{isNearly:f(s,y),lineNode:t.value[5],line:"yr",dragShift:y-(s-a||0),lineShift:y}]},S=[];Object.keys(b).forEach((e=>{b[e].forEach((t=>{t.isNearly&&(r.updateStyleByKey(e,t.dragShift),t.lineNode.style[e]=`${t.lineShift}px`,S.push(t.line))}))})),v(S,n,o)}))},v=(e,t,n)=>{n?e.includes("yr")?r.yr=!0:e.includes("yc")?r.yc=!0:e.includes("yl")&&(r.yl=!0):e.includes("yl")?r.yl=!0:e.includes("yc")?r.yc=!0:e.includes("yr")&&(r.yr=!0),t?e.includes("xb")?r.xb=!0:e.includes("xc")?r.xc=!0:e.includes("xt")&&(r.xt=!0):e.includes("xt")?r.xt=!0:e.includes("xc")?r.xc=!0:e.includes("xb")&&(r.xb=!0)},f=(e,t)=>Math.abs(e-t)<=l.value;return s((()=>{W.on("move",(({isDownward:e,isRightward:t})=>{p(e,t)})),W.on("unmove",(()=>{h()})),p(!1,!1)})),()=>i("div",{class:z},[n.map((e=>c(i("div",{key:e,ref:d,class:`${H} ${e.includes("x")?Z:J}`},null),[[u,r[e]]])))])}});function ee(){const e=Y(),{editorScale:t}=d(e);return{transByCurScale:e=>100*e/t.value,transAbsByCurScale:e=>100*Math.abs(e)/t.value}}const te="_boundBox_112du_1",ne="_active_112du_8",oe="_point_112du_14";const le=l({name:"BoundBox",props:{primitive:{type:Object,default:()=>{}},pStyle:{type:Object,default:()=>{}},index:{required:!0,type:Number,default:0}},emits:["closeContextmenu"],setup(e,{slots:t,emit:n}){const l=Y(),a=T(),{curPrimitive:s}=d(l),{areaSelectVisible:c}=d(a),{transByCurScale:u}=ee(),{curRef:p,cursors:v,angleToCursor:f,drawPoints:m}={curRef:o(null),cursors:o({}),angleToCursor:[{start:338,end:23,cursor:"nw"},{start:23,end:68,cursor:"n"},{start:68,end:113,cursor:"ne"},{start:113,end:158,cursor:"e"},{start:158,end:203,cursor:"se"},{start:203,end:248,cursor:"s"},{start:248,end:293,cursor:"sw"},{start:293,end:338,cursor:"w"}],drawPoints:{lt:0,t:45,rt:90,r:135,rb:180,b:225,lb:270,l:315}},y=t=>{const{width:n=0,height:o=0}=e.pStyle,l=t.includes("t"),r=t.includes("b"),i=t.includes("l"),a=t.includes("r");let s=i?0:n,c=l?0:o;return!l&&!r||i||a?l||r||!i&&!a||(s=i?0:n,c=Math.floor(o/2)):(s=n/2,c=l?0:o),{marginLeft:"-4px",marginTop:"-4px",left:`${s}px`,top:`${c}px`,cursor:v.value[t]}},g=()=>{const e={};let t=-1;for(const n in m){const o=(m[n]+360)%360;for(let l=0;l<f.length;l++){t=(t+1)%f.length;const l=f[t];if(o<23||o>=338){e[n]="nw-resize";break}if(l.start<=o&&o<l.end){e[n]=l.cursor+"-resize";break}}}return e},w=t=>{if(t.stopPropagation(),t.preventDefault(),c.value)return;l.setClickPrimitiveStatus(!0),l.setCurPrimitive(e.primitive),v.value=g();const n=e.pStyle,o=t.clientY,r=t.clientX,i=n.top||0,a=n.left||0,s=t=>{const n=t.clientX,l=t.clientY,s=u(t.clientY-o)+i,c=u(t.clientX-r)+a,d={top:j.ceil(s),left:j.ceil(c)};e.primitive.updateStyle(d);const h=l-o>0,p=n-r>0;W.emit("move",{isDownward:h,isRightward:p})},d=()=>{W.emit("unmove"),document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",d)};document.addEventListener("mousemove",s),document.addEventListener("mouseup",d)};h((()=>{s.value&&(v.value=g())}));const b=e=>{e.stopPropagation(),e.preventDefault(),n("closeContextmenu")},S=r((()=>{var t;return(null==(t=s.value)?void 0:t.id)===e.primitive.id})),A=()=>Object.keys(m).map((t=>i("div",{key:t,class:oe,style:y(t),onMousedown:n=>((t,n)=>{n.stopPropagation(),n.preventDefault();const{pStyle:o}=e,{height:l=0,width:r=0,top:i=0,left:a=0}=o,s=n.clientX,c=n.clientY,u=e=>{const n=e.clientX,u=e.clientY-c,d=n-s,h=/t/.test(t),p=/b/.test(t),v=/l/.test(t),f=/r/.test(t),m=l+(h?-u:p?u:0),y=r+(v?-d:f?d:0);Object.assign(o,{height:Math.max(m,0),width:Math.max(y,0),left:a+(v?d:0),top:i+(h?u:0)})},d=()=>{document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",d)};document.addEventListener("mousemove",u),document.addEventListener("mouseup",d)})(t,n)},null)));return()=>{var e;return i("div",{ref:p,class:[te,S.value&&ne],onClick:b,onMousedown:w},[S.value?A():null,null==(e=t.default)?void 0:e.call(t)])}}}),re="_contextmenu_1mk8d_1";function ie(){const e=Y(),t=T(),{curPrimitive:n}=d(e),{groupStyle:o,selectedPrimitives:l}=d(t);return{handleCompose:()=>{const n=[],r=l.value,i=document.querySelector("#editor").getBoundingClientRect();r.forEach((e=>{var t;if("Group"===e.cName){const o={...e.style};null==(t=e.childPrimitives)||t.forEach((e=>{_(e,i,o),n.push(e)}))}else n.push(e)}));const a=l.value,s=new p;s.childPrimitives=n,s.style={...o.value},function(e){var t;const n=e.style;null==(t=e.childPrimitives)||t.forEach((e=>{if(!Object.keys(e.groupStyle).length){const t={...e.style};e.groupStyle=G(t),e.groupStyle.left=Q((t.left-n.left)/n.width),e.groupStyle.top=Q((t.top-n.top)/n.height),e.groupStyle.width=Q(t.width/n.width),e.groupStyle.height=Q(t.height/n.height)}}))}(s),e.addPrimitive(s),e.setCurPrimitive(s),e.batchDeletePrimitive(a),t.setAreaSelectVisible(!1),t.clearPrimitives()},handleDecompose:()=>{var t,o;const l={...null==(t=n.value)?void 0:t.style},r=null==(o=n.value)?void 0:o.childPrimitives,i=document.querySelector("#editor"),a=null==i?void 0:i.getBoundingClientRect();e.deleteCurPrimitive(),r.forEach((t=>{_(t,a,l),e.addPrimitive(t)}))}}}const ae=l({name:"ContextMenu",setup(e,{expose:t}){const{menuState:n,operations:l}=(()=>{const e=a({top:o(0),left:o(0),copyData:o(null)}),t=Y(),{curPrimitive:n}=d(t),{handleCompose:l,handleDecompose:r}=ie();return{menuState:e,operations:{handleCopy:()=>{const t=j.cloneDeep(n.value);t.id=v.createId(),e.copyData=t,window.$message.success("复制成功！")},handlePaste:()=>{if(!e.copyData)return void window.$message.warning("请选择组件！");const n=e.copyData;n.style.top=e.top,n.style.left=e.left,t.addPrimitive(n)},handleClearCanvas:()=>{t.clear()},handelDelete:()=>{t.deleteCurPrimitive(),window.$message.success("删除成功！")},handleUp:()=>{t.upCurComponent()},handleDown:()=>{t.downCurComponent()},handleTop:()=>{t.moveCurPrimitiveByIndex(1)},handleBottom:()=>{t.moveCurPrimitiveByIndex(-1)},handleCreateGroup:()=>{l()},handleDeleteGroup:()=>{r()}}}})(),s=Y(),h=T(),{areaSelectVisible:p}=d(h),y=a({visible:o(!1),contextType:o(""),contextOptions:o([])}),g=()=>{s.setClickPrimitiveStatus(!0)},w=[{label:"复制",handler:l.handleCopy},{label:"粘贴",handler:l.handlePaste},{label:"删除",handler:l.handelDelete},{label:"置顶",handler:l.handleUp},{label:"置底",handler:l.handleDown},{label:"上移",handler:l.handleTop},{label:"下移",handler:l.handleBottom}],b=[{label:"组合",handler:l.handleCreateGroup},{label:"删除",handler:l.handleDeleteGroup}],S=[{label:"粘贴",handler:l.handlePaste},{label:"清空画布",handler:l.handleClearCanvas}],A=()=>{p.value?y.contextOptions=[...b]:"Editor"===y.contextType?y.contextOptions=[...S]:(y.contextOptions=[...w],"Group"===y.contextType&&y.contextOptions.unshift({label:"解除分组",handler:l.handleDeleteGroup}))},C=r((()=>({top:`${n.top}px`,left:`${n.left}px`})));return t({show:({top:e,left:t,contextType:o})=>{n.top=e,n.left=t,y.contextType=o,A(),y.visible=!0},close:()=>{y.visible=!1}}),()=>i(m,{to:"body"},{default:()=>[c(i("div",{class:re,style:C.value},[i("ul",{onMouseup:g,onMousedown:e=>e.stopPropagation()},[y.contextOptions.map((e=>i("li",{onClick:e.handler},[e.label,f(" "),e.disabled])))])]),[[u,y.visible]])]})}});var se;const ce="undefined"!=typeof window,ue=e=>"string"==typeof e,de=()=>{};function he(e){return"function"==typeof e?e():y(e)}function pe(e){var t;const n=he(e);return null!=(t=null==n?void 0:n.$el)?t:n}ce&&(null==(se=null==window?void 0:window.navigator)?void 0:se.userAgent)&&/iP(ad|hone|od)/.test(window.navigator.userAgent);const ve=ce?window:void 0;function fe(...e){let t,n,o,l;if(ue(e[0])||Array.isArray(e[0])?([n,o,l]=e,t=ve):[t,n,o,l]=e,!t)return de;Array.isArray(n)||(n=[n]),Array.isArray(o)||(o=[o]);const r=[],i=()=>{r.forEach((e=>e())),r.length=0},a=b((()=>[pe(t),he(l)]),(([e,t])=>{i(),e&&r.push(...n.flatMap((n=>o.map((o=>((e,t,n,o)=>(e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)))(e,n,o,t))))))}),{immediate:!0,flush:"post"}),s=()=>{a(),i()};var c;return c=s,g()&&w(c),s}const me="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},ye="__vueuse_ssr_handlers__";me[ye]=me[ye]||{};const ge={ctrl:"control",command:"meta",cmd:"meta",option:"alt",up:"arrowup",down:"arrowdown",left:"arrowleft",right:"arrowright"};var we,be;(be=we||(we={})).UP="UP",be.RIGHT="RIGHT",be.DOWN="DOWN",be.LEFT="LEFT",be.NONE="NONE";var Se=Object.defineProperty,Ae=Object.getOwnPropertySymbols,Ce=Object.prototype.hasOwnProperty,xe=Object.prototype.propertyIsEnumerable,Re=(e,t,n)=>t in e?Se(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;function Ne(){const e=a({lastX:0,lastY:0,isSpaceDown:o(!1),isMouseDown:o(!1)}),t=o(null),n=o(null),l=o(null),i=o(null),s=o(null),{groupState:c,onDrawGroupBoundry:u}=function(){const e=Y(),{transByCurScale:t,transAbsByCurScale:n}=ee(),o=T(),{primitives:l}=d(e),r=a({editorX:0,editorY:0,start:{x:0,y:0},width:0,height:0}),i=()=>{r.width=0,r.height=0,o.setAreaSelectVisible(!1),o.setAreaSelectOptions(null,[])},s=()=>{const e=c();if(e.length<=1)return void i();let t=1/0,n=1/0,l=-1/0,a=-1/0;e.forEach((e=>{var o;let i={};"Group"===e.cName?null==(o=e.childPrimitives)||o.forEach((e=>{const o=document.getElementById(`primitive${e.id}`).getBoundingClientRect();i.left=o.left-r.editorX,i.top=o.top-r.editorY,i.right=o.right-r.editorX,i.bottom=o.bottom-r.editorY,i.left<n&&(n=i.left),i.top<t&&(t=i.top),i.right>l&&(l=i.right),i.bottom>a&&(a=i.bottom)})):i=function(e){const t=e.top+e.height,n=e.left+e.width;return{left:e.left,top:e.top,right:n,bottom:t}}(e.style),i.left<n&&(n=i.left),i.top<t&&(t=i.top),i.right>l&&(l=i.right),i.bottom>a&&(a=i.bottom)})),r.start.x=n,r.start.y=t,r.width=l-n,r.height=a-t;const s={left:n,top:t,width:r.width,height:r.height};o.setAreaSelectOptions(s,e)},c=()=>{const{x:e,y:t}=r.start;return l.value.filter((n=>{const{left:o,top:l,width:i,height:a}=n.style;if(e<=o&&t<=l&&o+i<=e+r.width&&l+a<=t+r.height)return n}))};return{groupState:r,onDrawGroupBoundry:e=>{i();const l=document.getElementById("editor").getBoundingClientRect(),a=e.clientX,c=e.clientY;r.editorX=l.x,r.editorY=l.y,r.start.x=t(a-r.editorX),r.start.y=t(c-r.editorY),o.setAreaSelectVisible(!0);const u=e=>{r.width=n(e.clientX-a),r.height=n(e.clientY-c),e.clientX<a&&(r.start.x=n(e.clientX-r.editorX)),e.clientY<c&&(r.start.y=n(e.clientY-r.editorY))},d=e=>{document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",d),e.clientX!=a||e.clientY!=c?s():i()};document.addEventListener("mousemove",u),document.addEventListener("mouseup",d)}}}(),p=Y(),{curPrimitive:v,primitives:f,editorScale:m}=d(p),g=e=>{if(!e||!e.parentNode)return;const t=e.parentNode;if(!t.getAttribute)return;const n=t.getAttribute("data-context");return n||g(t)},w=n=>{var o;if(!e.isMouseDown)return;const l=n.clientX-e.lastX,r=n.clientY-e.lastY;null==(o=t.value)||o.scrollBy(-l,-r),e.lastX=n.clientX,e.lastY=n.clientY},{space:S}=function(e={}){const{reactive:t=!1,target:n=ve,aliasMap:l=ge,passive:i=!0,onEventFired:s=de}=e,c=a(new Set),u={toJSON:()=>({}),current:c},d=t?a(u):u,h=new Set,p=new Set;function v(e,n){e in d&&(t?d[e]=n:d[e].value=n)}function f(){c.clear();for(const e of p)v(e,!1)}function m(e,t){var n,o;const l=null==(n=e.key)?void 0:n.toLowerCase(),r=[null==(o=e.code)?void 0:o.toLowerCase(),l].filter(Boolean);l&&(t?c.add(l):c.delete(l));for(const i of r)p.add(i),v(i,t);"meta"!==l||t?"function"==typeof e.getModifierState&&e.getModifierState("Meta")&&t&&[...c,...r].forEach((e=>h.add(e))):(h.forEach((e=>{c.delete(e),v(e,!1)})),h.clear())}fe(n,"keydown",(e=>(m(e,!0),s(e))),{passive:i}),fe(n,"keyup",(e=>(m(e,!1),s(e))),{passive:i}),fe("blur",f,{passive:!0}),fe("focus",f,{passive:!0});const g=new Proxy(d,{get(e,n,i){if("string"!=typeof n)return Reflect.get(e,n,i);if((n=n.toLowerCase())in l&&(n=l[n]),!(n in d))if(/[+_-]/.test(n)){const e=n.split(/[+_-]/g).map((e=>e.trim()));d[n]=r((()=>e.every((e=>y(g[e])))))}else d[n]=o(!1);const a=Reflect.get(e,n,i);return t?y(a):a}});return g}({passive:!1,onEventFired(e){"Space"===e.code&&"keydown"===e.type&&e.preventDefault()}});return b(S,(t=>{e.isSpaceDown=t,n.value.style.cursor=t?"pointer":"default",t?document.addEventListener("mousemove",w):document.removeEventListener("mousemove",w)})),h((()=>{const e=s.value.getBoundingClientRect();t.value.scrollLeft=e.width/2-100,t.value.scrollTop=e.height/2-160})),{groupState:c,editorScale:m,contextMenuRef:l,primitives:f,screenRef:t,editorRef:n,sketchRulerRef:i,editorContaineRef:s,handleMouseUp:t=>{var n;p.isClickPrimitive||p.setCurPrimitive(null),2!==t.button&&(null==(n=l.value)||n.close()),e.isMouseDown=!1},handleMouseDown:t=>{0===t.button&&(e.isMouseDown=!0,e.isSpaceDown?(e.lastX=t.clientX,e.lastY=t.clientY):(p.setClickPrimitiveStatus(!1),v||t.preventDefault(),u(t)))},handleMouseWheel:e=>{var t;if(e.ctrlKey||e.metaKey){e.preventDefault();let n=m.value;if(e.wheelDelta>=0&&n<200)return n+=5,void p.setEditorScale(n);e.wheelDelta<0&&n>10&&(n-=5,p.setEditorScale(n)),null==(t=i.value)||t.handleResizeRuler()}},handleMouseScroll:()=>{var e;null==(e=i.value)||e.handleResizeRuler()},handleShowContextMenu:e=>{var t;if(e.stopPropagation(),e.preventDefault(),!e.target)return;const n=e.clientY,o=e.clientX,r=g(e.target);null==(t=l.value)||t.show({top:n,left:o,contextType:r})}}}((e,t)=>{for(var n in t||(t={}))Ce.call(t,n)&&Re(e,n,t[n]);if(Ae)for(var n of Ae(t))xe.call(t,n)&&Re(e,n,t[n])})({linear:function(e){return e}},{easeInSine:[.12,0,.39,0],easeOutSine:[.61,1,.88,1],easeInOutSine:[.37,0,.63,1],easeInQuad:[.11,0,.5,0],easeOutQuad:[.5,1,.89,1],easeInOutQuad:[.45,0,.55,1],easeInCubic:[.32,0,.67,0],easeOutCubic:[.33,1,.68,1],easeInOutCubic:[.65,0,.35,1],easeInQuart:[.5,0,.75,0],easeOutQuart:[.25,1,.5,1],easeInOutQuart:[.76,0,.24,1],easeInQuint:[.64,0,.78,0],easeOutQuint:[.22,1,.36,1],easeInOutQuint:[.83,0,.17,1],easeInExpo:[.7,0,.84,0],easeOutExpo:[.16,1,.3,1],easeInOutExpo:[.87,0,.13,1],easeInCirc:[.55,0,1,.45],easeOutCirc:[0,.55,.45,1],easeInOutCirc:[.85,0,.15,1],easeInBack:[.36,0,.66,-.56],easeOutBack:[.34,1.56,.64,1],easeInOutBack:[.68,-.6,.32,1.6]});const Ee="_screen_1bmdy_1",Be="_container_1bmdy_12",Oe="_editor_1bmdy_17",ke="_primitive_1bmdy_28";
/*!vue3-sketch-ruler v1.3.62022年11月Fri Nov 04 2022 18:18:02 GMT+0800 (中国标准时间)制作*/
var Le=(e,t)=>{const n=e.__vccOpts||e;for(const[o,l]of t)n[o]=l;return n};const De=l({name:"LineRuler",props:{scale:Number,thick:Number,palette:Object,index:Number,start:Number,vertical:Boolean,value:Number,isShowReferLine:Boolean},emits:["onMouseDown","onRelease","onRemove"],setup(e,{emit:t}){const n=o(0),l=o(!0);h((()=>{n.value=e.value}));const i=r((()=>{const t=(n.value-e.start)*e.scale;(e=>{l.value=e>=0})(t);const o=t+"px";return e.vertical?{top:o}:{left:o}})),a=r((()=>{var t;const n=`1px solid ${null==(t=e.palette)?void 0:t.lineColor}`,o=e.vertical?{borderTop:n}:{borderLeft:n};return{cursor:e.isShowReferLine?e.vertical?"ns-resize":"ew-resize":"none",...o}})),s=r((()=>e.vertical?{left:e.thick+"px"}:{top:e.thick+"px"}));return{startValue:n,showLine:l,offset:i,borderCursor:a,actionStyle:s,handleDown:o=>{const l=e.vertical?o.clientY:o.clientX,r=n.value;t("onMouseDown");const i=t=>{const o=e.vertical?t.clientY:t.clientX,i=Math.round(r+(o-l)/e.scale);n.value=i},a=()=>{t("onRelease",n.value,e.index),document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",a)};document.addEventListener("mousemove",i),document.addEventListener("mouseup",a)},handleRemove:()=>{t("onRemove",e.index)}}}}),Ie={class:"value"};var Me=Le(De,[["render",function(e,t,n,o,l,r){return c((A(),C("div",{class:"line",style:R([e.offset,e.borderCursor]),onMousedown:t[1]||(t[1]=(...t)=>e.handleDown&&e.handleDown(...t))},[x("div",{class:"action",style:R(e.actionStyle)},[x("span",{class:"del",onClick:t[0]||(t[0]=(...t)=>e.handleRemove&&e.handleRemove(...t))},"×"),x("span",Ie,B(e.startValue),1)],4)],36)),[[u,e.showLine]])}],["__scopeId","data-v-5dea28d6"]]);const Pe=l({name:"CanvasRuler",props:{showIndicator:Boolean,valueNum:Number,scale:Number,ratio:Number,palette:Object,vertical:Boolean,start:Number,width:Number,height:Number,selectStart:Number,selectLength:Number},emits:["onAddLine","update:showIndicator","update:valueNum"],setup(e,{emit:t}){const n=a({canvasContext:null});let l=1;const r=o(null);h((()=>{l=e.ratio||window.devicePixelRatio||1,i(),s(l),c(l)}));const i=()=>{n.canvasContext=r.value&&r.value.getContext("2d")},s=t=>{if(r.value){r.value.width=e.width*t,r.value.height=e.height*t;const o=n.canvasContext;o&&(o.font=12*t+'px -apple-system,\n                "Helvetica Neue", ".SFNSText-Regular",\n                "SF UI Text", Arial, "PingFang SC", "Hiragino Sans GB",\n                "Microsoft YaHei", "WenQuanYi Zen Hei", sans-serif',o.lineWidth=1,o.textBaseline="middle")}},c=t=>{const o={scale:e.scale,width:e.width,height:e.height,palette:e.palette,ratio:t};n.canvasContext&&((e,t,n,o,l,r)=>{const{scale:i,width:a,height:s,ratio:c,palette:u}=l,{bgColor:d,fontColor:h,shadowColor:p,longfgColor:v,shortfgColor:f}=u;if(e.scale(c,c),e.clearRect(0,0,a,s),e.fillStyle=d,e.fillRect(0,0,a,s),o){const l=(n-t)*i,c=o*i;e.fillStyle=p,r?e.fillRect(l,0,c,3*s/8):e.fillRect(0,l,3*a/8,c)}const m=(e=>e<=.25?40:e<=.5?20:e<=1?10:e<=2?5:e<=4?2:1)(i),y=m*i,g=10*m,w=g*i,b=Math.floor(t/m)*m,S=Math.floor(t/g)*g,A=(b-t)/m*y,C=(S-t)/g*w,x=t+Math.ceil((r?a:s)/i);e.beginPath(),e.fillStyle=h,e.strokeStyle=v;for(let R=S,N=0;R<x;R+=g,N++){const t=C+N*w+.5;r?e.moveTo(t,0):e.moveTo(0,t),e.save(),r?e.translate(t,.4*s):e.translate(.4*a,t),r||e.rotate(-Math.PI/2),e.scale(.83/c,.83/c),e.fillText(R.toString(),4*c,7*c),e.restore(),r?e.lineTo(t,9*s/16):e.lineTo(9*a/16,t)}e.stroke(),e.closePath(),e.beginPath(),e.strokeStyle=f;for(let R=b,N=0;R<x;R+=m,N++){const t=A+N*y+.5;r?e.moveTo(t,0):e.moveTo(0,t),R%g!=0&&(r?e.lineTo(t,1*s/4):e.lineTo(1*a/4,t))}e.stroke(),e.closePath(),e.setTransform(1,0,0,1,0,0)})(n.canvasContext,e.start,e.selectStart,e.selectLength,o,!e.vertical)};b((()=>e.start),(()=>c(l))),b([()=>e.width,()=>e.height],(()=>{s(l),c(l)}));return{handle:(n,o)=>{const l=e.vertical?n.offsetY:n.offsetX,r=(i=l,a=e.start,s=e.scale,Math.round(a+i/s));var i,a,s;switch(o){case"click":t("onAddLine",r);break;case"enter":t("update:valueNum",r),t("update:showIndicator",!0);break;default:t("update:valueNum",r)}},canvas:r}}});const Xe=l({name:"RulerWrapper",components:{CanvasRuler:Le(Pe,[["render",function(e,t,n,o,l,r){return A(),C("canvas",{ref:"canvas",class:"ruler",onClick:t[0]||(t[0]=t=>e.handle(t,"click")),onMouseenter:t[1]||(t[1]=t=>e.handle(t,"enter")),onMousemove:t[2]||(t[2]=t=>e.handle(t,"move")),onMouseleave:t[3]||(t[3]=t=>e.$emit("update:showIndicator",!1))},null,544)}]]),RulerLine:Me},props:{scale:Number,ratio:Number,thick:Number,palette:Object,vertical:{type:Boolean,default:!0},width:{type:Number,default:200},height:{type:Number,default:200},start:{type:Number,default:0},lines:{type:Array,default:()=>[]},selectStart:{type:Number},selectLength:{type:Number},isShowReferLine:{type:Boolean}},setup(e){const t=o(!1),n=o(0),l=r((()=>e.vertical?"v-container":"h-container")),i=r((()=>{const t={width:`calc(100% - ${e.thick}px)`,height:`${e.thick+1}px`,left:`${e.thick}px`},n={width:`${e.thick&&e.thick+1}px`,height:`calc(100% - ${e.thick}px)`,top:`${e.thick}px`};return e.vertical?n:t})),a=r((()=>{var t;const o=(n.value-e.start)*e.scale;let l="top",r="borderLeft";return l=e.vertical?"top":"left",r=e.vertical?"borderBottom":"borderLeft",{[l]:o+"px",[r]:`1px solid ${null==(t=e.palette)?void 0:t.lineColor}`}})),s=t=>{e.lines.splice(t,1)};return{showIndicator:t,valueNum:n,rwClassName:l,rwStyle:i,indicatorStyle:a,handleNewLine:t=>{e.lines.push(t)},handleLineRelease:(t,n)=>{const o=t-e.start,l=(e.vertical?e.height:e.width)/e.scale;o<0||o>l?s(n):e.lines[n]=t},handleLineRemove:s}}}),Ye={class:"lines"},je={class:"value"};const Te=l({name:"SketchRule",components:{RulerWrapper:Le(Xe,[["render",function(e,t,n,o,l,r){const a=S("CanvasRuler"),s=S("RulerLine");return A(),C("div",{class:O(e.rwClassName),style:R(e.rwStyle)},[i(a,{vertical:e.vertical,scale:e.scale,width:e.width,height:e.height,start:e.start,ratio:e.ratio,"select-start":e.selectStart,"select-length":e.selectLength,palette:e.palette,valueNum:e.valueNum,"onUpdate:valueNum":t[0]||(t[0]=t=>e.valueNum=t),showIndicator:e.showIndicator,"onUpdate:showIndicator":t[1]||(t[1]=t=>e.showIndicator=t),onOnAddLine:e.handleNewLine},null,8,["vertical","scale","width","height","start","ratio","select-start","select-length","palette","valueNum","showIndicator","onOnAddLine"]),c(x("div",Ye,[(A(!0),C(N,null,E(e.lines,((t,n)=>(A(),k(s,{key:t+n,index:n,value:t>>0,scale:e.scale,start:e.start,thick:e.thick,palette:e.palette,vertical:e.vertical,"is-show-refer-line":e.isShowReferLine,onOnRemove:e.handleLineRemove,onOnRelease:e.handleLineRelease},null,8,["index","value","scale","start","thick","palette","vertical","is-show-refer-line","onOnRemove","onOnRelease"])))),128))],512),[[u,e.isShowReferLine]]),c(x("div",{class:"indicator",style:R(e.indicatorStyle)},[x("div",je,B(e.valueNum),1)],4),[[u,e.showIndicator]])],6)}],["__scopeId","data-v-b6c23352"]])},props:{eyeIcon:{type:String},closeEyeIcon:{type:String},scale:{type:Number,default:1},ratio:{type:Number},thick:{type:Number,default:16},palette:Object,startX:{type:Number},startY:{type:Number,default:0},width:{type:Number,default:200},height:{type:Number,default:200},shadow:{type:Object,default:()=>({x:0,y:0,width:0,height:0})},lines:{type:Object,default:()=>({h:[],v:[]})},isShowReferLine:{type:Boolean,default:!0}},emits:["onCornerClick"],setup(e,{emit:t}){let n=o(!0);n.value=e.isShowReferLine;const l=r((()=>{const t=function e(t,n){return Object.keys(t).forEach((o=>{o&&t.hasOwnProperty(o)&&("object"==typeof n.key?t[o]=e(t[o],n[o]):n.hasOwnProperty(o)&&(t[o]=n[o]))})),t}({bgColor:"rgba(225,225,225, 0)",longfgColor:"#BABBBC",shortfgColor:"#C8CDD0",fontColor:"#7D8694",shadowColor:"#E8E8E8",lineColor:"#EB5648",borderColor:"#DADADC",cornerActiveColor:"rgb(235, 86, 72, 0.6)",menu:{bgColor:"#fff",dividerColor:"#DBDBDB",listItem:{textColor:"#415058",hoverTextColor:"#298DF8",disabledTextColor:"rgba(65, 80, 88, 0.4)",bgColor:"#fff",hoverBgColor:"#F2F2F2"}}},e.palette||{});return t})),i=r((()=>({backgroundImage:n.value?`url(${e.eyeIcon||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAopJREFUOE/FlE9IVEEcx7+/N9ouds1Mu0QUSFZYdIgoUqQoKPBQHsKozpXE7jbTO/U8xLJvn6usBHWQ6hBFXupSkQeVbh0KJEPp0sH+eLGTsKs77xcj78m0ax0E8cHjzZv5zef3/c33xxA24KENYGJzoEEQbNNaN4Zh2OQ4znwYhr9c1/39vwrXVDo0NNS0tLR0GYB5D64BmAMwzMyvlFKz1es10Hw+f4mZ7wHYBeA9gNdENFepVOaEEM3M3OI4Thczn41gt6WUgQ3+C+r7/h0AWQD3mXnYqPA8L9nQ0HCemduIaFpKOWoAhUJhT6VSuQXgOjP3K6W8GLwKzeVyp4jonR0QBEErM48w8zFLyayUsjX+z+VyHhHdZebTSqkxM78CHRgYOKS1/ghgVErZY214RkQ7ADyRUj72ff8qgCtmXUrZGcf5vv8CwEUhxOF0Ov1pBRpla5dSdseBhUJhpznH6tIsZb1KqacW+BGArUaUXX63UuplHJTNZjuEEONSyhozfd/n6mQ1RkXZL2itz7mu+80EDA4ONi8vL/8AcM2UbikyR2BU9cSmmTU70YqKIAj2hWFo2uenlHK/BRg3Y2aeNO5GyU8S0ZbFxcUuz/NKEXAGQKPjOCcymcyX1dIi8DSAiWQyeaavr68cbSgCuBknYubnQoj+TCYzUywWE6VS6S2ADsdx2gxw1X3L7SNENMbMnwE8qK+vf5NKpRaMaeVyeW8ikfiaSqW+R7BuZr5BRMe11p2u607U9Gk8kc/ntzPzQwCmExYATDLzVBiGE0KIowAOADDf3QA+aK2VDaxRajto3K+rq+tl5nYAzQBamHmeiOYBTGmtR6ph/1Rqg9c73pz7dD1qN0TpHyNQRCUDJXrAAAAAAElFTkSuQmCC"})`:`url(${e.closeEyeIcon||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAjtJREFUOE/NlD9oFEEUxn9v9ghC0hpRUogIAUmniGAT/5Q2FrETPSNRJILg7RwimI0ox85eQFCEBGIUO1PYpFM0jSConQoBEZGgGPsgl+w+2eM2bC57SopAFqYZ3v7m+977ZoQt+GQLmGxPaBiGgYiMWWvXBHZUGoZhH3BERPYC+4F+4Keq/urt7b1RLpf/ZEBVHa9Wq0HWyg3QKIoGVPU8cA7wgK/pUtXPQJ8xZk+pVBpuNBqXUoUiEvi+P56fzTpo6+SbwHNg1lo7WzTITGEKXFlZeeB53tVCpa3CK8AFa+1cBgvD8LKIXAQOJkkyICJDeYVBEJS6u7s/qeoLa+1o+l9TqXNuBLhmjDlbqVQ+5ICjInIfOBPH8W9jzGCR5YmJiRNxHM+papgqzqDvgSlr7VTernPuO3An3c9bBt74vv+yrdaKyLDv+/1Sq9UGPc97nY9EVuycU2AQOA7cAm4Dr4D5TvVxHB9rKo2iaEFVp621Ln96FEUngaOqGmSxabVqsh3a2h+x1h5qQjNrae/yE4+iaCwDJkky73neTuBZe129Xk+H+BS4l7ZqLVIZ2BhzuFKpvMsDVXXWGPMxFdAedOfcKeCRqj7MYrUhpz09PfXl5eXrectFWXXODQHpOq2qd/95o/JXr6ura3J1dXU6SZIfwKKIHAD2tVYMPBGRx77vN10UXtO85fTkmZmZHUtLSzUR2QXsBhaAL6r6DXhbrVYXi1yss59GqOgub/bN3Z7v6X/tb9Zmp/q/kN8s+lJb8oEAAAAASUVORK5CYII="})`,width:e.thick+"px",height:e.thick+"px",borderRight:`1px solid ${l.value.borderColor}`,borderBottom:`1px solid ${l.value.borderColor}`})));return b([()=>e.isShowReferLine],(()=>{n.value=e.isShowReferLine})),{showReferLine:n,paletteCpu:l,cornerStyle:i,onCornerClick:e=>{n.value=!n.value,t("onCornerClick",n.value)}}}}),Qe={id:"mb-ruler",class:"style-ruler mb-ruler"};var Ue=Le(Te,[["render",function(e,t,n,o,l,r){const a=S("RulerWrapper");return A(),C("div",Qe,[i(a,{vertical:!1,width:e.width,height:e.thick,"is-show-refer-line":e.showReferLine,thick:e.thick,ratio:e.ratio,start:e.startX,lines:e.lines.h,"select-start":e.shadow.x,"select-length":e.shadow.width,scale:e.scale,palette:e.paletteCpu},null,8,["width","height","is-show-refer-line","thick","ratio","start","lines","select-start","select-length","scale","palette"]),i(a,{vertical:!0,width:e.thick,height:e.height,"is-show-refer-line":e.showReferLine,thick:e.thick,ratio:e.ratio,start:e.startY,lines:e.lines.v,"select-start":e.shadow.y,"select-length":e.shadow.height,scale:e.scale,palette:e.paletteCpu},null,8,["width","height","is-show-refer-line","thick","ratio","start","lines","select-start","select-length","scale","palette"]),x("a",{class:"corner",style:R(e.cornerStyle),onClick:t[0]||(t[0]=(...t)=>e.onCornerClick&&e.onCornerClick(...t))},null,4)])}]]);const Fe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABmJLR0QA/wD/AP+gvaeTAAAA7ElEQVQ4je3SvS5EURSG4ccMmXYUQ0hoRoErEXMJ4iaE6GVqYlTojWugEf8/LZdApRLKCcVZh5PJOScTjUjmTb5irb3X2t/eezHkXzGHHTzhI/SIbTSLiio5uSrauMIbVtAIreId19iKvaVU0MUJJkr2TeIURwWmvtnEGWoRj+MAL3jGPuqxVsM5NspOfcVMxKO4xS6mQh3c+LnqbNQ08hquh5uUVjjIMoJLLGdyh1hLg+z9F3Cciedx39fwE3exltLFYp7Dflq4GMDhwFQlb9jBdGhPMjKF41L25T0sSX7zITQW7nq/cTjkj/gC6vIqCPem75wAAAAASUVORK5CYII=",Ge="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABmJLR0QA/wD/AP+gvaeTAAABEUlEQVQ4jdXTu0oDQRiG4ccDBqw8YAIWWkgaBcHeYrG1iQRyARbegdjnAhRLRUEQjHoLIoh4QBRRFCvRWo2Fhb1FJjAGlqSIYF5YZv+Z4eX7d2foJO6RtFM4izfM/XtpgvcwTuAB3+F5xGqYb5luHARBXTqAfsygrNZFGT3NZF2o4BjFKGkjORxhLwRIZQVnyIS6GCWdxwYGw1oGp1hOk+XwgfFQ9+IWO1HSRVyENRhDFSN1SfwNlvCJ3VAXMI0FXOMQm3hFFs/4Qh6juNTQ/xT2ozqPq/B+glKQvuA82lfBZFrbMYUgiklCqqQVQSN9uMGaWktZrONJ+t9vyhC2g6CKLQz7ffjbRmfd/bt2Cv+WH7FAOwOy5F6RAAAAAElFTkSuQmCC",Ve="_sketchRule_1i7jl_1",_e=l({name:"SketchRuler",setup(){const e=a({thick:16,startX:o(0),startY:o(0),lines:a({h:[],v:[]})}),t=Y(),n=L(),{editorScale:l}=d(t),{transByCurScale:i}=ee(),s=r((()=>{const e=document.getElementById("screen");return{width:null==e?void 0:e.clientWidth,height:null==e?void 0:e.clientHeight}})),c=r((()=>n.darkTheme?{bgColor:"#18181c",longfgColor:"#4d4d4d",shortfgColor:"#4d4d4d",fontColor:"#4d4d4d",shadowColor:"#18181c",borderColor:"#18181c",cornerActiveColor:"#18181c"}:{bgColor:"#fff",longfgColor:"#cbcbcb",shortfgColor:"#cbcbcb",fontColor:"#ababab",shadowColor:"#fff",borderColor:"#e2e2e2",cornerActiveColor:"blue"}));return{...D(e),editorScale:l,containerRect:s,handleResizeRuler:()=>{var t,n;const o=null==(t=document.querySelector("#screen"))?void 0:t.getBoundingClientRect(),l=null==(n=document.querySelector("#editor"))?void 0:n.getBoundingClientRect();e.startX=i(o.left+e.thick-l.left),e.startY=i(o.top+e.thick-l.top)},paletteStyle:c,eyeIcon:Fe,closeEyeIcon:Ge}},render(){var e,t;return i(Ue,{class:Ve,thick:this.thick,eyeIcon:Fe,closeEyeIcon:Ge,scale:this.editorScale/100,width:null==(e=this.containerRect)?void 0:e.width,height:null==(t=this.containerRect)?void 0:t.height,startX:this.startX,startY:this.startY,lines:this.lines,cornerActive:!0,palette:this.paletteStyle},null)}});const qe=l({name:"Editor",components:{SketchRuler:_e,AreaSelect:K,ContextMenu:ae},setup(){const e=o(!1),t=T(),{areaSelectVisible:n}=d(t),l=["width","height","top","left"],{groupState:i,editorScale:a,contextMenuRef:s,...c}=Ne(),u=r((()=>({transform:`scale(${a.value/100})`})));return I((()=>e.value=!0)),{...c,groupState:i,editorStyle:u,rulerVisible:e,contextMenuRef:s,getPrimitiveStyle:e=>G(e,l),areaSelectVisible:n,handleCloseContextMenu:()=>{var e;null==(e=s.value)||e.close()}}},render(){const e=e=>P(S(e.cName),{id:`primitive${e.id}`,class:ke,style:this.getPrimitiveStyle(e.style),"data-context":e.cName,dataSource:e});return i(N,null,[i("div",{id:"screen",ref:"screenRef",class:Ee,onWheel:this.handleMouseWheel,onScroll:this.handleMouseScroll},[i("div",{id:"editorContainer",ref:"editorContaineRef",class:Be},[i("div",{id:"editor",ref:"editorRef","data-context":"Editor",class:Oe,style:this.editorStyle,onMousedown:this.handleMouseDown,onMouseup:this.handleMouseUp,onContextmenu:this.handleShowContextMenu},[c(i(K,{options:this.groupState},null),[[u,this.areaSelectVisible]]),i($,null,null),i(ae,{ref:"contextMenuRef"},null),(()=>this.primitives.map(((t,n)=>{let o;return i(le,{index:n,style:V(t.style),primitive:t,pStyle:t.style,onCloseContextmenu:this.handleCloseContextMenu},"function"==typeof(l=o=e(t))||"[object Object]"===Object.prototype.toString.call(l)&&!M(l)?o:{default:()=>[o]});var l})))()])])]),this.rulerVisible?i(_e,{ref:"sketchRulerRef"},null):null])}}),Ke="_container_79xjy_1",We=l({name:"Container",components:{Editor:qe},setup(){const{...e}=(()=>{const e=Y(),{transByCurScale:t}=ee();return{handleDrop:n=>{n.preventDefault(),n.stopPropagation();const o=n.dataTransfer.getData("name"),l=document.querySelector("#editor").getBoundingClientRect(),r=new X[o],i={top:j.ceil(t(n.clientY-l.y)),left:j.ceil(t(n.clientX-l.x))};r.updateStyle(i),e.addPrimitive(r)},handleDragOver:e=>{e.preventDefault(),e.dataTransfer.dropEffect="copy"},handleMouseDown:e=>{e.stopPropagation()},handleMouseUp:()=>{}}})();return{...e}},render(){return i(N,null,[i("div",{class:Ke,onDrop:this.handleDrop,onDragover:this.handleDragOver,onMousedown:this.handleMouseDown,onMouseup:this.handleMouseUp},[i(qe,null,null)])])}});export{We as default};
//# sourceMappingURL=index-b8f6fa16.js.map
