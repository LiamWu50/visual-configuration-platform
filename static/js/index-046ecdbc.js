var e=Object.defineProperty,n=(n,t,o)=>(((n,t,o)=>{t in n?e(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o})(n,"symbol"!=typeof t?t+"":t,o),o);import{d as t,h as o,c as r,f as a,g as i,a5 as l,a4 as d,ah as s,ai as c,aj as u,z as h,ak as f,k as v,n as p,l as b,j as g,ac as y,u as m,al as k,a7 as x,m as w,am as C,p as S,ab as R,an as T,ao as D,N as L,ap as N,y as P,aq as K,aa as I,a6 as B,i as F,w as M,A,a1 as E,ar as O,a8 as z,R as $,B as j}from"./index-d950d778.js";import{T as _,M as U}from"./use-form-render-46b1127c.js";import{a as V,u as q,S as G}from"./source-modal-e648dd93.js";import{u as H}from"./index-af636b27.js";import{u as W}from"./browser-a2747fcc.js";import{u as Y,c as J,d as X}from"./use-merged-state-a44105ef.js";import{a as Q,X as Z}from"./Scrollbar-72d7e5a7.js";import{i as ee}from"./is-browser-11820a37.js";import{h as ne,f as te,c as oe,a as re}from"./create-9f3e5028.js";import{p as ae,g as ie}from"./index-5871ef24.js";import{V as le,c as de}from"./RadioGroup-0bae8b11.js";import{N as se}from"./Dropdown-150f9612.js";function ce(e){return"string"==typeof e?`s-${e}`:`n-${e}`}const ue=t({name:"Switcher",render:()=>o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},o("path",{d:"M12 8l10 8l-10 8z"}))}),he=o("svg",{viewBox:"0 0 64 64",class:"check-icon"},o("path",{d:"M50.42,16.76L22.34,39.45l-8.1-11.46c-1.12-1.58-3.3-1.96-4.88-0.84c-1.58,1.12-1.95,3.3-0.84,4.88l10.26,14.51  c0.56,0.79,1.42,1.31,2.38,1.45c0.16,0.02,0.32,0.03,0.48,0.03c0.8,0,1.57-0.27,2.2-0.78l30.99-25.03c1.5-1.21,1.74-3.42,0.52-4.92  C54.13,15.78,51.93,15.55,50.42,16.76z"})),fe=o("svg",{viewBox:"0 0 100 100",class:"line-icon"},o("path",{d:"M80.2,55.5H21.4c-2.8,0-5.1-2.5-5.1-5.5l0,0c0-3,2.3-5.5,5.1-5.5h58.7c2.8,0,5.1,2.5,5.1,5.5l0,0C85.2,53.1,82.9,55.5,80.2,55.5z"})),ve=r("n-checkbox-group"),pe=a([i("checkbox","\n line-height: var(--n-label-line-height);\n font-size: var(--n-font-size);\n outline: none;\n cursor: pointer;\n display: inline-flex;\n flex-wrap: nowrap;\n align-items: flex-start;\n word-break: break-word;\n --n-merged-color-table: var(--n-color-table);\n ",[a("&:hover",[i("checkbox-box",[l("border",{border:"var(--n-border-checked)"})])]),a("&:focus:not(:active)",[i("checkbox-box",[l("border","\n border: var(--n-border-focus);\n box-shadow: var(--n-box-shadow-focus);\n ")])]),d("inside-table",[i("checkbox-box","\n background-color: var(--n-merged-color-table);\n ")]),d("checked",[i("checkbox-box","\n background-color: var(--n-color-checked);\n ",[i("checkbox-icon",[a(".check-icon","\n opacity: 1;\n transform: scale(1);\n ")])])]),d("indeterminate",[i("checkbox-box",[i("checkbox-icon",[a(".check-icon","\n opacity: 0;\n transform: scale(.5);\n "),a(".line-icon","\n opacity: 1;\n transform: scale(1);\n ")])])]),d("checked, indeterminate",[a("&:focus:not(:active)",[i("checkbox-box",[l("border","\n border: var(--n-border-checked);\n box-shadow: var(--n-box-shadow-focus);\n ")])]),i("checkbox-box","\n background-color: var(--n-color-checked);\n border-left: 0;\n border-top: 0;\n ",[l("border",{border:"var(--n-border-checked)"})])]),d("disabled",{cursor:"not-allowed"},[d("checked",[i("checkbox-box","\n background-color: var(--n-color-disabled-checked);\n ",[l("border",{border:"var(--n-border-disabled-checked)"}),i("checkbox-icon",[a(".check-icon, .line-icon",{fill:"var(--n-check-mark-color-disabled-checked)"})])])]),i("checkbox-box","\n background-color: var(--n-color-disabled);\n ",[l("border",{border:"var(--n-border-disabled)"}),i("checkbox-icon",[a(".check-icon, .line-icon",{fill:"var(--n-check-mark-color-disabled)"})])]),l("label",{color:"var(--n-text-color-disabled)"})]),i("checkbox-box-wrapper","\n position: relative;\n width: var(--n-size);\n flex-shrink: 0;\n flex-grow: 0;\n user-select: none;\n -webkit-user-select: none;\n "),i("checkbox-box","\n position: absolute;\n left: 0;\n top: 50%;\n transform: translateY(-50%);\n height: var(--n-size);\n width: var(--n-size);\n display: inline-block;\n box-sizing: border-box;\n border-radius: var(--n-border-radius);\n background-color: var(--n-color);\n transition: background-color 0.3s var(--n-bezier);\n ",[l("border","\n transition:\n border-color .3s var(--n-bezier),\n box-shadow .3s var(--n-bezier);\n border-radius: inherit;\n position: absolute;\n left: 0;\n right: 0;\n top: 0;\n bottom: 0;\n border: var(--n-border);\n "),i("checkbox-icon","\n display: flex;\n align-items: center;\n justify-content: center;\n position: absolute;\n left: 1px;\n right: 1px;\n top: 1px;\n bottom: 1px;\n ",[a(".check-icon, .line-icon","\n width: 100%;\n fill: var(--n-check-mark-color);\n opacity: 0;\n transform: scale(0.5);\n transform-origin: center;\n transition:\n fill 0.3s var(--n-bezier),\n transform 0.3s var(--n-bezier),\n opacity 0.3s var(--n-bezier),\n border-color 0.3s var(--n-bezier);\n "),s({left:"1px",top:"1px"})])]),l("label","\n color: var(--n-text-color);\n transition: color .3s var(--n-bezier);\n user-select: none;\n -webkit-user-select: none;\n padding: var(--n-label-padding);\n font-weight: var(--n-label-font-weight);\n ",[a("&:empty",{display:"none"})])]),c(i("checkbox","\n --n-merged-color-table: var(--n-color-table-modal);\n ")),u(i("checkbox","\n --n-merged-color-table: var(--n-color-table-popover);\n "))]),be=t({name:"Checkbox",props:Object.assign(Object.assign({},m.props),{size:String,checked:{type:[Boolean,String,Number],default:void 0},defaultChecked:{type:[Boolean,String,Number],default:!1},value:[String,Number],disabled:{type:Boolean,default:void 0},indeterminate:Boolean,label:String,focusable:{type:Boolean,default:!0},checkedValue:{type:[Boolean,String,Number],default:!0},uncheckedValue:{type:[Boolean,String,Number],default:!1},"onUpdate:checked":[Function,Array],onUpdateChecked:[Function,Array],privateInsideTable:Boolean,onChange:[Function,Array]}),setup(e){h((()=>{e.onChange&&f("checkbox","`on-change` is deprecated, please use `on-update:checked` instead.")}));const n=v(null),{mergedClsPrefixRef:t,inlineThemeDisabled:o,mergedRtlRef:r}=p(e),a=W(e,{mergedSize(n){const{size:t}=e;if(void 0!==t)return t;if(d){const{value:e}=d.mergedSizeRef;if(void 0!==e)return e}if(n){const{mergedSize:e}=n;if(void 0!==e)return e.value}return"medium"},mergedDisabled(n){const{disabled:t}=e;if(void 0!==t)return t;if(d){if(d.disabledRef.value)return!0;const{maxRef:{value:e},checkedCountRef:n}=d;if(void 0!==e&&n.value>=e&&!T.value)return!0;const{minRef:{value:t}}=d;if(void 0!==t&&n.value<=t&&T.value)return!0}return!!n&&n.disabled.value}}),{mergedDisabledRef:i,mergedSizeRef:l}=a,d=b(ve,null),s=v(e.defaultChecked),c=g(e,"checked"),u=Y(c,s),T=y((()=>{if(d){const n=d.valueSetRef.value;return!(!n||void 0===e.value)&&n.has(e.value)}return u.value===e.checkedValue})),D=m("Checkbox","-checkbox",pe,k,e,t);function L(n){if(d&&void 0!==e.value)d.toggleCheckbox(!T.value,e.value);else{const{onChange:t,"onUpdate:checked":o,onUpdateChecked:r}=e,{nTriggerFormInput:i,nTriggerFormChange:l}=a,d=T.value?e.uncheckedValue:e.checkedValue;o&&J(o,d,n),r&&J(r,d,n),t&&J(t,d,n),i(),l(),s.value=d}}const N={focus:()=>{var e;null===(e=n.value)||void 0===e||e.focus()},blur:()=>{var e;null===(e=n.value)||void 0===e||e.blur()}},P=x("Checkbox",r,t),K=w((()=>{const{value:e}=l,{common:{cubicBezierEaseInOut:n},self:{borderRadius:t,color:o,colorChecked:r,colorDisabled:a,colorTableHeader:i,colorTableHeaderModal:d,colorTableHeaderPopover:s,checkMarkColor:c,checkMarkColorDisabled:u,border:h,borderFocus:f,borderDisabled:v,borderChecked:p,boxShadowFocus:b,textColor:g,textColorDisabled:y,checkMarkColorDisabledChecked:m,colorDisabledChecked:k,borderDisabledChecked:x,labelPadding:w,labelLineHeight:S,labelFontWeight:R,[C("fontSize",e)]:T,[C("size",e)]:L}}=D.value;return{"--n-label-line-height":S,"--n-label-font-weight":R,"--n-size":L,"--n-bezier":n,"--n-border-radius":t,"--n-border":h,"--n-border-checked":p,"--n-border-focus":f,"--n-border-disabled":v,"--n-border-disabled-checked":x,"--n-box-shadow-focus":b,"--n-color":o,"--n-color-checked":r,"--n-color-table":i,"--n-color-table-modal":d,"--n-color-table-popover":s,"--n-color-disabled":a,"--n-color-disabled-checked":k,"--n-text-color":g,"--n-text-color-disabled":y,"--n-check-mark-color":c,"--n-check-mark-color-disabled":u,"--n-check-mark-color-disabled-checked":m,"--n-font-size":T,"--n-label-padding":w}})),I=o?S("checkbox",w((()=>l.value[0])),K,e):void 0;return Object.assign(a,N,{rtlEnabled:P,selfRef:n,mergedClsPrefix:t,mergedDisabled:i,renderedChecked:T,mergedTheme:D,labelId:R(),handleClick:function(e){i.value||L(e)},handleKeyUp:function(e){if(!i.value)switch(e.key){case" ":case"Enter":L(e)}},handleKeyDown:function(e){if(" "===e.key)e.preventDefault()},cssVars:o?void 0:K,themeClass:null==I?void 0:I.themeClass,onRender:null==I?void 0:I.onRender})},render(){var e;const{$slots:n,renderedChecked:t,mergedDisabled:r,indeterminate:a,privateInsideTable:i,cssVars:l,labelId:d,label:s,mergedClsPrefix:c,focusable:u,handleKeyUp:h,handleKeyDown:f,handleClick:v}=this;return null===(e=this.onRender)||void 0===e||e.call(this),o("div",{ref:"selfRef",class:[`${c}-checkbox`,this.themeClass,this.rtlEnabled&&`${c}-checkbox--rtl`,t&&`${c}-checkbox--checked`,r&&`${c}-checkbox--disabled`,a&&`${c}-checkbox--indeterminate`,i&&`${c}-checkbox--inside-table`],tabindex:r||!u?void 0:0,role:"checkbox","aria-checked":a?"mixed":t,"aria-labelledby":d,style:l,onKeyup:h,onKeydown:f,onClick:v,onMousedown:()=>{Q("selectstart",window,(e=>{e.preventDefault()}),{once:!0})}},o("div",{class:`${c}-checkbox-box-wrapper`},"Â ",o("div",{class:`${c}-checkbox-box`},o(T,null,{default:()=>this.indeterminate?o("div",{key:"indeterminate",class:`${c}-checkbox-icon`},fe):o("div",{key:"check",class:`${c}-checkbox-icon`},he)}),o("div",{class:`${c}-checkbox-box__border`}))),null!==s||n.default?o("span",{class:`${c}-checkbox__label`,id:d},n.default?n.default():s):null)}}),ge=r("n-tree-select"),ye=r("n-tree"),me=t({name:"NTreeSwitcher",props:{clsPrefix:{type:String,required:!0},expanded:Boolean,selected:Boolean,hide:Boolean,loading:Boolean,onClick:Function},setup(e){const{renderSwitcherIconRef:n}=b(ye,null);return()=>{const{clsPrefix:t}=e;return o("span",{"data-switcher":!0,class:[`${t}-tree-node-switcher`,e.expanded&&`${t}-tree-node-switcher--expanded`,e.hide&&`${t}-tree-node-switcher--hide`],onClick:e.onClick},o("div",{class:`${t}-tree-node-switcher__icon`},o(T,null,{default:()=>{if(e.loading)return o(D,{clsPrefix:t,key:"loading",radius:85,strokeWidth:20});const{value:r}=n;return r?r({expanded:e.expanded,selected:e.selected}):o(L,{clsPrefix:t,key:"switcher"},{default:()=>o(ue,null)})}})))}}}),ke=t({name:"NTreeNodeCheckbox",props:{clsPrefix:{type:String,required:!0},right:Boolean,focusable:Boolean,disabled:Boolean,checked:Boolean,indeterminate:Boolean,onCheck:Function},setup(e){function n(n){const{onCheck:t}=e;t&&t(n)}return{handleUpdateValue:function(t){e.indeterminate?n(!1):n(t)},mergedTheme:b(ye).mergedThemeRef}},render(){const{clsPrefix:e,mergedTheme:n,checked:t,indeterminate:r,disabled:a,focusable:i,handleUpdateValue:l}=this;return o("span",{class:[`${e}-tree-node-checkbox`,this.right&&`${e}-tree-node-checkbox--right`],"data-checkbox":!0},o(be,{focusable:i,disabled:a,theme:n.peers.Checkbox,themeOverrides:n.peerOverrides.Checkbox,checked:t,indeterminate:r,onUpdateChecked:l}))}}),xe=t({name:"TreeNodeContent",props:{clsPrefix:{type:String,required:!0},disabled:Boolean,checked:Boolean,selected:Boolean,onClick:Function,onDragstart:Function,tmNode:{type:Object,required:!0},nodeProps:Object},setup(e){const{renderLabelRef:n,renderPrefixRef:t,renderSuffixRef:o,labelFieldRef:r}=b(ye);return{selfRef:v(null),renderLabel:n,renderPrefix:t,renderSuffix:o,labelField:r,handleClick:function(n){!function(n){const{onClick:t}=e;t&&t(n)}(n)}}},render(){const{clsPrefix:e,labelField:n,nodeProps:t,checked:r=!1,selected:a=!1,renderLabel:i,renderPrefix:l,renderSuffix:d,handleClick:s,onDragstart:c,tmNode:{rawNode:u,rawNode:{prefix:h,suffix:f,[n]:v}}}=this;return o("span",Object.assign({},t,{ref:"selfRef",class:[`${e}-tree-node-content`,null==t?void 0:t.class],onClick:s,draggable:void 0!==c||void 0,onDragstart:c}),l||h?o("div",{class:`${e}-tree-node-content__prefix`},l?l({option:u,selected:a,checked:r}):N(h)):null,o("div",{class:`${e}-tree-node-content__text`},i?i({option:u,selected:a,checked:r}):N(v)),d||f?o("div",{class:`${e}-tree-node-content__suffix`},d?d({option:u,selected:a,checked:r}):N(f)):null)}});function we({position:e,offsetLevel:n,indent:t,el:r}){const a={position:"absolute",boxSizing:"border-box",right:0};if("inside"===e)a.left=0,a.top=0,a.bottom=0,a.borderRadius="inherit",a.boxShadow="inset 0 0 0 2px var(--n-drop-mark-color)";else{const o="before"===e?"top":"bottom";a[o]=0,a.left=r.offsetLeft+6-n*t+"px",a.height="2px",a.backgroundColor="var(--n-drop-mark-color)",a.transformOrigin=o,a.borderRadius="1px",a.transform="before"===e?"translateY(-4px)":"translateY(4px)"}return o("div",{style:a})}function Ce(e,n){return!!e.rawNode[n]}function Se(e,n,t,o){null==e||e.forEach((e=>{t(e),Se(e[n],n,t,o),o(e)}))}function Re(e,n,t,o,r){const a=new Set,i=new Set,l=[];return Se(e,o,(e=>{if(l.push(e),r(n,e)){i.add(e[t]);for(let e=l.length-2;e>=0;--e){if(a.has(l[e][t]))return;a.add(l[e][t])}}}),(()=>{l.pop()})),{expandedKeys:Array.from(a),highlightKeySet:i}}if(ee&&Image){(new Image).src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="}const Te=t({name:"TreeNode",props:{clsPrefix:{type:String,required:!0},tmNode:{type:Object,required:!0}},setup(e){const n=b(ye),{droppingNodeParentRef:t,droppingMouseNodeRef:o,draggingNodeRef:r,droppingPositionRef:a,droppingOffsetLevelRef:i,nodePropsRef:l,indentRef:d,blockLineRef:s,checkboxPlacementRef:c,checkOnClickRef:u,disabledFieldRef:h}=n,f=y((()=>!!e.tmNode.rawNode.checkboxDisabled)),p=y((()=>Ce(e.tmNode,h.value))),g=y((()=>n.disabledRef.value||p.value)),m=w((()=>{const{value:n}=l;if(n)return n({option:e.tmNode.rawNode})})),k=v(null),x={value:null};function C(){const{tmNode:t}=e;if(t.isLeaf||t.shallowLoaded)n.handleSwitcherClick(t);else{if(n.loadingKeysRef.value.has(t.key))return;n.loadingKeysRef.value.add(t.key);const{onLoadRef:{value:e}}=n;e&&e(t.rawNode).then((e=>{!1!==e&&n.handleSwitcherClick(t)})).finally((()=>{n.loadingKeysRef.value.delete(t.key)}))}}P((()=>{x.value=k.value.$el}));const S=y((()=>!p.value&&n.selectableRef.value&&(!n.internalTreeSelect||("child"!==n.mergedCheckStrategyRef.value||n.multipleRef.value&&n.cascadeRef.value||e.tmNode.isLeaf)))),R=y((()=>n.checkableRef.value&&(n.cascadeRef.value||"child"!==n.mergedCheckStrategyRef.value||e.tmNode.isLeaf))),T=y((()=>n.displayedCheckedKeysRef.value.includes(e.tmNode.key))),D=y((()=>{const{value:n}=R;if(!n)return!1;const{value:t}=u;return"boolean"==typeof t?t:t(e.tmNode.rawNode)}));function L(t){const{value:o}=n.expandOnClickRef,{value:r}=S,{value:a}=D;if(!r&&!o&&!a)return;if(ne(t,"checkbox")||ne(t,"switcher"))return;const{tmNode:i}=e;r&&n.handleSelect(i),o&&!i.isLeaf&&C(),a&&N(!T.value)}function N(t){n.handleCheck(e.tmNode,t)}return{showDropMark:y((()=>{const{value:n}=r;if(!n)return;const{value:t}=a;if(!t)return;const{value:i}=o;if(!i)return;const{tmNode:l}=e;return l.key===i.key})),showDropMarkAsParent:y((()=>{const{value:n}=t;if(!n)return!1;const{tmNode:o}=e,{value:r}=a;return("before"===r||"after"===r)&&n.key===o.key})),pending:y((()=>n.pendingNodeKeyRef.value===e.tmNode.key)),loading:y((()=>n.loadingKeysRef.value.has(e.tmNode.key))),highlight:y((()=>{var t;return null===(t=n.highlightKeySetRef.value)||void 0===t?void 0:t.has(e.tmNode.key)})),checked:T,indeterminate:y((()=>n.displayedIndeterminateKeysRef.value.includes(e.tmNode.key))),selected:y((()=>n.mergedSelectedKeysRef.value.includes(e.tmNode.key))),expanded:y((()=>n.mergedExpandedKeysRef.value.includes(e.tmNode.key))),disabled:g,checkable:R,mergedCheckOnClick:D,checkboxDisabled:f,selectable:S,expandOnClick:n.expandOnClickRef,internalScrollable:n.internalScrollableRef,draggable:n.draggableRef,blockLine:s,nodeProps:m,checkboxFocusable:n.internalCheckboxFocusableRef,droppingPosition:a,droppingOffsetLevel:i,indent:d,checkboxPlacement:c,contentInstRef:k,contentElRef:x,handleCheck:N,handleDrop:function(t){t.preventDefault(),null!==a.value&&n.handleDrop({event:t,node:e.tmNode,dropPosition:a.value})},handleDragStart:function(t){n.handleDragStart({event:t,node:e.tmNode})},handleDragEnter:function(t){t.currentTarget===t.target&&n.handleDragEnter({event:t,node:e.tmNode})},handleDragOver:function(t){t.preventDefault(),n.handleDragOver({event:t,node:e.tmNode})},handleDragEnd:function(t){n.handleDragEnd({event:t,node:e.tmNode})},handleDragLeave:function(t){t.currentTarget===t.target&&n.handleDragLeave({event:t,node:e.tmNode})},handleLineClick:function(e){var n,t;s.value&&(g.value||L(e),null===(t=null===(n=m.value)||void 0===n?void 0:n.onClick)||void 0===t||t.call(n,e))},handleContentClick:function(e){var n,t;s.value||(g.value||L(e),null===(t=null===(n=m.value)||void 0===n?void 0:n.onClick)||void 0===t||t.call(n,e))},handleSwitcherClick:C}},render(){const{tmNode:e,clsPrefix:n,checkable:t,expandOnClick:r,selectable:a,selected:i,checked:l,highlight:d,draggable:s,blockLine:c,indent:u,disabled:h,pending:f,internalScrollable:v,nodeProps:p,checkboxPlacement:b}=this,g=s&&!h?{onDragenter:this.handleDragEnter,onDragleave:this.handleDragLeave,onDragend:this.handleDragEnd,onDrop:this.handleDrop,onDragover:this.handleDragOver}:void 0,y=v?ce(e.key):void 0,m="right"===b,k=t?o(ke,{right:m,focusable:this.checkboxFocusable,disabled:h||this.checkboxDisabled,clsPrefix:n,checked:this.checked,indeterminate:this.indeterminate,onCheck:this.handleCheck}):null;return o("div",Object.assign({class:`${n}-tree-node-wrapper`},g),o("div",Object.assign({},c?p:void 0,{class:[`${n}-tree-node`,{[`${n}-tree-node--selected`]:i,[`${n}-tree-node--checkable`]:t,[`${n}-tree-node--highlight`]:d,[`${n}-tree-node--pending`]:f,[`${n}-tree-node--disabled`]:h,[`${n}-tree-node--selectable`]:a,[`${n}-tree-node--clickable`]:a||r||this.mergedCheckOnClick},null==p?void 0:p.class],"data-key":y,draggable:s&&c,onClick:this.handleLineClick,onDragstart:s&&c&&!h?this.handleDragStart:void 0}),K(e.level,o("div",{class:`${n}-tree-node-indent`},o("div",{style:{width:`${u}px`}}))),o(me,{clsPrefix:n,expanded:this.expanded,selected:i,loading:this.loading,hide:e.isLeaf,onClick:this.handleSwitcherClick}),m?null:k,o(xe,{ref:"contentInstRef",clsPrefix:n,checked:l,selected:i,onClick:this.handleContentClick,nodeProps:c?void 0:p,onDragstart:!s||c||h?void 0:this.handleDragStart,tmNode:e}),s?this.showDropMark?we({el:this.contentElRef.value,position:this.droppingPosition,offsetLevel:this.droppingOffsetLevel,indent:u}):this.showDropMarkAsParent?we({el:this.contentElRef.value,position:"inside",offsetLevel:this.droppingOffsetLevel,indent:u}):null:null,m?k:null))}});const De=t({name:"TreeMotionWrapper",props:{clsPrefix:{type:String,required:!0},height:Number,nodes:{type:Array,required:!0},mode:{type:String,required:!0},onAfterEnter:{type:Function,required:!0}},render(){const{clsPrefix:e}=this;return o(I,{onAfterEnter:this.onAfterEnter,appear:!0,reverse:"collapse"===this.mode},{default:()=>o("div",{class:[`${e}-tree-motion-wrapper`,`${e}-tree-motion-wrapper--${this.mode}`],style:{height:ae(this.height)}},this.nodes.map((n=>o(Te,{clsPrefix:e,tmNode:n}))))})}}),Le=i("tree","\n font-size: var(--n-font-size);\n outline: none;\n",[a("ul, li","\n margin: 0;\n padding: 0;\n list-style: none;\n "),a(">",[i("tree-node",[a("&:first-child",{marginTop:0})])]),i("tree-node-indent","\n flex-grow: 0;\n flex-shrink: 0;\n height: 0;\n "),i("tree-motion-wrapper",[d("expand",[B({duration:"0.2s"})]),d("collapse",[B({duration:"0.2s",reverse:!0})])]),i("tree-node-wrapper","\n box-sizing: border-box;\n padding: 3px 0;\n "),i("tree-node","\n transform: translate3d(0,0,0);\n position: relative;\n display: flex;\n border-radius: var(--n-node-border-radius);\n transition: background-color .3s var(--n-bezier);\n ",[d("highlight",[i("tree-node-content",[l("text",{borderBottomColor:"var(--n-node-text-color-disabled)"})])]),d("disabled",[i("tree-node-content","\n color: var(--n-node-text-color-disabled);\n cursor: not-allowed;\n ")]),F("disabled",[d("clickable",[i("tree-node-content","\n cursor: pointer;\n ")])])]),d("block-node",[i("tree-node-content","\n flex: 1;\n min-width: 0;\n ")]),F("block-line",[i("tree-node",[F("disabled",[i("tree-node-content",[a("&:hover",{backgroundColor:"var(--n-node-color-hover)"})]),d("selectable",[i("tree-node-content",[a("&:active",{backgroundColor:"var(--n-node-color-pressed)"})])]),d("pending",[i("tree-node-content","\n background-color: var(--n-node-color-hover);\n ")]),d("selected",[i("tree-node-content",{backgroundColor:"var(--n-node-color-active)"})])])])]),d("block-line",[i("tree-node",[F("disabled",[a("&:hover",{backgroundColor:"var(--n-node-color-hover)"}),d("pending","\n background-color: var(--n-node-color-hover);\n "),d("selectable",[F("selected",[a("&:active",{backgroundColor:"var(--n-node-color-pressed)"})])]),d("selected",{backgroundColor:"var(--n-node-color-active)"})]),d("disabled","\n cursor: not-allowed;\n ")])]),i("tree-node-switcher","\n cursor: pointer;\n display: inline-flex;\n flex-shrink: 0;\n height: 24px;\n width: 24px;\n align-items: center;\n justify-content: center;\n transition: transform .15s var(--n-bezier);\n vertical-align: bottom;\n ",[l("icon","\n position: relative;\n height: 14px;\n width: 14px;\n display: flex;\n color: var(--n-arrow-color);\n transition: color .3s var(--n-bezier);\n font-size: 14px;\n ",[i("icon",[s()]),i("base-loading","\n color: var(--n-loading-color);\n position: absolute;\n left: 0;\n top: 0;\n right: 0;\n bottom: 0;\n ",[s()]),i("base-icon",[s()])]),d("hide",{visibility:"hidden"}),d("expanded",{transform:"rotate(90deg)"})]),i("tree-node-checkbox","\n display: inline-flex;\n height: 24px;\n width: 16px;\n vertical-align: bottom;\n align-items: center;\n justify-content: center;\n margin-right: 4px;\n ",[d("right","margin-left: 4px;")]),d("checkable",[i("tree-node-content","\n padding: 0 6px;\n ")]),i("tree-node-content","\n position: relative;\n display: inline-flex;\n align-items: center;\n min-height: 24px;\n box-sizing: border-box;\n line-height: 1.5;\n vertical-align: bottom;\n padding: 0 6px 0 4px;\n cursor: default;\n border-radius: var(--n-node-border-radius);\n text-decoration-color: #0000;\n text-decoration-line: underline;\n color: var(--n-node-text-color);\n transition:\n color .3s var(--n-bezier),\n text-decoration-color .3s var(--n-bezier),\n background-color .3s var(--n-bezier),\n border-color .3s var(--n-bezier);\n ",[a("&:last-child",{marginBottom:0}),l("prefix","\n display: inline-flex;\n margin-right: 8px;\n "),l("text","\n border-bottom: 1px solid #0000;\n transition: border-color .3s var(--n-bezier);\n flex-grow: 1;\n max-width: 100%;\n "),l("suffix","\n display: inline-flex;\n ")]),l("empty","margin: auto;")]);var Ne=globalThis&&globalThis.__awaiter||function(e,n,t,o){return new(t||(t=Promise))((function(r,a){function i(e){try{d(o.next(e))}catch(n){a(n)}}function l(e){try{d(o.throw(e))}catch(n){a(n)}}function d(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,l)}d((o=o.apply(e,n||[])).next())}))};const Pe={allowCheckingNotLoaded:Boolean,filter:Function,defaultExpandAll:Boolean,expandedKeys:Array,keyField:{type:String,default:"key"},labelField:{type:String,default:"label"},childrenField:{type:String,default:"children"},disabledField:{type:String,default:"disabled"},defaultExpandedKeys:{type:Array,default:()=>[]},indeterminateKeys:Array,renderSwitcherIcon:Function,onUpdateIndeterminateKeys:[Function,Array],"onUpdate:indeterminateKeys":[Function,Array],onUpdateExpandedKeys:[Function,Array],"onUpdate:expandedKeys":[Function,Array]},Ke=t({name:"Tree",props:Object.assign(Object.assign(Object.assign(Object.assign({},m.props),{accordion:Boolean,showIrrelevantNodes:{type:Boolean,default:!0},data:{type:Array,default:()=>[]},expandOnDragenter:{type:Boolean,default:!0},expandOnClick:Boolean,checkOnClick:{type:[Boolean,Function],default:!1},cancelable:{type:Boolean,default:!0},checkable:Boolean,draggable:Boolean,blockNode:Boolean,blockLine:Boolean,disabled:Boolean,checkedKeys:Array,defaultCheckedKeys:{type:Array,default:()=>[]},selectedKeys:Array,defaultSelectedKeys:{type:Array,default:()=>[]},multiple:Boolean,pattern:{type:String,default:""},onLoad:Function,cascade:Boolean,selectable:{type:Boolean,default:!0},indent:{type:Number,default:16},allowDrop:{type:Function,default:function({dropPosition:e,node:n}){return!1===n.isLeaf||(!!n.children||"inside"!==e)}},animated:{type:Boolean,default:!0},checkboxPlacement:{type:String,default:"left"},virtualScroll:Boolean,watchProps:Array,renderLabel:Function,renderPrefix:Function,renderSuffix:Function,nodeProps:Function,keyboard:{type:Boolean,default:!0},getChildren:Function,onDragenter:[Function,Array],onDragleave:[Function,Array],onDragend:[Function,Array],onDragstart:[Function,Array],onDragover:[Function,Array],onDrop:[Function,Array],onUpdateCheckedKeys:[Function,Array],"onUpdate:checkedKeys":[Function,Array],onUpdateSelectedKeys:[Function,Array],"onUpdate:selectedKeys":[Function,Array]}),Pe),{internalTreeSelect:Boolean,internalScrollable:Boolean,internalScrollablePadding:String,internalRenderEmpty:Function,internalHighlightKeySet:Object,internalUnifySelectCheck:Boolean,internalCheckboxFocusable:{type:Boolean,default:!0},internalFocusable:{type:Boolean,default:!0},checkStrategy:{type:String,default:"all"},leafOnly:Boolean}),setup(e){h((()=>{e.leafOnly&&f("tree",'`leaf-only` is deprecated, please use `check-strategy="child"` instead')}));const{mergedClsPrefixRef:n,inlineThemeDisabled:t,mergedRtlRef:o}=p(e),r=x("Tree",o,n),a=m("Tree","-tree",Le,O,e,n),i=v(null),l=v(null),d=v(null);const s=w((()=>{const{filter:n}=e;if(n)return n;const{labelField:t}=e;return(e,n)=>{if(!e.length)return!0;const o=n[t];return"string"==typeof o&&o.toLowerCase().includes(e.toLowerCase())}})),c=w((()=>{const{pattern:n}=e;return n&&n.length&&s.value?function(e,n,t,o,r){const a=new Set,i=new Set,l=new Set,d=[],s=[],c=[];return function e(d){d.forEach((d=>{if(c.push(d),n(t,d)){a.add(d[o]),l.add(d[o]);for(let e=c.length-2;e>=0;--e){const n=c[e][o];if(i.has(n))break;i.add(n),a.has(n)&&a.delete(n)}}const s=d[r];s&&e(s),c.pop()}))}(e),function e(n,t){n.forEach((n=>{const l=n[o],s=a.has(l),c=i.has(l);if(!s&&!c)return;const u=n[r];if(u)if(s)t.push(n);else{d.push(l);const o=Object.assign(Object.assign({},n),{[r]:[]});t.push(o),e(u,o[r])}else t.push(n)}))}(e,s),{filteredTree:s,highlightKeySet:l,expandedKeys:d}}(e.data,s.value,n,e.keyField,e.childrenField):{filteredTree:e.data,highlightKeySet:null,expandedKeys:void 0}})),u=w((()=>{return oe(e.showIrrelevantNodes?e.data:c.value.filteredTree,(n=e.keyField,t=e.childrenField,o=e.disabledField,{getIsGroup:()=>!1,getKey:e=>e[n],getChildren:e.getChildren||(e=>e[t]),getDisabled:e=>!(!e[o]&&!e.checkboxDisabled)}));var n,t,o})),y=b(ge,null),k=e.internalTreeSelect?y.dataTreeMate:u,{watchProps:C}=e,R=v([]);(null==C?void 0:C.includes("defaultCheckedKeys"))?h((()=>{R.value=e.defaultCheckedKeys})):R.value=e.defaultCheckedKeys;const T=g(e,"checkedKeys"),D=Y(T,R),L=w((()=>k.value.getCheckedKeys(D.value,{cascade:e.cascade,allowNotLoaded:e.allowCheckingNotLoaded}))),N=function(e){return w((()=>e.leafOnly?"child":e.checkStrategy))}(e),P=w((()=>L.value.checkedKeys)),K=w((()=>{const{indeterminateKeys:n}=e;return void 0!==n?n:L.value.indeterminateKeys})),I=v([]);(null==C?void 0:C.includes("defaultSelectedKeys"))?h((()=>{I.value=e.defaultSelectedKeys})):I.value=e.defaultSelectedKeys;const B=g(e,"selectedKeys"),F=Y(B,I),$=v([]),j=n=>{$.value=e.defaultExpandAll?k.value.getNonLeafKeys():void 0===n?e.defaultExpandedKeys:n};(null==C?void 0:C.includes("defaultExpandedKeys"))?h((()=>{j(void 0)})):h((()=>{j(e.defaultExpandedKeys)}));const _=g(e,"expandedKeys"),U=Y(_,$),V=w((()=>u.value.getFlattenedNodes(U.value))),{pendingNodeKeyRef:q,handleKeydown:G}=function({props:e,fNodesRef:n,mergedExpandedKeysRef:t,mergedSelectedKeysRef:o,handleSelect:r,handleSwitcherClick:a}){const{value:i}=o,l=b(ge,null),d=l?l.pendingNodeKeyRef:v(i.length?i[i.length-1]:null);return{pendingNodeKeyRef:d,handleKeydown:function(o){if(!e.keyboard)return;const{value:i}=d;if(null===i){if("ArrowDown"!==o.key&&"ArrowUp"!==o.key||o.preventDefault(),["ArrowDown","ArrowUp","ArrowLeft","ArrowRight"].includes(o.key)&&null===i){const{value:e}=n;let t=0;for(;t<e.length;){if(!e[t].disabled){d.value=e[t].key;break}t+=1}}}else{const{value:e}=n;let l=e.findIndex((e=>e.key===i));if(!~l)return;if("Enter"===o.key)r(e[l]);else if("ArrowDown"===o.key)for(o.preventDefault(),l+=1;l<e.length;){if(!e[l].disabled){d.value=e[l].key;break}l+=1}else if("ArrowUp"===o.key)for(o.preventDefault(),l-=1;l>=0;){if(!e[l].disabled){d.value=e[l].key;break}l-=1}else if("ArrowLeft"===o.key){const n=e[l];if(n.isLeaf||!t.value.includes(i)){const e=n.getParent();e&&(d.value=e.key)}else a(n)}else if("ArrowRight"===o.key){const n=e[l];if(n.isLeaf)return;if(t.value.includes(i))for(l+=1;l<e.length;){if(!e[l].disabled){d.value=e[l].key;break}l+=1}else a(n)}}}}}({props:e,mergedSelectedKeysRef:F,fNodesRef:V,mergedExpandedKeysRef:U,handleSelect:Ee,handleSwitcherClick:Ae});let H=null,W=null;const X=v(new Set),Q=w((()=>e.internalHighlightKeySet||c.value.highlightKeySet)),Z=Y(Q,X),ee=v(new Set),ne=w((()=>U.value.filter((e=>!ee.value.has(e)))));let ae=0;const ie=v(null),le=v(null),de=v(null),se=v(null),ue=v(0),he=w((()=>{const{value:e}=le;return e?e.parent:null}));M(g(e,"data"),(()=>{ee.value.clear(),q.value=null,Ie()}),{deep:!1});let fe=!1;const ve=()=>{fe=!0,E((()=>{fe=!1}))};let pe;function be(n){return Ne(this,void 0,void 0,(function*(){const{onLoad:t}=e;if(!t)return z("tree","There is unloaded node in data but props.onLoad is not specified."),void(yield Promise.resolve());const{value:o}=ee;if(!o.has(n.key)){o.add(n.key);try{!1===(yield t(n.rawNode))&&Fe()}catch(r){Fe()}o.delete(n.key)}}))}M(g(e,"pattern"),((n,t)=>{if(e.showIrrelevantNodes)if(pe=void 0,n){const{expandedKeys:n,highlightKeySet:t}=Re(e.data,e.pattern,e.keyField,e.childrenField,s.value);X.value=t,ve(),De(n,Te(n),{node:null,action:"filter"})}else X.value=new Set;else if(n.length){t.length||(pe=U.value);const{expandedKeys:e}=c.value;void 0!==e&&(ve(),De(e,Te(e),{node:null,action:"filter"}))}else void 0!==pe&&(ve(),De(pe,Te(pe),{node:null,action:"filter"}))})),h((()=>{var e;const{value:n}=u;if(!n)return;const{getNode:t}=n;null===(e=U.value)||void 0===e||e.forEach((e=>{const n=t(e);n&&!n.shallowLoaded&&be(n)}))}));const me=v(!1),ke=v([]);M(ne,((n,t)=>{if(!e.animated||fe)return void E(Se);const o=new Set(t);let r=null,a=null;for(const e of n)if(!o.has(e)){if(null!==r)return;r=e}const l=new Set(n);for(const e of t)if(!l.has(e)){if(null!==a)return;a=e}if(null===r&&null===a)return;const{virtualScroll:s}=e,c=(s?d.value.listElRef:i.value).offsetHeight,h=Math.ceil(c/30)+1;let f;if(null!==r&&(f=t),null!==a&&(f=void 0===f?n:f.filter((e=>e!==a))),me.value=!0,ke.value=u.value.getFlattenedNodes(f),null!==r){const e=ke.value.findIndex((e=>e.key===r));if(~e){const t=ke.value[e].children;if(t){const o=te(t,n);ke.value.splice(e+1,0,{__motion:!0,mode:"expand",height:s?30*o.length:void 0,nodes:s?o.slice(0,h):o})}}}if(null!==a){const e=ke.value.findIndex((e=>e.key===a));if(~e){const t=ke.value[e].children;if(!t)return;me.value=!0;const o=te(t,n);ke.value.splice(e+1,0,{__motion:!0,mode:"collapse",height:s?30*o.length:void 0,nodes:s?o.slice(0,h):o})}}}));const xe=w((()=>re(V.value))),we=w((()=>me.value?ke.value:V.value));function Se(){const{value:e}=l;e&&e.sync()}function Te(e){const{getNode:n}=k.value;return e.map((e=>{var t;return(null===(t=n(e))||void 0===t?void 0:t.rawNode)||null}))}function De(n,t,o){const{"onUpdate:expandedKeys":r,onUpdateExpandedKeys:a}=e;$.value=n,r&&J(r,n,t,o),a&&J(a,n,t,o)}function Pe(n,t,o){const{"onUpdate:checkedKeys":r,onUpdateCheckedKeys:a}=e;R.value=n,a&&J(a,n,t,o),r&&J(r,n,t,o)}function Ke(n,t,o){const{"onUpdate:selectedKeys":r,onUpdateSelectedKeys:a}=e;I.value=n,a&&J(a,n,t,o),r&&J(r,n,t,o)}function Ie(){ie.value=null,Be()}function Be(){ue.value=0,le.value=null,de.value=null,se.value=null,Fe()}function Fe(){H&&(window.clearTimeout(H),H=null),W=null}function Me(n,t){if(e.disabled||Ce(n,e.disabledField))return;if(e.internalUnifySelectCheck&&!e.multiple)return void Ee(n);const o=t?"check":"uncheck",{checkedKeys:r,indeterminateKeys:a}=k.value[o](n.key,P.value,{cascade:e.cascade,checkStrategy:N.value,allowNotLoaded:e.allowCheckingNotLoaded});Pe(r,Te(r),{node:n.rawNode,action:o}),function(n,t){const{"onUpdate:indeterminateKeys":o,onUpdateIndeterminateKeys:r}=e;o&&J(o,n,t),r&&J(r,n,t)}(a,Te(a))}function Ae(n){e.disabled||me.value||function(n){if(e.disabled)return;const{key:t}=n,{value:o}=U,r=o.findIndex((e=>e===t));if(~r){const e=Array.from(o);e.splice(r,1),De(e,Te(e),{node:n.rawNode,action:"collapse"})}else{const r=u.value.getNode(t);if(!r||r.isLeaf)return;let a;if(e.accordion){const e=new Set(n.siblings.map((({key:e})=>e)));a=o.filter((n=>!e.has(n))),a.push(t)}else a=o.concat(t);De(a,Te(a),{node:n.rawNode,action:"expand"})}}(n)}function Ee(n){if(!e.disabled&&e.selectable){if(q.value=n.key,e.internalUnifySelectCheck){const{value:{checkedKeys:t,indeterminateKeys:o}}=L;e.multiple?Me(n,!(t.includes(n.key)||o.includes(n.key))):Pe([n.key],Te([n.key]),{node:n.rawNode,action:"check"})}if(e.multiple){const t=Array.from(F.value),o=t.findIndex((e=>e===n.key));~o?e.cancelable&&t.splice(o,1):~o||t.push(n.key),Ke(t,Te(t),{node:n.rawNode,action:~o?"unselect":"select"})}else{F.value.includes(n.key)?e.cancelable&&Ke([],[],{node:n.rawNode,action:"unselect"}):Ke([n.key],Te([n.key]),{node:n.rawNode,action:"select"})}}}function Oe({event:n,node:t},o=!0){var r;if(!e.draggable||e.disabled||Ce(t,e.disabledField))return;const{value:a}=ie;if(!a)return;const{allowDrop:i,indent:l}=e;o&&function(n){const{onDragover:t}=e;t&&J(t,n)}({event:n,node:t.rawNode});const d=n.currentTarget,{height:s,top:c}=d.getBoundingClientRect(),u=n.clientY-c;let h;h=i({node:t.rawNode,dropPosition:"inside",phase:"drag"})?u<=8?"before":u>=s-8?"after":"inside":u<=s/2?"before":"after";const{value:f}=xe;let v,p;const b=f(t.key);if(null===b)return void Be();let g=!1;"inside"===h?(v=t,p="inside"):"before"===h?t.isFirstChild?(v=t,p="before"):(v=V.value[b-1],p="after"):(v=t,p="after"),!v.isLeaf&&U.value.includes(v.key)&&(g=!0,"after"===p&&(v=V.value[b+1],v?p="before":(v=t,p="inside")));const y=v;if(de.value=y,!g&&a.isLastChild&&a.key===v.key&&(p="after"),"after"===p){let e=ae-n.clientX,t=0;for(;e>=l/2&&null!==v.parent&&v.isLastChild&&t<1;)e-=l,t+=1,v=v.parent;ue.value=t}else ue.value=0;if(!(a.contains(v)||"inside"===p&&(null===(r=a.parent)||void 0===r?void 0:r.key)===v.key)||a.key===y.key&&a.key===v.key)if(i({node:v.rawNode,dropPosition:p,phase:"drag"})){if(a.key===v.key)Fe();else if(W!==v.key)if("inside"===p){if(e.expandOnDragenter){if(function(e){if(H&&(window.clearTimeout(H),H=null),e.isLeaf)return;W=e.key;const n=()=>{if(W!==e.key)return;const{value:n}=de;if(n&&n.key===e.key&&!U.value.includes(e.key)){const n=U.value.concat(e.key);De(n,Te(n),{node:e.rawNode,action:"expand"})}H=null,W=null};H=e.shallowLoaded?window.setTimeout((()=>{n()}),1e3):window.setTimeout((()=>{be(e).then((()=>{n()}))}),1e3)}(v),!v.shallowLoaded&&W!==v.key)return void Ie()}else if(!v.shallowLoaded)return void Ie()}else Fe();else"inside"!==p&&Fe();se.value=p,le.value=v}else Be();else Be()}M(q,(n=>{var t,o;if(null!==n)if(e.virtualScroll)null===(t=d.value)||void 0===t||t.scrollTo({key:n});else if(e.internalScrollable){const{value:e}=l;if(null===e)return;const t=null===(o=e.contentRef)||void 0===o?void 0:o.querySelector(`[data-key="${ce(n)}"]`);if(!t)return;e.scrollTo({el:t})}})),A(ye,{loadingKeysRef:ee,highlightKeySetRef:Z,displayedCheckedKeysRef:P,displayedIndeterminateKeysRef:K,mergedSelectedKeysRef:F,mergedExpandedKeysRef:U,mergedThemeRef:a,mergedCheckStrategyRef:N,nodePropsRef:g(e,"nodeProps"),disabledRef:g(e,"disabled"),checkableRef:g(e,"checkable"),selectableRef:g(e,"selectable"),expandOnClickRef:g(e,"expandOnClick"),onLoadRef:g(e,"onLoad"),draggableRef:g(e,"draggable"),blockLineRef:g(e,"blockLine"),indentRef:g(e,"indent"),cascadeRef:g(e,"cascade"),checkOnClickRef:g(e,"checkOnClick"),checkboxPlacementRef:e.checkboxPlacement,droppingMouseNodeRef:de,droppingNodeParentRef:he,draggingNodeRef:ie,droppingPositionRef:se,droppingOffsetLevelRef:ue,fNodesRef:V,pendingNodeKeyRef:q,disabledFieldRef:g(e,"disabledField"),internalScrollableRef:g(e,"internalScrollable"),internalCheckboxFocusableRef:g(e,"internalCheckboxFocusable"),internalTreeSelect:e.internalTreeSelect,renderLabelRef:g(e,"renderLabel"),renderPrefixRef:g(e,"renderPrefix"),renderSuffixRef:g(e,"renderSuffix"),renderSwitcherIconRef:g(e,"renderSwitcherIcon"),labelFieldRef:g(e,"labelField"),multipleRef:g(e,"multiple"),handleSwitcherClick:Ae,handleDragEnd:function({event:n,node:t}){Ie(),!e.draggable||e.disabled||Ce(t,e.disabledField)||function(n){const{onDragend:t}=e;t&&J(t,n)}({event:n,node:t.rawNode})},handleDragEnter:function({event:n,node:t}){!e.draggable||e.disabled||Ce(t,e.disabledField)||(Oe({event:n,node:t},!1),function(n){const{onDragenter:t}=e;t&&J(t,n)}({event:n,node:t.rawNode}))},handleDragLeave:function({event:n,node:t}){!e.draggable||e.disabled||Ce(t,e.disabledField)||function(n){const{onDragleave:t}=e;t&&J(t,n)}({event:n,node:t.rawNode})},handleDragStart:function({event:n,node:t}){!e.draggable||e.disabled||Ce(t,e.disabledField)||(ae=n.clientX,ie.value=t,function(n){const{onDragstart:t}=e;t&&J(t,n)}({event:n,node:t.rawNode}))},handleDrop:function({event:n,node:t,dropPosition:o}){if(!e.draggable||e.disabled||Ce(t,e.disabledField))return;const{value:r}=ie,{value:a}=le,{value:i}=se;if(r&&a&&i&&e.allowDrop({node:a.rawNode,dropPosition:i,phase:"drag"})&&r.key!==a.key){if("before"===i){const e=r.getNext({includeDisabled:!0});if(e&&e.key===a.key)return void Be()}if("after"===i){const e=r.getPrev({includeDisabled:!0});if(e&&e.key===a.key)return void Be()}!function(n){const{onDrop:t}=e;t&&J(t,n)}({event:n,node:a.rawNode,dragNode:r.rawNode,dropPosition:o}),Ie()}},handleDragOver:Oe,handleSelect:Ee,handleCheck:Me});const ze={handleKeydown:G,scrollTo:function(e){var n;null===(n=d.value)||void 0===n||n.scrollTo(e)},getCheckedData:()=>{if(!e.checkable)return{keys:[],options:[]};const{checkedKeys:n}=L.value;return{keys:n,options:Te(n)}},getIndeterminateData:()=>{if(!e.checkable)return{keys:[],options:[]};const{indeterminateKeys:n}=L.value;return{keys:n,options:Te(n)}}},$e=w((()=>{const{common:{cubicBezierEaseInOut:e},self:{fontSize:n,nodeBorderRadius:t,nodeColorHover:o,nodeColorPressed:r,nodeColorActive:i,arrowColor:l,loadingColor:d,nodeTextColor:s,nodeTextColorDisabled:c,dropMarkColor:u}}=a.value;return{"--n-arrow-color":l,"--n-loading-color":d,"--n-bezier":e,"--n-font-size":n,"--n-node-border-radius":t,"--n-node-color-active":i,"--n-node-color-hover":o,"--n-node-color-pressed":r,"--n-node-text-color":s,"--n-node-text-color-disabled":c,"--n-drop-mark-color":u}})),je=t?S("tree",void 0,$e,e):void 0;return Object.assign(Object.assign({},ze),{mergedClsPrefix:n,mergedTheme:a,rtlEnabled:r,fNodes:we,aip:me,selfElRef:i,virtualListInstRef:d,scrollbarInstRef:l,handleFocusout:function(n){var t;if(e.virtualScroll||e.internalScrollable){const{value:e}=l;if(null===(t=null==e?void 0:e.containerRef)||void 0===t?void 0:t.contains(n.relatedTarget))return;q.value=null}else{const{value:e}=i;if(null==e?void 0:e.contains(n.relatedTarget))return;q.value=null}},handleDragLeaveTree:function(e){e.target===e.currentTarget&&Be()},handleScroll:function(){Se()},getScrollContainer:function(){var e;return null===(e=d.value)||void 0===e?void 0:e.listElRef},getScrollContent:function(){var e;return null===(e=d.value)||void 0===e?void 0:e.itemsElRef},handleAfterEnter:function(){me.value=!1,e.virtualScroll&&E(Se)},handleResize:function(){Se()},cssVars:t?void 0:$e,themeClass:null==je?void 0:je.themeClass,onRender:null==je?void 0:je.onRender})},render(){var e;const{fNodes:n,internalRenderEmpty:t}=this;if(!n.length&&t)return t();const{mergedClsPrefix:r,blockNode:a,blockLine:i,draggable:l,disabled:d,internalFocusable:s,checkable:c,handleKeydown:u,rtlEnabled:h,handleFocusout:f}=this,v=s&&!d,p=v?"0":void 0,b=[`${r}-tree`,h&&`${r}-tree--rtl`,c&&`${r}-tree--checkable`,(i||a)&&`${r}-tree--block-node`,i&&`${r}-tree--block-line`],g=e=>"__motion"in e?o(De,{height:e.height,nodes:e.nodes,clsPrefix:r,mode:e.mode,onAfterEnter:this.handleAfterEnter}):o(Te,{key:e.key,tmNode:e,clsPrefix:r});if(this.virtualScroll){const{mergedTheme:e,internalScrollablePadding:n}=this,t=ie(n||"0");return o(Z,{ref:"scrollbarInstRef",onDragleave:l?this.handleDragLeaveTree:void 0,container:this.getScrollContainer,content:this.getScrollContent,class:b,theme:e.peers.Scrollbar,themeOverrides:e.peerOverrides.Scrollbar,tabindex:p,onKeydown:v?u:void 0,onFocusout:v?f:void 0},{default:()=>{var e;return null===(e=this.onRender)||void 0===e||e.call(this),o(le,{ref:"virtualListInstRef",items:this.fNodes,itemSize:30,ignoreItemResize:this.aip,paddingTop:t.top,paddingBottom:t.bottom,class:this.themeClass,style:[this.cssVars,{paddingLeft:t.left,paddingRight:t.right}],onScroll:this.handleScroll,onResize:this.handleResize,showScrollbar:!1,itemResizable:!0},{default:({item:e})=>g(e)})}})}const{internalScrollable:y}=this;return b.push(this.themeClass),null===(e=this.onRender)||void 0===e||e.call(this),y?o(Z,{class:b,tabindex:p,onKeydown:v?u:void 0,onFocusout:v?f:void 0,style:this.cssVars,contentStyle:{padding:this.internalScrollablePadding}},{default:()=>o("div",{onDragleave:l?this.handleDragLeaveTree:void 0,ref:"selfElRef"},this.fNodes.map(g))}):o("div",{class:b,tabindex:p,ref:"selfElRef",style:this.cssVars,onKeydown:v?u:void 0,onFocusout:v?f:void 0,onDragleave:l?this.handleDragLeaveTree:void 0},n.length?n.map(g):X(this.$slots.empty,(()=>[o(de,{class:`${r}-tree__empty`,theme:this.mergedTheme.peers.Empty,themeOverrides:this.mergedTheme.peerOverrides.Empty})])))}});class Ie{constructor(e){n(this,"viewer"),n(this,"dataSource"),n(this,"options"),this.viewer=e,this.dataSource=new Map,this.options=new Map}async add(e,n){n.url=n;const t=n.feature,o=await Cesium.GeoJsonDataSource.load(e,{stroke:t.stroke||Cesium.Color.HOTPINK,strokeWidth:t.strokeWidth||3,fill:Cesium.Color.fromCssColorString(t.fill).withAlpha(.6)||Cesium.Color.PINK.withAlpha(.6),markerColor:Cesium.Color.fromCssColorString(t.markerColor)||Cesium.Color.PINK,clampToGround:t.clampToGround||!0});this.viewer.dataSources.add(o),this.dataSource.set(n.id,o),this.options.set(n.id,n),this.viewer.flyTo(o)}getLayerById(e){return this.dataSource.get(e)}delete(e){const n=this.getLayerById(e);n&&(this.viewer.dataSources.remove(n),this.options.delete(e))}setVisibleById(e,n){const t=this.getLayerById(e);t&&(t.show=n)}flyTo(e){const n=this.getLayerById(e);n&&this.viewer.flyTo(n)}getLoadedSource(){return this.options}}class Be{constructor(e){n(this,"viewer"),n(this,"dataSource"),n(this,"options"),this.viewer=e,this.dataSource=new Map,this.options=new Map}add(e,n){const{longitude:t,latitude:o,altitude:r}=n.position,a=Cesium.Transforms.eastNorthUpToFixedFrame(Cesium.Cartesian3.fromDegrees(t,o,0)),i=Cesium.Model.fromGltf({url:e,modelMatrix:a,scale:n.scale||100,heightReference:n.heightReference});this.viewer.scene.primitives.add(i),i.readyPromise.then((()=>{this.dataSource.set(n.id,i),this.options.set(n.id,n),this.flyTo(n.id)})).catch((e=>{}))}getModelById(e){return this.dataSource.get(e)}delete(e){const n=this.getModelById(e);n&&(this.viewer.scene.primitives.remove(n),this.options.delete(e))}setVisibleById(e,n){const t=this.getModelById(e);t&&(t.show=n)}flyTo(e){const n=this.getModelById(e);if(!n)return;const t=n.boundingSphere;this.viewer.camera.flyToBoundingSphere(t)}getLoadedSource(){return this.options}}const Fe={arcGisMapServer:function(e){return new Cesium.ArcGisMapServerImageryProvider({url:e,enablePickFeatures:!1})},bingMap:function(e,n){return new Cesium.BingMapsImageryProvider({url:e,key:n.key,mapStyle:Cesium.BingMapsStyle.AERIAL})},tileMapServer:function(e){return new Cesium.TileMapServiceImageryProvider({url:e})},mapBox:function(e,n){return e=Cesium.defaultValue(e,"https://api.mapbox.com/v4/"),n.mapId=Cesium.defaultValue(n.mapId,"mapbox.streets"),new Cesium.MapboxImageryProvider({mapId:"mapbox.satellite",accessToken:"pk.eyJ1IjoibGlhbS13dSIsImEiOiJja2lqeTJwY2owMjhhMnpxbGcwODh5ZGhoIn0.fLOknIfMlTVbjkkh9dmYbg"})},singleTile:function(e,n){return n.rectangle=Cesium.defaultValue(n.rectangle,Cesium.Rectangle.fromDegrees(-180,-90,180,90)),new Cesium.SingleTileImageryProvider({url:e,rectangle:n.rectangle})},urlTemplate:function(e){return new Cesium.UrlTemplateImageryProvider({url:e})},webMapService:function(e,n){return new Cesium.WebMapServiceImageryProvider({url:e,layers:n.laers,parameters:n.parameters})},webMapTileService:function(e,n){return new Cesium.WebMapTileServiceImageryProvider({url:e,layer:n.layer,style:n.style,tileMatrixSetID:n.tileMatrixSetID,format:n.format,maximumLevel:n.maximumLevel})}};class Me{constructor(e){n(this,"viewer"),n(this,"dataSource"),n(this,"options"),this.viewer=e,this.dataSource=new Map,this.options=new Map}add(e,n){if(!n.imageryType)throw new Error("æªéæ©å½±åæå¡ç±»åï¼");n.url=n;const t=n.imageryType,o=Fe[t],r=new Cesium.ImageryLayer(o(e,n));this.viewer.imageryLayers.add(r),this.dataSource.set(n.id,r),this.options.set(n.id,n),this.viewer.flyTo(r)}getLayerById(e){return this.dataSource.get(e)}delete(e){const n=this.getLayerById(e);n&&(this.viewer.imageryLayers.remove(n),this.options.delete(e),window.$message.success("å½±åæå¡å é¤æåï¼"))}setVisibleById(e,n){const t=this.getLayerById(e);t&&(t.show=n)}flyTo(e){const n=this.getLayerById(e);n&&this.viewer.flyTo(n)}getLoadedSource(){return this.options}}class Ae{constructor(e){n(this,"viewer"),n(this,"dataSource"),n(this,"options"),this.viewer=e,this.dataSource=new Map,this.options=new Map}async add(e,n){n.url=n;const t=await this.getFeatures(e),o=this.createCollectioon(t,n);this.viewer.scene.primitives.add(o),this.dataSource.set(n.id,o),this.options.set(n.id,n),this.flyTo(n.id)}async getFeatures(e){var n;try{const t=await V.get(e);return(null==(n=null==t?void 0:t.data)?void 0:n.features)||[]}catch(t){}}createCollectioon(e,n){const t=new Cesium.BillboardCollection({scene:this.viewer.scene});return e.forEach((async e=>{const o=e.geometry.coordinates,r=await $.imageOverlayText(n.special.icon,e.properties[n.special.label]);t.add({position:Cesium.Cartesian3.fromDegrees(...o),image:r,scale:.6,width:n.special.size,disableDepthTestDistance:Number.POSITIVE_INFINITY,heightReference:Cesium.HeightReference.RELATIVE_TO_GROUND})})),t}getLayerById(e){return this.dataSource.get(e)}delete(e){const n=this.getLayerById(e);n&&(this.viewer.scene.primitives.remove(n),this.options.delete(e))}setVisibleById(e,n){const t=this.getLayerById(e);t&&(t.show=n)}flyTo(e){const n=this.getLayerById(e);if(!n)return;const t=n._billboards.map((e=>e.position)),o=Cesium.Rectangle.fromCartesianArray(t);this.viewer.camera.flyTo({destination:o})}getLoadedSource(){return this.options}}function Ee(){return new Cesium.EllipsoidTerrainProvider}class Oe{constructor(e){n(this,"viewer"),n(this,"terrainProvider"),n(this,"visible"),n(this,"options"),this.viewer=e,this.terrainProvider=Ee(),this.visible=!1,this.options=null}add(e,n={}){n.url=e;const t=Cesium.defaultValue(n.terrainType,_.ellipsoidTerrain);t===_.ellipsoidTerrain?this.terrainProvider=Ee():t===_.cesiumTerrain?this.terrainProvider=function(e,n){return new Cesium.CesiumTerrainProvider({url:e,requestVertexNormals:n.requestVertexNormals})}(e,n):t===_.worldTerrain&&(this.terrainProvider=function(e){return Cesium.createWorldTerrain({requestVertexNormals:null==e?void 0:e.requestVertexNormals,requestWaterMask:null==e?void 0:e.requestWaterMask})}(n)),this.viewer.terrainProvider=this.terrainProvider,this.options=n}show(e){if(e!==this.visible){const n=new Cesium.EllipsoidTerrainProvider;this.viewer.terrainProvider=e?this.terrainProvider:n,this.visible=e}}delete(){const e=new Cesium.EllipsoidTerrainProvider;this.viewer.terrainProvider=e}flyTo(){}getLoadedSource(){return this.options}}class ze{constructor(e){n(this,"viewer"),n(this,"dataSource"),n(this,"options"),this.viewer=e,this.dataSource=new Map,this.options=new Map}add(e,n){const t=new Cesium.Cesium3DTileset({url:e,maximumMemoryUsage:n.maximumMemoryUsage||128,maximumScreenSpaceError:n.maximumScreenSpaceError||64});this.viewer.scene.primitives.add(t),t.readyPromise.then((()=>{this.dataSource.set(n.id,t),this.options.set(n.id,n),this.viewer.flyTo(t)})).catch((e=>{}))}getTilesetById(e){return this.dataSource.get(e)}delete(e){const n=this.getTilesetById(e);n&&(this.viewer.scene.primitives.remove(n),this.options.delete(e))}setVisibleById(e,n){const t=this.getTilesetById(e);t&&(t.show=n)}flyTo(e){const n=this.getTilesetById(e);n&&this.viewer.flyTo(n)}getLoadedSource(){return this.options}}class $e{constructor(e){n(this,"imageryLayerManager"),n(this,"tilesetLayerManager"),n(this,"gltfModelManager"),n(this,"terrainManager"),n(this,"featureLayerManager"),n(this,"specialLayerManager"),this.imageryLayerManager=new Me(e),this.tilesetLayerManager=new ze(e),this.gltfModelManager=new Be(e),this.terrainManager=new Oe(e),this.featureLayerManager=new Ie(e),this.specialLayerManager=new Ae(e)}get typeManager(){return{[U.IMAGE_SERVICE]:this.imageryLayerManager,[U.TERRAIN_SERVICE]:this.terrainManager,[U.TILE_SET]:this.tilesetLayerManager,[U.GLTF_MODEL]:this.gltfModelManager,[U.FEATURE]:this.featureLayerManager,[U.SPECIAL_SUBJECT]:this.specialLayerManager}}addSource(e,n,t){this.typeManager[n].add(e,t)}deleteSource(e,n){this.typeManager[n].delete(e)}flyTo(e,n){this.typeManager[n].flyTo(e)}getTypeDataSource(){return Object.keys(this.typeManager).map((e=>this.typeManager[e].getLoadedSource()))}}const je=Symbol("mapViewer"),_e="_resourceTree_rblci_38",Ue=t({name:"ResourceTree",setup(){const e=H(),n=v(null),{stateRef:t,nodeProps:o}=q(),r=b(je),a=new $e(r.value);e.saveCesiumSourceLoader(a);const i=e=>{"ADD"===e?n.value.openModal(t.rightObj.key):"DELETE"===e?s():"FLY_TO"===e&&c(),t.showDropdown=!1},l=()=>{t.showDropdown=!1},d=({url:e,type:n,options:o})=>{a.addSource(e,n,o);const r=t.treeData.find((e=>e.key===n));null==r||r.children.push({label:o.name,key:o.id,isLeaf:!0,parentType:n})},s=()=>{const{key:e,parentType:n}=t.rightObj;a.deleteSource(e,n);const o=t.treeData.find((e=>e.key===n)),r=null==o?void 0:o.children.findIndex((n=>n.key===e));!r||r<0||null==o||o.children.splice(r,1)},c=()=>{const{key:e,parentType:n}=t.rightObj;a.flyTo(e,n)};return()=>j("div",{class:_e},[j(Ke,{data:t.treeData,"node-props":o,checkable:!0,"expand-on-click":!0,"default-expand-all":!0,selectable:!0},null),j(se,{trigger:"manual",placement:"bottom-start",show:t.showDropdown,options:t.options,x:t.x,y:t.y,onSelect:i,onClickoutside:l},null),j(G,{ref:n,onLoadMapSource:d},null)])}}),Ve=Object.freeze(Object.defineProperty({__proto__:null,default:Ue},Symbol.toStringTag,{value:"Module"}));export{Ue as R,Ve as i,je as v};
//# sourceMappingURL=index-046ecdbc.js.map
