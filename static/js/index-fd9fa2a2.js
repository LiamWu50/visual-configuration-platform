var e=Object.defineProperty,t=(t,n,i)=>(((t,n,i)=>{n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[n]=i})(t,"symbol"!=typeof n?n+"":n,i),i);import{d as n,k as i,Y as l,y as o,B as s,s as r,v as a,H as u,m as c,K as d,A as p,h as f,ad as v,I as m,ae as h,F as y}from"./index-7a6fe53c.js";import{u as g}from"./index-5c934fc2.js";import{l as x}from"./lodash-800f6cfd.js";import{u as b}from"./use-message-af2c3ba0.js";const S=new class{constructor(){t(this,"events",{})}on(e,t){this.events[e]||(this.events[e]=[]),this.events[e].includes(t)||this.events[e].push(t)}off(e,t){const n=this.events[e];n&&(this.events[e]=n.filter((e=>e!==t)))}emit(e,t){const n=this.events[e];if(n&&n.length>0)for(const i of n)i(t)}once(e,t){const n=i=>{t(i),this.off(e,n)};this.on(e,n)}};function w(e){return{top:e.top,left:e.left,right:e.left+e.width,bottom:e.top+e.height}}const _="_markLine_18mj9_1",N="_line_18mj9_5",C="_xline_18mj9_11",P="_yline_18mj9_16",D=n({name:"AuxiliaryLine",setup(){const e=g(),t=i([]),n=["xt","xc","xb","yl","yc","yr"],u=i(3),c=l({xt:!1,xc:!1,xb:!1,yl:!1,yc:!1,yr:!1}),d=e=>{t.value.push(e)};o((()=>{S.on("move",(({isDownward:e,isRightward:t})=>{f(e,t)})),S.on("unmove",(()=>{p()})),f(!1,!1)}));const p=()=>{Object.keys(c).forEach((e=>{c[e]=!1}))},f=(n,i)=>{const{primitives:l}=e,o=e.curPrimitive;if(!o)return;const{top:s,left:r,right:a,bottom:u}=w(o.style),c=(a-r)/2,d=(u-s)/2;p(),l.forEach((e=>{if(e==o)return;const l=w(e.style),{top:p,left:f,bottom:h,right:y}=l,g=(y-f)/2,x=(h-p)/2,b={top:[{isNearly:m(s,p),lineNode:t.value[0],line:"xt",dragShift:p,lineShift:p},{isNearly:m(u,p),lineNode:t.value[0],line:"xt",dragShift:p-(u-s||0),lineShift:p},{isNearly:m((s||0)+d,p+x),lineNode:t.value[1],line:"xc",dragShift:p+x-d,lineShift:p+x},{isNearly:m(s,h),lineNode:t.value[2],line:"xb",dragShift:h,lineShift:h},{isNearly:m(u,h),lineNode:t.value[2],line:"xb",dragShift:h-(u-s||0),lineShift:h}],left:[{isNearly:m(r,f),lineNode:t.value[3],line:"yl",dragShift:f,lineShift:f},{isNearly:m(a,f),lineNode:t.value[3],line:"yl",dragShift:f-(a-r||0),lineShift:f},{isNearly:m((r||0)+c,f+g),lineNode:t.value[4],line:"yc",dragShift:f+g-c,lineShift:f+g},{isNearly:m(r,y),lineNode:t.value[5],line:"yr",dragShift:y,lineShift:y},{isNearly:m(a,y),lineNode:t.value[5],line:"yr",dragShift:y-(a-r||0),lineShift:y}]},S=[];Object.keys(b).forEach((e=>{b[e].forEach((t=>{t.isNearly&&(o.updateStyleByKey(e,t.dragShift),t.lineNode.style[e]=`${t.lineShift}px`,S.push(t.line))}))})),S.length&&v(S,n,i)}))},v=(e,t,n)=>{n?e.includes("yr")?c.yr=!0:e.includes("yc")?c.yc=!0:e.includes("yl")&&(c.yl=!0):e.includes("yl")?c.yl=!0:e.includes("yc")?c.yc=!0:e.includes("yr")&&(c.yr=!0),t?e.includes("xb")?c.xb=!0:e.includes("xc")?c.xc=!0:e.includes("xt")&&(c.xt=!0):e.includes("xt")?c.xt=!0:e.includes("xc")?c.xc=!0:e.includes("xb")&&(c.xb=!0)},m=(e,t)=>Math.abs(e-t)<=u.value;return()=>s("div",{class:_},[n.map((e=>r(s("div",{key:e,ref:d,class:`${N} ${e.includes("x")?C:P}`},null),[[a,c[e]]])))])}});const j="_boundBox_c2v03_1",M="_active_c2v03_8",k="_point_c2v03_13";const E=n({name:"BoundBox",props:{primitive:{type:Object,default:()=>{}},pStyle:{type:Object,default:()=>{}},index:{required:!0,type:Number,default:0}},emits:["closeContextmenu"],setup(e,{slots:t,emit:n}){const l=g(),{curPrimitive:r}=u(l),{curRef:a,cursors:d,angleToCursor:p,drawPoints:f}={curRef:i(null),cursors:i({}),angleToCursor:[{start:338,end:23,cursor:"nw"},{start:23,end:68,cursor:"n"},{start:68,end:113,cursor:"ne"},{start:113,end:158,cursor:"e"},{start:158,end:203,cursor:"se"},{start:203,end:248,cursor:"s"},{start:248,end:293,cursor:"sw"},{start:293,end:338,cursor:"w"}],drawPoints:{lt:0,t:45,rt:90,r:135,rb:180,b:225,lb:270,l:315}},v=t=>{const{width:n=0,height:i=0}=e.pStyle,l=t.includes("t"),o=t.includes("b"),s=t.includes("l"),r=t.includes("r");let a=s?0:n,u=l?0:i;return!l&&!o||s||r?l||o||!s&&!r||(a=s?0:n,u=Math.floor(i/2)):(a=n/2,u=l?0:i),{marginLeft:"-4px",marginTop:"-4px",left:`${a}px`,top:`${u}px`,cursor:d.value[t]}},m=()=>{const e={};let t=-1;for(const n in f){const i=(f[n]+360)%360;for(let l=0;l<p.length;l++){t=(t+1)%p.length;const l=p[t];if(i<23||i>=338){e[n]="nw-resize";break}if(l.start<=i&&i<l.end){e[n]=l.cursor+"-resize";break}}}return e},h=t=>{t.stopPropagation(),t.preventDefault(),l.setClickPrimitiveStatus(!0),l.setCurPrimitive(e.primitive),d.value=m();const n=e.pStyle,i=t.clientY,o=t.clientX,s=n.top||0,r=n.left||0,a=t=>{const n=t.clientX,l=t.clientY,a={top:x.ceil(t.clientY-i+s),left:x.ceil(t.clientX-o+r)};e.primitive.updateStyle(a);const u=l-i>0,c=n-o>0;S.emit("move",{isDownward:u,isRightward:c})},u=()=>{S.emit("unmove"),document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",u)};document.addEventListener("mousemove",a),document.addEventListener("mouseup",u)};o((()=>{r.value&&(d.value=m())}));const y=e=>{e.stopPropagation(),e.preventDefault(),n("closeContextmenu")},b=c((()=>{var t;return(null==(t=r.value)?void 0:t.id)===e.primitive.id})),w=()=>Object.keys(f).map((t=>s("div",{key:t,class:k,style:v(t),onMousedown:n=>((t,n)=>{n.stopPropagation(),n.preventDefault();const{pStyle:i}=e,{height:l=0,width:o=0,top:s=0,left:r=0}=i,a=n.clientX,u=n.clientY,c=e=>{const n=e.clientX,c=e.clientY-u,d=n-a,p=/t/.test(t),f=/b/.test(t),v=/l/.test(t),m=/r/.test(t),h=l+(p?-c:f?c:0),y=o+(v?-d:m?d:0);Object.assign(i,{height:Math.max(h,0),width:Math.max(y,0),left:r+(v?d:0),top:s+(p?c:0)})},d=()=>{document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",d)};document.addEventListener("mousemove",c),document.addEventListener("mouseup",d)})(t,n)},null)));return()=>{var e;return s("div",{ref:a,class:[j,b.value&&M],onClick:y,onMousedown:h},[b.value?w():null,null==(e=t.default)?void 0:e.call(t)])}}}),L="_contextmenu_1ltzl_1",O=n({name:"ContextMenu",setup(e,{expose:t}){const n=b(),o=g(),{curPrimitive:p}=u(o),f=l({visible:i(!1),top:i(0),left:i(0),copyData:i(null)}),v=()=>{o.setClickPrimitiveStatus(!0)},m=()=>{if(!f.copyData)return void n.warning("请选择组件！");const e=f.copyData;e.style.top=f.top,e.style.left=f.left,o.addPrimitive(e)},h=()=>{o.clear()},y={"复制":()=>{const e=x.cloneDeep(p.value);e.id=d.createId(),f.copyData=e,n.success("复制成功！")},"粘贴":m,"删除":()=>{o.deleteCurPrimitive(),n.success("删除成功！")},"置顶":()=>{o.upCurComponent()},"置底":()=>{o.downCurComponent()},"上移":()=>{o.moveCurPrimitiveByIndex(1)},"下移":()=>{o.moveCurPrimitiveByIndex(-1)}},S=c((()=>p.value?y:{"粘贴":m,"清空画布":h}));return t({show:({top:e,left:t})=>{f.top=e,f.left=t,f.visible=!0},close:()=>{f.visible=!1}}),()=>r(s("div",{class:L,style:{top:`${f.top}px`,left:`${f.left}px`}},[s("ul",{onMouseup:v},[Object.entries(S.value).map((([e,t])=>s("li",{onClick:t},[e])))])]),[[a,f.visible]])}}),B=n({name:"Grid",render:()=>s("svg",{style:{position:"absolute",top:0,left:0},width:"100%",height:"100%",xmlns:"http://www.w3.org/2000/svg"},[s("defs",null,[s("pattern",{id:"smallGrid",width:"7.236328125",height:"7.236328125",patternUnits:"userSpaceOnUse"},[s("path",{d:"M 7.236328125 0 L 0 0 0 7.236328125",fill:"none",stroke:"rgba(207, 207, 207, 0.3)","stroke-width":"1"},null)]),s("pattern",{id:"grid",width:"36.181640625",height:"36.181640625",patternUnits:"userSpaceOnUse"},[s("rect",{width:"36.181640625",height:"36.181640625",fill:"url(#smallGrid)"},null),s("path",{d:"M 36.181640625 0 L 0 0 0 36.181640625",fill:"none",stroke:"rgba(186, 186, 186, 0.5)","stroke-width":"1"},null)])]),s("rect",{width:"100%",height:"100%",fill:"url(#grid)"},null)])}),Y="_editor_1iuos_1",X="_primitive_1iuos_8";const I=n({name:"Editor",components:{Grid:B,ContextMenu:O},setup(){const e=g(),t=e.primitives,n=i(null),l=i(null);p("AUXILIARY_LINE_KEY",l);const o=t=>{e.setClickPrimitiveStatus(!1)},r=t=>{var i;e.isClickPrimitive||e.setCurPrimitive(null),2!=t.button&&(null==(i=n.value)||i.close())},a=e=>{var t;if(e.stopPropagation(),e.preventDefault(),!e.target)return;let i=e.target,l=e.offsetY,o=e.offsetX;for(;i instanceof SVGElement;)i=i.parentNode;for(;"editor"!==i.id;)o+=i.offsetLeft,l+=i.offsetTop,i=i.parentNode;null==(t=n.value)||t.show({top:l,left:o})},u=()=>{var e;null==(e=n.value)||e.close()},{getBoundBoxStyle:c}={getBoundBoxStyle:e=>{const t={};for(const[n,i]of Object.entries(e))i&&(t[n]=i+"px");return t},getPrimitiveStyle:e=>{const t={};for(const[n,i]of Object.entries(e))i&&(t[n]=i+"px");return t}},d=()=>t.map(((e,t)=>{let n;return s(E,{index:t,style:c(e.style),primitive:e,pStyle:e.style,onCloseContextmenu:u},"function"==typeof(i=n=f(v(e.cName),{id:"primitive"+e.id,class:X,dataSource:e}))||"[object Object]"===Object.prototype.toString.call(i)&&!m(i)?n:{default:()=>[n]});var i}));return()=>s("div",{id:"editor",class:Y,onMousedown:o,onMouseup:r,onContextmenu:a},[s(B,null,null),s(D,null,null),s(O,{ref:n},null),d()])}}),U="_container_79xjy_1",$=n({name:"Container",components:{Editor:I},setup(){const{...e}=(()=>{const e=g();return{handleDrop:t=>{t.preventDefault(),t.stopPropagation();const n=t.dataTransfer.getData("name"),i=document.querySelector("#editor").getBoundingClientRect(),l=new h[n],o={top:x.ceil(t.clientY-i.y),left:x.ceil(t.clientX-i.x)};l.updateStyle(o),e.addPrimitive(l)},handleDragOver:e=>{e.preventDefault(),e.dataTransfer.dropEffect="copy"},handleMouseDown:e=>{e.stopPropagation()},handleMouseUp:()=>{}}})();return{...e}},render(){return s(y,null,[s("div",{class:U,onDrop:this.handleDrop,onDragover:this.handleDragOver,onMousedown:this.handleMouseDown,onMouseup:this.handleMouseUp},[s(I,null,null)])])}});export{$ as default};
//# sourceMappingURL=index-fd9fa2a2.js.map
