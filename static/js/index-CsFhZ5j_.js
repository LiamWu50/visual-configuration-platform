var e=Object.defineProperty,t=(t,l,n)=>(((t,l,n)=>{l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[l]=n})(t,"symbol"!=typeof l?l+"":l,n),n);import{P as l,k as n,d as o,m as r,B as i,M as a,z as s,s as c,v as u,C as d,y as h,Q as p,R as m,H as v,S as f,w as g,I as y,U as b,V as w,W as S,x as A,F as N,X as C,Y as x,Z as R,$ as E,a0 as B,O as X,a1 as Y,J as k,h as D,a2 as L}from"./index-BRKk6EXp.js";import{u as M}from"./index-DTzfzobO.js";import{c as O,u as P,m as I,d as U,a as j,g as T,S as Q,b as V,e as F}from"./index-DDekmmIk.js";import{l as G}from"./lodash-CoRv4Q0p.js";import{u as _}from"./index-7O5StCSv.js";import"./index-Cpr7J-RH.js";import"./map-base-CuBYy-bs.js";import"./use-cesium-source-loader-D1jOYCqB.js";import"./index-B2aN6fJe.js";import"./axios-X0xcXtXw.js";import"./index-BJ5hlcPD.js";const q=l("areaSelect",(()=>{const e=n(null),t=n([]),l=n(!1);return{groupStyle:e,selectedPrimitives:t,areaSelectVisible:l,clearPrimitives:()=>{t.value=[]},setAreaSelectOptions:(l,n)=>{e.value=l,t.value=n},setAreaSelectVisible:e=>{l.value=e}}})),K="_areaSelect_lm1me_38",z=o({name:"AreaSelect",props:{options:{type:Object,default:()=>{}}},setup:e=>({style:r((()=>({left:e.options.start.x+"px",top:e.options.start.y+"px",width:e.options.width+"px",height:e.options.height+"px"})))}),render(){return i("div",{style:this.style,class:K},null)}});const W=new class{constructor(){t(this,"events",{})}on(e,t){this.events[e]||(this.events[e]=[]),this.events[e].includes(t)||this.events[e].push(t)}off(e,t){const l=this.events[e];l&&(this.events[e]=l.filter((e=>e!==t)))}emit(e,t){const l=this.events[e];if(l&&l.length>0)for(const n of l)n(t)}once(e,t){const l=n=>{t(n),this.off(e,l)};this.on(e,l)}},H="_markLine_1bccj_38",Z="_line_1bccj_42",J="_xline_1bccj_48",$="_yline_1bccj_53",ee=o({name:"AuxiliaryLine",setup(){const e=M(),t=n([]),l=["xt","xc","xb","yl","yc","yr"],o=n(3),r=a({xt:!1,xc:!1,xb:!1,yl:!1,yc:!1,yr:!1}),d=e=>{t.value.push(e)},h=()=>{Object.keys(r).forEach((e=>{r[e]=!1}))},p=(l,n)=>{const{primitives:o}=e,r=e.curPrimitive;if(!r)return;const{top:i,left:a,right:s,bottom:c}=O(r.style),u=(s-a)/2,d=(c-i)/2;h(),o.forEach((e=>{if(e==r)return;const o=O(e.style),{top:h,left:p,bottom:f,right:g}=o,y=(g-p)/2,b=(f-h)/2,w={top:[{isNearly:v(i,h),lineNode:t.value[0],line:"xt",dragShift:h,lineShift:h},{isNearly:v(c,h),lineNode:t.value[0],line:"xt",dragShift:h-(c-i||0),lineShift:h},{isNearly:v((i||0)+d,h+b),lineNode:t.value[1],line:"xc",dragShift:h+b-d,lineShift:h+b},{isNearly:v(i,f),lineNode:t.value[2],line:"xb",dragShift:f,lineShift:f},{isNearly:v(c,f),lineNode:t.value[2],line:"xb",dragShift:f-(c-i||0),lineShift:f}],left:[{isNearly:v(a,p),lineNode:t.value[3],line:"yl",dragShift:p,lineShift:p},{isNearly:v(s,p),lineNode:t.value[3],line:"yl",dragShift:p-(s-a||0),lineShift:p},{isNearly:v((a||0)+u,p+y),lineNode:t.value[4],line:"yc",dragShift:p+y-u,lineShift:p+y},{isNearly:v(a,g),lineNode:t.value[5],line:"yr",dragShift:g,lineShift:g},{isNearly:v(s,g),lineNode:t.value[5],line:"yr",dragShift:g-(s-a||0),lineShift:g}]},S=[];Object.keys(w).forEach((e=>{w[e].forEach((t=>{t.isNearly&&(r.updateStyleByKey(e,t.dragShift),t.lineNode.style[e]=`${t.lineShift}px`,S.push(t.line))}))})),m(S,l,n)}))},m=(e,t,l)=>{l?e.includes("yr")?r.yr=!0:e.includes("yc")?r.yc=!0:e.includes("yl")&&(r.yl=!0):e.includes("yl")?r.yl=!0:e.includes("yc")?r.yc=!0:e.includes("yr")&&(r.yr=!0),t?e.includes("xb")?r.xb=!0:e.includes("xc")?r.xc=!0:e.includes("xt")&&(r.xt=!0):e.includes("xt")?r.xt=!0:e.includes("xc")?r.xc=!0:e.includes("xb")&&(r.xb=!0)},v=(e,t)=>Math.abs(e-t)<=o.value;return s((()=>{W.on("move",(({isDownward:e,isRightward:t})=>{p(e,t)})),W.on("unmove",(()=>{h()})),p(!1,!1)})),()=>i("div",{class:H},[l.map((e=>c(i("div",{key:e,ref:d,class:`${Z} ${e.includes("x")?J:$}`},null),[[u,r[e]]])))])}}),te="_boundBox_55foi_38",le="_active_55foi_46",ne="_point_55foi_52";const oe=o({name:"BoundBox",props:{primitive:{type:Object,default:()=>{}},pStyle:{type:Object,default:()=>{}},index:{required:!0,type:Number,default:0}},emits:["closeContextmenu"],setup(e,{slots:t,emit:l}){const o=M(),a=q(),{curPrimitive:s}=d(o),{areaSelectVisible:c}=d(a),{transByCurScale:u}=P(),{curRef:p,cursors:m,angleToCursor:v,drawPoints:f,pointStyle:g}=function(){const e=n(null),t=n({});return{curRef:e,cursors:t,angleToCursor:[{start:338,end:23,cursor:"nw"},{start:23,end:68,cursor:"n"},{start:68,end:113,cursor:"ne"},{start:113,end:158,cursor:"e"},{start:158,end:203,cursor:"se"},{start:203,end:248,cursor:"s"},{start:248,end:293,cursor:"sw"},{start:293,end:338,cursor:"w"}],drawPoints:{lt:0,t:45,rt:90,r:135,rb:180,b:225,lb:270,l:315},pointStyle:(e,l)=>{const{width:n=0,height:o=0}=l,r=e.includes("t"),i=e.includes("b"),a=e.includes("l"),s=e.includes("r");let c=a?0:n,u=r?0:o;return!r&&!i||a||s?r||i||!a&&!s||(c=a?0:n,u=Math.floor(o/2)):(c=n/2,u=r?0:o),{marginLeft:"-4px",marginTop:"-4px",left:`${c}px`,top:`${u}px`,cursor:t.value[e]}}}}(),y=()=>{const e={};let t=-1;for(const l in f){const n=I(f[l]);for(let o=0;o<v.length;o++){t=(t+1)%v.length;const o=v[t];if(n<23||n>=338){e[l]="nw-resize";break}if(o.start<=n&&n<o.end){e[l]=o.cursor+"-resize";break}}}return e},b=t=>{if(t.stopPropagation(),t.preventDefault(),c.value)return;o.setClickPrimitiveStatus(!0),o.setCurPrimitive(e.primitive),m.value=y();const l=e.pStyle,n=t.clientY,r=t.clientX,i=l.top||0,a=l.left||0,s=t=>{const l=t.clientX,o=t.clientY,s=u(t.clientY-n)+i,c=u(t.clientX-r)+a;e.primitive.updateStyle({top:G.ceil(s),left:G.ceil(c)});const d=o-n>0,h=l-r>0;W.emit("move",{isDownward:d,isRightward:h})},d=()=>{W.emit("unmove"),document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",d)};document.addEventListener("mousemove",s),document.addEventListener("mouseup",d)};h((()=>{s.value&&(m.value=y())}));const w=e=>{e.stopPropagation(),e.preventDefault(),l("closeContextmenu")},S=r((()=>{var t;return(null==(t=s.value)?void 0:t.id)===e.primitive.id})),A=()=>Object.keys(f).map((t=>i("div",{key:t,class:ne,style:g(t,e.pStyle),onMousedown:l=>((t,l)=>{l.stopPropagation(),l.preventDefault();const{pStyle:n}=e,{height:o=0,width:r=0,top:i=0,left:a=0}=n,s=l.clientX,c=l.clientY,d=e=>{const l=e.clientX,d=e.clientY-c,h=l-s,p=/t/.test(t),m=/b/.test(t),v=/l/.test(t),f=/r/.test(t),g=o+u(p?-d:m?d:0),y=r+u(v?-h:f?h:0);Object.assign(n,{height:Math.max(Number(g.toFixed(0)),0),width:Math.max(Number(y.toFixed(0)),0),left:a+(v?h:0),top:i+(p?d:0)})},h=()=>{document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",h)};document.addEventListener("mousemove",d),document.addEventListener("mouseup",h)})(t,l)},null)));return()=>{var e;return i("div",{ref:p,class:[te,S.value&&le],onClick:w,onMousedown:b},[S.value?A():null,null==(e=t.default)?void 0:e.call(t)])}}}),re="_contextmenu_sanc5_38";const ie=()=>{const e=a({top:n(0),left:n(0),copyData:n(null)}),t=M(),{curPrimitive:l}=d(t),{handleCompose:o,handleDecompose:r}=function(){const e=M(),t=q(),{curPrimitive:l}=d(e),{groupStyle:n,selectedPrimitives:o}=d(t);return{handleCompose:()=>{const l=[],r=o.value,i=document.querySelector("#editor").getBoundingClientRect();r.forEach((e=>{var t;if("Group"===e.cName){const n={...e.style};null==(t=e.childPrimitives)||t.forEach((e=>{U(e,i,n),l.push(e)}))}else l.push(e)}));const a=o.value,s=new p;s.childPrimitives=l,s.style={...n.value},j(s),e.addPrimitive(s),e.setCurPrimitive(s),e.batchDeletePrimitive(a),t.setAreaSelectVisible(!1),t.clearPrimitives()},handleDecompose:()=>{var t,n;const o={...null==(t=l.value)?void 0:t.style},r=null==(n=l.value)?void 0:n.childPrimitives,i=document.querySelector("#editor"),a=null==i?void 0:i.getBoundingClientRect();e.deleteCurPrimitive(),r.forEach((t=>{U(t,a,o),e.addPrimitive(t)}))}}}();return{menuState:e,operations:{handleCopy:()=>{const t=G.cloneDeep(l.value);t.id=m.createId(),e.copyData=t,window.$message.success("复制成功！")},handlePaste:()=>{if(!e.copyData)return void window.$message.warning("请选择组件！");const l=e.copyData;l.style.top=e.top,l.style.left=e.left,t.addPrimitive(l)},handleClearCanvas:()=>{t.clear()},handelDelete:()=>{t.deleteCurPrimitive(),window.$message.success("删除成功！")},handleUp:()=>{t.upCurComponent()},handleDown:()=>{t.downCurComponent()},handleTop:()=>{t.moveCurPrimitiveByIndex(1)},handleBottom:()=>{t.moveCurPrimitiveByIndex(-1)},handleCreateGroup:()=>{o()},handleDeleteGroup:()=>{r()}}}},ae=o({name:"ContextMenu",setup(e,{expose:t}){const{menuState:l,operations:o}=ie(),s=M(),h=q(),{areaSelectVisible:p}=d(h),m=a({visible:n(!1),contextType:n(""),contextOptions:n([])}),g=()=>{s.setClickPrimitiveStatus(!0)},y=[{label:"复制",handler:o.handleCopy},{label:"粘贴",handler:o.handlePaste},{label:"删除",handler:o.handelDelete},{label:"置顶",handler:o.handleUp},{label:"置底",handler:o.handleDown},{label:"上移",handler:o.handleTop},{label:"下移",handler:o.handleBottom}],b=[{label:"组合",handler:o.handleCreateGroup},{label:"删除",handler:o.handleDeleteGroup}],w=[{label:"粘贴",handler:o.handlePaste},{label:"清空画布",handler:o.handleClearCanvas}],S=()=>{p.value?m.contextOptions=[...b]:"Editor"===m.contextType?m.contextOptions=[...w]:(m.contextOptions=[...y],"Group"===m.contextType&&m.contextOptions.unshift({label:"解除分组",handler:o.handleDeleteGroup}))},A=r((()=>({top:`${l.top}px`,left:`${l.left}px`})));return t({show:({top:e,left:t,contextType:n})=>{l.top=e,l.left=t,m.contextType=n,S(),m.visible=!0},close:()=>{m.visible=!1}}),()=>i(f,{to:"body"},{default:()=>[c(i("div",{class:re,style:A.value},[i("ul",{onMouseup:g,onMousedown:e=>e.stopPropagation()},[m.contextOptions.map((e=>i("li",{onClick:()=>{e.handler(),m.visible=!1}},[e.label,v(" "),e.disabled])))])]),[[u,m.visible]])]})}});function se(){const e=a({lastX:0,lastY:0,isSpaceDown:n(!1),isMouseDown:n(!1)}),t=n(null),l=n(null),o=n(null),r=n(null),i=n(null),{groupState:s,onDrawGroupBoundry:c}=function(){const e=M(),{transByCurScale:t,transAbsByCurScale:l}=P(),n=q(),{primitives:o}=d(e),r=a({editorX:0,editorY:0,start:{x:0,y:0},width:0,height:0}),i=()=>{r.width=0,r.height=0,n.setAreaSelectVisible(!1),n.setAreaSelectOptions(null,[])},s=()=>{const e=c();if(e.length<=1)return void i();let t=1/0,l=1/0,o=-1/0,a=-1/0;e.forEach((e=>{var n;let i={};"group"===e.cName?null==(n=e.childPrimitives)||n.forEach((e=>{const n=document.getElementById(`primitive${e.id}`).getBoundingClientRect();i.left=n.left-r.editorX,i.top=n.top-r.editorY,i.right=n.right-r.editorX,i.bottom=n.bottom-r.editorY,i.left<l&&(l=i.left),i.top<t&&(t=i.top),i.right>o&&(o=i.right),i.bottom>a&&(a=i.bottom)})):i=T(e.style),i.left<l&&(l=i.left),i.top<t&&(t=i.top),i.right>o&&(o=i.right),i.bottom>a&&(a=i.bottom)})),r.start.x=l,r.start.y=t,r.width=o-l,r.height=a-t;const s={left:l,top:t,width:r.width,height:r.height};n.setAreaSelectOptions(s,e)},c=()=>{const{x:e,y:t}=r.start;return o.value.filter((l=>{const{left:n,top:o,width:i,height:a}=l.style;if(e<=n&&t<=o&&n+i<=e+r.width&&o+a<=t+r.height)return l}))};return{groupState:r,onDrawGroupBoundry:e=>{i();const o=document.getElementById("editor").getBoundingClientRect(),a=e.clientX,c=e.clientY;r.editorX=o.x,r.editorY=o.y,r.start.x=t(a-r.editorX),r.start.y=t(c-r.editorY),n.setAreaSelectVisible(!0);const u=e=>{r.width=l(e.clientX-a),r.height=l(e.clientY-c),e.clientX<a&&(r.start.x=l(e.clientX-r.editorX)),e.clientY<c&&(r.start.y=l(e.clientY-r.editorY))},d=e=>{document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",d),e.clientX!=a||e.clientY!=c?s():i()};document.addEventListener("mousemove",u),document.addEventListener("mouseup",d)}}}(),u=M(),{curPrimitive:p,primitives:m,editorScale:v}=d(u),f=e=>{if(!e||!e.parentNode)return;const t=e.parentNode;if(!t.getAttribute)return;const l=t.getAttribute("data-context");return l||f(t)},y=l=>{var n;if(!e.isMouseDown)return;const o=l.clientX-e.lastX,r=l.clientY-e.lastY;null==(n=t.value)||n.scrollBy(-o,-r),e.lastX=l.clientX,e.lastY=l.clientY},{space:b}=_({passive:!1,onEventFired(e){"Space"===e.code&&"keydown"===e.type&&e.preventDefault()}});return g(b,(t=>{e.isSpaceDown=t,l.value.style.cursor=t?"pointer":"default",t?document.addEventListener("mousemove",y):document.removeEventListener("mousemove",y)})),h((()=>{const e=i.value.getBoundingClientRect();t.value.scrollLeft=e.width/2-100,t.value.scrollTop=e.height/2-160})),{groupState:s,editorScale:v,contextMenuRef:o,primitives:m,screenRef:t,editorRef:l,sketchRulerRef:r,editorContaineRef:i,handleMouseUp:t=>{var l;u.isClickPrimitive||u.setCurPrimitive(null),2!==t.button&&(null==(l=o.value)||l.close()),e.isMouseDown=!1},handleMouseDown:t=>{0===t.button&&(e.isMouseDown=!0,e.isSpaceDown?(e.lastX=t.clientX,e.lastY=t.clientY):(u.setClickPrimitiveStatus(!1),p||t.preventDefault(),c(t)))},handleMouseWheel:e=>{var t;if(e.ctrlKey||e.metaKey){e.preventDefault();let l=v.value;if(e.wheelDelta>=0&&l<200)return l+=5,void u.setEditorScale(l);e.wheelDelta<0&&l>10&&(l-=5,u.setEditorScale(l)),null==(t=r.value)||t.handleResizeRuler()}},handleMouseScroll:()=>{var e;null==(e=r.value)||e.handleResizeRuler()},handleShowContextMenu:e=>{var t;if(e.stopPropagation(),e.preventDefault(),!e.target)return;const l=e.clientY,n=e.clientX,r=f(e.target);null==(t=o.value)||t.show({top:l,left:n,contextType:r})}}}const ce={dark:"_dark_16tdw_22",screen:"_screen_16tdw_38",container:"_container_16tdw_49",editor:"_editor_16tdw_54",primitive:"_primitive_16tdw_63"},ue=o({name:"LineRuler",props:{scale:Number,thick:Number,palette:Object,index:Number,start:Number,vertical:Boolean,value:Number,isShowReferLine:Boolean},emits:["onMouseDown","onRelease","onRemove"],setup(e,{emit:t}){const l=n(0),o=n(!0);h((()=>{l.value=e.value}));const i=r((()=>{const t=(l.value-e.start)*e.scale;(e=>{o.value=e>=0})(t);const n=t+"px";return e.vertical?{top:n}:{left:n}})),a=r((()=>{var t;const l=`1px solid ${null==(t=e.palette)?void 0:t.lineColor}`,n=e.vertical?{borderTop:l}:{borderLeft:l};return{cursor:e.isShowReferLine?e.vertical?"ns-resize":"ew-resize":"none",...n}})),s=r((()=>e.vertical?{left:e.thick+"px"}:{top:e.thick+"px"}));return{startValue:l,showLine:o,offset:i,borderCursor:a,actionStyle:s,handleDown:n=>{const o=e.vertical?n.clientY:n.clientX,r=l.value;t("onMouseDown");const i=t=>{const n=e.vertical?t.clientY:t.clientX,i=Math.round(r+(n-o)/e.scale);l.value=i},a=()=>{t("onRelease",l.value,e.index),document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",a)};document.addEventListener("mousemove",i),document.addEventListener("mouseup",a)},handleRemove:()=>{t("onRemove",e.index)}}}}),de=(e,t)=>{const l=e.__vccOpts||e;for(const[n,o]of t)l[n]=o;return l},he={class:"value"};const pe=de(ue,[["render",function(e,t,l,n,o,r){return c((b(),w("div",{class:"line",style:A([e.offset,e.borderCursor]),onMousedown:t[1]||(t[1]=(...t)=>e.handleDown&&e.handleDown(...t))},[S("div",{class:"action",style:A(e.actionStyle)},[S("span",{class:"del",onClick:t[0]||(t[0]=(...t)=>e.handleRemove&&e.handleRemove(...t))},"×"),S("span",he,x(e.startValue),1)],4)],36)),[[u,e.showLine]])}],["__scopeId","data-v-053590ce"]]),me=o({name:"CanvasRuler",props:{showIndicator:Boolean,valueNum:Number,scale:Number,ratio:Number,palette:Object,vertical:Boolean,start:Number,width:Number,height:Number,selectStart:Number,selectLength:Number,startNumX:Number,endNumX:Number,startNumY:Number,endNumY:Number},emits:["onAddLine","update:showIndicator","update:valueNum"],setup(e,{emit:t}){const l=a({canvasContext:null});let o=1;const r=n(null);h((()=>{o=e.ratio||window.devicePixelRatio||1,i(),s(o),c(o)}));const i=()=>{l.canvasContext=r.value&&r.value.getContext("2d")},s=t=>{if(r.value){r.value.width=e.width*t,r.value.height=e.height*t;const n=l.canvasContext;n&&(n.font=12*t+'px -apple-system,\n                "Helvetica Neue", ".SFNSText-Regular",\n                "SF UI Text", Arial, "PingFang SC", "Hiragino Sans GB",\n                "Microsoft YaHei", "WenQuanYi Zen Hei", sans-serif',n.lineWidth=1,n.textBaseline="middle")}},c=t=>{const n={scale:e.scale,width:e.width,height:e.height,palette:e.palette,startNumX:e.startNumX,endNumX:e.endNumX,startNumY:e.startNumY,endNumY:e.endNumY,ratio:t};l.canvasContext&&((e,t,l,n,o,r)=>{const{scale:i,width:a,height:s,ratio:c,palette:u}=o,{bgColor:d,fontColor:h,shadowColor:p,longfgColor:m,shortfgColor:v}=u,f=r?o.startNumX:o.startNumY,g=r?o.endNumX:o.endNumY;if(e.scale(c,c),e.clearRect(0,0,a,s),e.fillStyle=d,e.fillRect(0,0,a,s),n){const o=(l-t)*i,c=n*i;e.fillStyle=p,r?e.fillRect(o,0,c,3*s/8):e.fillRect(0,o,3*a/8,c)}const y=(e=>e<=.25?40:e<=.5?20:e<=1?10:e<=2?5:e<=4?2:1)(i),b=y*i,w=10*y,S=w*i,A=Math.floor(t/y)*y,N=Math.floor(t/w)*w,C=(A-t)/y*b,x=(N-t)/w*S,R=t+Math.ceil((r?a:s)/i);e.beginPath(),e.fillStyle=h,e.strokeStyle=m;for(let E=N,B=0;E<R;E+=w,B++){if(E>=f&&E<=g){const t=x+B*S+.5;r?e.moveTo(t,0):e.moveTo(0,t),e.save(),r?e.translate(t,.4*s):e.translate(.4*a,t),r||e.rotate(-Math.PI/2),e.scale(.83/c,.83/c),e.fillText(E.toString(),4*c,7*c),e.restore(),r?e.lineTo(t,9*s/16):e.lineTo(9*a/16,t)}e.stroke(),e.closePath(),e.beginPath(),e.strokeStyle=v;for(let t=A,l=0;t<R;t+=y,l++)if(t>=f&&t<=g){const n=C+l*b+.5;r?e.moveTo(n,0):e.moveTo(0,n),t%w!=0&&(r?e.lineTo(n,1*s/4):e.lineTo(1*a/4,n))}e.stroke(),e.closePath(),e.setTransform(1,0,0,1,0,0)}})(l.canvasContext,e.start,e.selectStart,e.selectLength,n,!e.vertical)};return g((()=>e.start),(()=>c(o))),g([()=>e.width,()=>e.height],(()=>{s(o),c(o)})),{handle:(l,n)=>{const o=e.vertical?l.offsetY:l.offsetX,r=(i=o,a=e.start,s=e.scale,Math.round(a+i/s));var i,a,s;switch(n){case"click":t("onAddLine",r);break;case"enter":t("update:valueNum",r),t("update:showIndicator",!0);break;default:t("update:valueNum",r)}},canvas:r}}});const ve=o({name:"RulerWrapper",components:{CanvasRuler:de(me,[["render",function(e,t,l,n,o,r){return b(),w("canvas",{ref:"canvas",class:"ruler",onClick:t[0]||(t[0]=t=>e.handle(t,"click")),onMouseenter:t[1]||(t[1]=t=>e.handle(t,"enter")),onMousemove:t[2]||(t[2]=t=>e.handle(t,"move")),onMouseleave:t[3]||(t[3]=t=>e.$emit("update:showIndicator",!1))},null,544)}]]),RulerLine:pe},props:{scale:Number,ratio:Number,thick:Number,startNumX:Number,endNumX:Number,startNumY:Number,endNumY:Number,palette:Object,vertical:{type:Boolean,default:!0},width:{type:Number,default:200},height:{type:Number,default:200},start:{type:Number,default:0},lines:{type:Array,default:()=>[]},selectStart:{type:Number},selectLength:{type:Number},isShowReferLine:{type:Boolean}},setup(e){const t=n(!1),l=n(0),o=r((()=>e.vertical?"v-container":"h-container")),i=r((()=>{const t={width:`calc(100% - ${e.thick}px)`,height:`${e.thick+1}px`,left:`${e.thick}px`},l={width:`${e.thick&&e.thick+1}px`,height:`calc(100% - ${e.thick}px)`,top:`${e.thick}px`};return e.vertical?l:t})),a=r((()=>{var t;const n=(l.value-e.start)*e.scale;let o="top",r="borderLeft";return o=e.vertical?"top":"left",r=e.vertical?"borderBottom":"borderLeft",{[o]:n+"px",[r]:`1px solid ${null==(t=e.palette)?void 0:t.lineColor}`}})),s=t=>{e.lines.splice(t,1)};return{showIndicator:t,valueNum:l,rwClassName:o,rwStyle:i,indicatorStyle:a,handleNewLine:t=>{e.lines.push(t)},handleLineRelease:(t,l)=>{const n=t-e.start,o=(e.vertical?e.height:e.width)/e.scale;n<0||n>o?s(l):e.lines[l]=t},handleLineRemove:s}}}),fe={class:"lines"},ge={class:"value"};const ye=o({name:"SketchRule",components:{RulerWrapper:de(ve,[["render",function(e,t,l,n,o,r){const a=y("CanvasRuler"),s=y("RulerLine");return b(),w("div",{class:R(e.rwClassName),style:A(e.rwStyle)},[i(a,{vertical:e.vertical,scale:e.scale,width:e.width,height:e.height,start:e.start,ratio:e.ratio,startNumX:e.startNumX,endNumX:e.endNumX,startNumY:e.startNumY,endNumY:e.endNumY,"select-start":e.selectStart,"select-length":e.selectLength,palette:e.palette,valueNum:e.valueNum,"onUpdate:valueNum":t[0]||(t[0]=t=>e.valueNum=t),showIndicator:e.showIndicator,"onUpdate:showIndicator":t[1]||(t[1]=t=>e.showIndicator=t),onOnAddLine:e.handleNewLine},null,8,["vertical","scale","width","height","start","ratio","startNumX","endNumX","startNumY","endNumY","select-start","select-length","palette","valueNum","showIndicator","onOnAddLine"]),c(S("div",fe,[(b(!0),w(N,null,C(e.lines,((t,l)=>(b(),E(s,{key:t+l,index:l,value:t>>0,scale:e.scale,start:e.start,thick:e.thick,palette:e.palette,vertical:e.vertical,"is-show-refer-line":e.isShowReferLine,onOnRemove:e.handleLineRemove,onOnRelease:e.handleLineRelease},null,8,["index","value","scale","start","thick","palette","vertical","is-show-refer-line","onOnRemove","onOnRelease"])))),128))],512),[[u,e.isShowReferLine]]),c(S("div",{class:"indicator",style:A(e.indicatorStyle)},[S("div",ge,x(e.valueNum),1)],4),[[u,e.showIndicator]])],6)}],["__scopeId","data-v-9da5477e"]])},props:{eyeIcon:{type:String},closeEyeIcon:{type:String},scale:{type:Number,default:1},ratio:{type:Number},thick:{type:Number,default:16},palette:Object,startX:{type:Number},startY:{type:Number,default:0},width:{type:Number,default:200},height:{type:Number,default:200},shadow:{type:Object,default:()=>({x:0,y:0,width:0,height:0})},lines:{type:Object,default:()=>({h:[],v:[]})},isShowReferLine:{type:Boolean,default:!0},startNumX:{type:Number,default:-1/0},endNumX:{type:Number,default:1/0},startNumY:{type:Number,default:-1/0},endNumY:{type:Number,default:1/0}},emits:["onCornerClick"],setup(e,{emit:t}){let l=n(!0);l.value=e.isShowReferLine;const o=r((()=>function e(t,l){return Object.keys(t).forEach((n=>{n&&t.hasOwnProperty(n)&&("object"==typeof l[n]?t[n]=e(t[n],l[n]):l.hasOwnProperty(n)&&(t[n]=l[n]))})),t}({bgColor:"rgba(225,225,225, 0)",longfgColor:"#BABBBC",shortfgColor:"#C8CDD0",fontColor:"#7D8694",shadowColor:"#E8E8E8",lineColor:"#EB5648",borderColor:"#DADADC",cornerActiveColor:"rgb(235, 86, 72, 0.6)",menu:{bgColor:"#fff",dividerColor:"#DBDBDB",listItem:{textColor:"#415058",hoverTextColor:"#298DF8",disabledTextColor:"rgba(65, 80, 88, 0.4)",bgColor:"#fff",hoverBgColor:"#F2F2F2"}}},e.palette||{}))),i=r((()=>({backgroundImage:l.value?`url(${e.eyeIcon||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAopJREFUOE/FlE9IVEEcx7+/N9ouds1Mu0QUSFZYdIgoUqQoKPBQHsKozpXE7jbTO/U8xLJvn6usBHWQ6hBFXupSkQeVbh0KJEPp0sH+eLGTsKs77xcj78m0ax0E8cHjzZv5zef3/c33xxA24KENYGJzoEEQbNNaN4Zh2OQ4znwYhr9c1/39vwrXVDo0NNS0tLR0GYB5D64BmAMwzMyvlFKz1es10Hw+f4mZ7wHYBeA9gNdENFepVOaEEM3M3OI4Thczn41gt6WUgQ3+C+r7/h0AWQD3mXnYqPA8L9nQ0HCemduIaFpKOWoAhUJhT6VSuQXgOjP3K6W8GLwKzeVyp4jonR0QBEErM48w8zFLyayUsjX+z+VyHhHdZebTSqkxM78CHRgYOKS1/ghgVErZY214RkQ7ADyRUj72ff8qgCtmXUrZGcf5vv8CwEUhxOF0Ov1pBRpla5dSdseBhUJhpznH6tIsZb1KqacW+BGArUaUXX63UuplHJTNZjuEEONSyhozfd/n6mQ1RkXZL2itz7mu+80EDA4ONi8vL/8AcM2UbikyR2BU9cSmmTU70YqKIAj2hWFo2uenlHK/BRg3Y2aeNO5GyU8S0ZbFxcUuz/NKEXAGQKPjOCcymcyX1dIi8DSAiWQyeaavr68cbSgCuBknYubnQoj+TCYzUywWE6VS6S2ADsdx2gxw1X3L7SNENMbMnwE8qK+vf5NKpRaMaeVyeW8ikfiaSqW+R7BuZr5BRMe11p2u607U9Gk8kc/ntzPzQwCmExYATDLzVBiGE0KIowAOADDf3QA+aK2VDaxRajto3K+rq+tl5nYAzQBamHmeiOYBTGmtR6ph/1Rqg9c73pz7dD1qN0TpHyNQRCUDJXrAAAAAAElFTkSuQmCC"})`:`url(${e.closeEyeIcon||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAjtJREFUOE/NlD9oFEEUxn9v9ghC0hpRUogIAUmniGAT/5Q2FrETPSNRJILg7RwimI0ox85eQFCEBGIUO1PYpFM0jSConQoBEZGgGPsgl+w+2eM2bC57SopAFqYZ3v7m+977ZoQt+GQLmGxPaBiGgYiMWWvXBHZUGoZhH3BERPYC+4F+4Keq/urt7b1RLpf/ZEBVHa9Wq0HWyg3QKIoGVPU8cA7wgK/pUtXPQJ8xZk+pVBpuNBqXUoUiEvi+P56fzTpo6+SbwHNg1lo7WzTITGEKXFlZeeB53tVCpa3CK8AFa+1cBgvD8LKIXAQOJkkyICJDeYVBEJS6u7s/qeoLa+1o+l9TqXNuBLhmjDlbqVQ+5ICjInIfOBPH8W9jzGCR5YmJiRNxHM+papgqzqDvgSlr7VTernPuO3An3c9bBt74vv+yrdaKyLDv+/1Sq9UGPc97nY9EVuycU2AQOA7cAm4Dr4D5TvVxHB9rKo2iaEFVp621Ln96FEUngaOqGmSxabVqsh3a2h+x1h5qQjNrae/yE4+iaCwDJkky73neTuBZe129Xk+H+BS4l7ZqLVIZ2BhzuFKpvMsDVXXWGPMxFdAedOfcKeCRqj7MYrUhpz09PfXl5eXrectFWXXODQHpOq2qd/95o/JXr6ura3J1dXU6SZIfwKKIHAD2tVYMPBGRx77vN10UXtO85fTkmZmZHUtLSzUR2QXsBhaAL6r6DXhbrVYXi1yss59GqOgub/bN3Z7v6X/tb9Zmp/q/kN8s+lJb8oEAAAAASUVORK5CYII="})`,width:e.thick+"px",height:e.thick+"px",borderRight:`1px solid ${o.value.borderColor}`,borderBottom:`1px solid ${o.value.borderColor}`})));return g([()=>e.isShowReferLine],(()=>{l.value=e.isShowReferLine})),{showReferLine:l,paletteCpu:o,cornerStyle:i,onCornerClick:e=>{l.value=!l.value,t("onCornerClick",l.value)}}}}),be={id:"mb-ruler",class:"style-ruler mb-ruler"};const we=de(ye,[["render",function(e,t,l,n,o,r){const a=y("RulerWrapper");return b(),w("div",be,[i(a,{vertical:!1,width:e.width,height:e.thick,"is-show-refer-line":e.showReferLine,thick:e.thick,ratio:e.ratio,start:e.startX,lines:e.lines.h,"select-start":e.shadow.x,"select-length":e.shadow.width,scale:e.scale,palette:e.paletteCpu,startNumX:e.startNumX,endNumX:e.endNumX},null,8,["width","height","is-show-refer-line","thick","ratio","start","lines","select-start","select-length","scale","palette","startNumX","endNumX"]),i(a,{vertical:!0,width:e.thick,height:e.height,"is-show-refer-line":e.showReferLine,thick:e.thick,ratio:e.ratio,start:e.startY,lines:e.lines.v,"select-start":e.shadow.y,"select-length":e.shadow.height,scale:e.scale,palette:e.paletteCpu,startNumY:e.startNumY,endNumY:e.endNumY},null,8,["width","height","is-show-refer-line","thick","ratio","start","lines","select-start","select-length","scale","palette","startNumY","endNumY"]),S("a",{class:"corner",style:A(e.cornerStyle),onClick:t[0]||(t[0]=(...t)=>e.onCornerClick&&e.onCornerClick(...t))},null,4)])}]]),Se="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABmJLR0QA/wD/AP+gvaeTAAAA7ElEQVQ4je3SvS5EURSG4ccMmXYUQ0hoRoErEXMJ4iaE6GVqYlTojWugEf8/LZdApRLKCcVZh5PJOScTjUjmTb5irb3X2t/eezHkXzGHHTzhI/SIbTSLiio5uSrauMIbVtAIreId19iKvaVU0MUJJkr2TeIURwWmvtnEGWoRj+MAL3jGPuqxVsM5NspOfcVMxKO4xS6mQh3c+LnqbNQ08hquh5uUVjjIMoJLLGdyh1hLg+z9F3Cciedx39fwE3exltLFYp7Dflq4GMDhwFQlb9jBdGhPMjKF41L25T0sSX7zITQW7nq/cTjkj/gC6vIqCPem75wAAAAASUVORK5CYII=",Ae="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABmJLR0QA/wD/AP+gvaeTAAABEUlEQVQ4jdXTu0oDQRiG4ccDBqw8YAIWWkgaBcHeYrG1iQRyARbegdjnAhRLRUEQjHoLIoh4QBRRFCvRWo2Fhb1FJjAGlqSIYF5YZv+Z4eX7d2foJO6RtFM4izfM/XtpgvcwTuAB3+F5xGqYb5luHARBXTqAfsygrNZFGT3NZF2o4BjFKGkjORxhLwRIZQVnyIS6GCWdxwYGw1oGp1hOk+XwgfFQ9+IWO1HSRVyENRhDFSN1SfwNlvCJ3VAXMI0FXOMQm3hFFs/4Qh6juNTQ/xT2ozqPq/B+glKQvuA82lfBZFrbMYUgiklCqqQVQSN9uMGaWktZrONJ+t9vyhC2g6CKLQz7ffjbRmfd/bt2Cv+WH7FAOwOy5F6RAAAAAElFTkSuQmCC",Ne="_sketchRule_1m2qx_38",Ce=o({name:"SketchRuler",setup(){const e=a({thick:16,startX:n(0),startY:n(0),lines:a({h:[],v:[]})}),t=M(),l=B(),{editorScale:o}=d(t),{transByCurScale:i}=P(),s=r((()=>{const e=document.getElementById("screen");return{width:null==e?void 0:e.clientWidth,height:null==e?void 0:e.clientHeight}})),c=r((()=>l.darkTheme?{bgColor:"#18181c",longfgColor:"#4d4d4d",shortfgColor:"#4d4d4d",fontColor:"#4d4d4d",shadowColor:"#18181c",borderColor:"#18181c",cornerActiveColor:"#18181c"}:{bgColor:"#fff",longfgColor:"#cbcbcb",shortfgColor:"#cbcbcb",fontColor:"#ababab",shadowColor:"#fff",borderColor:"#e2e2e2",cornerActiveColor:"blue"}));return{...X(e),editorScale:o,containerRect:s,handleResizeRuler:()=>{var t,l;const n=null==(t=document.querySelector("#screen"))?void 0:t.getBoundingClientRect(),o=null==(l=document.querySelector("#editor"))?void 0:l.getBoundingClientRect();e.startX=i(n.left+e.thick-o.left),e.startY=i(n.top+e.thick-o.top)},paletteStyle:c,eyeIcon:Se,closeEyeIcon:Ae}},render(){var e,t;return i(we,{class:Ne,thick:this.thick,eyeIcon:Se,closeEyeIcon:Ae,scale:this.editorScale/100,width:null==(e=this.containerRect)?void 0:e.width,height:null==(t=this.containerRect)?void 0:t.height,startX:this.startX,startY:this.startY,lines:this.lines,cornerActive:!0},null)}});const xe=o({name:"Editor",setup(){const e=n(),t=n(!1),l=q(),o=M(),{areaSelectVisible:i}=d(l),{canvasStyle:a}=d(o),s=["width","height","top","left"],{groupState:c,editorScale:u,contextMenuRef:h,...p}=se(),m=r((()=>({width:`${a.value.width}px`,height:`${a.value.height}px`,transform:`scale(${u.value/100})`})));return Y((()=>t.value=!0)),{...p,sceneRef:e,groupState:c,editorStyle:m,rulerVisible:t,setEditorScene:t=>{e.value.setEditorScene(t)},contextMenuRef:h,getPrimitiveStyle:e=>V(e,s),areaSelectVisible:i,handleCloseContextMenu:()=>{var e;null==(e=h.value)||e.close()}}},render(){const e=e=>D(y(e.cName),{id:`primitive${e.id}`,class:ce.primitive,style:this.getPrimitiveStyle(e.style),"data-context":e.cName,dataSource:e});return i(N,null,[i("div",{id:"screen",ref:"screenRef",class:ce.screen,onWheel:this.handleMouseWheel,onScroll:this.handleMouseScroll},[i("div",{id:"editorContainer",ref:"editorContaineRef",class:ce.container},[i("div",{id:"editor",ref:"editorRef","data-context":"Editor",class:ce.editor,style:this.editorStyle,onMousedown:this.handleMouseDown,onMouseup:this.handleMouseUp,onContextmenu:this.handleShowContextMenu},[c(i(z,{options:this.groupState},null),[[u,this.areaSelectVisible]]),i(ee,null,null),i(ae,{ref:"contextMenuRef"},null),i(Q,{ref:"sceneRef",class:ce.scene},null),(()=>this.primitives.map(((t,l)=>{let n;return i(oe,{index:l,style:F(t.style),primitive:t,pStyle:t.style,onCloseContextmenu:this.handleCloseContextMenu},"function"==typeof(o=n=e(t))||"[object Object]"===Object.prototype.toString.call(o)&&!k(o)?n:{default:()=>[n]});var o})))()])])]),this.rulerVisible?i(Ce,{ref:"sketchRulerRef"},null):null])}}),Re="_container_12igw_38",Ee=o({name:"Container",components:{Editor:xe},setup(){const e=n(),{...t}=(()=>{const e=M(),{transByCurScale:t}=P();return{handleDrop:l=>{l.preventDefault(),l.stopPropagation();const n=l.dataTransfer.getData("name"),o=document.querySelector("#editor").getBoundingClientRect(),r=new L[n],i={top:G.ceil(t(l.clientY-o.y)),left:G.ceil(t(l.clientX-o.x))};r.updateStyle(i),e.addPrimitive(r)},handleDragOver:e=>{e.preventDefault(),e.dataTransfer.dropEffect="copy"},handleMouseDown:e=>{e.stopPropagation()},handleMouseUp:()=>{}}})();return{editorRef:e,...t,setEditorScene:t=>{e.value.setEditorScene(t)}}},render(){return i(N,null,[i("div",{class:Re,onDrop:this.handleDrop,onDragover:this.handleDragOver,onMousedown:this.handleMouseDown,onMouseup:this.handleMouseUp},[i(xe,{ref:"editorRef"},null)])])}});export{Ee as default};
//# sourceMappingURL=index-CsFhZ5j_.js.map
