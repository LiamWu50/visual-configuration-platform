{"version":3,"file":"index-0772cf47.js","sources":["../../../src/utils/translate.ts","../../../src/utils/primitive.ts","../../../src/components/Editor/Scene/index.tsx"],"sourcesContent":["export function mod360(deg: number) {\n  return (deg + 360) % 360\n}\n\nexport function toPercent(val: number) {\n  return val * 100 + '%'\n}\n","import { Primitive } from '@/primitives/primitive'\nimport type { DOMRect, Location, PrimitiveStyle } from '@/primitives/types'\n\nimport { toPercent } from './translate'\n\nconst needUnit = [\n  'fontSize',\n  'width',\n  'height',\n  'top',\n  'left',\n  'borderWidth',\n  'letterSpacing',\n  'borderRadius'\n]\n\n/**\n * 计算组件笛卡尔坐标系坐标\n * @param style 组件在画布中的位置\n * @returns 组件坐标\n */\nexport function calcPrimitiveAxis(style: PrimitiveStyle): Location {\n  return {\n    top: style.top,\n    left: style.left,\n    right: style.left + style.width,\n    bottom: style.top + style.height\n  }\n}\n\n/**\n *\n * @param style PrimitiveStyle\n * @param filter []\n * @returns PrimitiveStyle\n */\nexport function getStyle(style: PrimitiveStyle, filter: string[] = []) {\n  const result = {} as any\n  Object.keys(style).forEach((key) => {\n    if (!filter.includes(key as never)) {\n      if (style[key]) {\n        result[key] = style[key]\n        if (needUnit.includes(key)) result[key] += 'px'\n      }\n    }\n  })\n\n  return result\n}\n\n/**\n * 获取包围盒的样式\n * @param style PrimitiveStyle\n */\nexport function getBoundBoxStyle(style: PrimitiveStyle) {\n  const pStyle: Record<string, string> = {}\n\n  for (const [key, value] of Object.entries(style)) {\n    if (value) pStyle[key] = `${value}px`\n  }\n\n  return pStyle\n}\n\n/**\n * 获取一个组件的位置信息\n * @param style PrimitiveStyle\n * @returns Location\n */\nexport function getPrimitiveLocation(style: PrimitiveStyle): Location {\n  const bottom = style.top + style.height\n  const right = style.left + style.width\n\n  return {\n    left: style.left,\n    top: style.top,\n    right,\n    bottom\n  }\n}\n\n// 将组合中的各个子组件拆分出来，并计算它们新的 style\nexport function decomposePrimitive(\n  primitive: Primitive,\n  editorRect: DOMRect,\n  parentStyle: PrimitiveStyle\n) {\n  const element = document.getElementById(`primitive${primitive.id}`)\n  const rectInfo = element!.getBoundingClientRect()\n  // 获取元素的中心点坐标\n  const center = {\n    x: rectInfo.left - editorRect.left + rectInfo.width / 2,\n    y: rectInfo.top - editorRect.top + rectInfo.height / 2\n  }\n\n  primitive.style.width =\n    (parseFloat(primitive.groupStyle.width) / 100) * parentStyle.width\n  primitive.style.height =\n    (parseFloat(primitive.groupStyle.height) / 100) * parentStyle.height\n  // 计算出元素新的 top left 坐标\n  primitive.style.left = center.x - primitive.style.width / 2\n  primitive.style.top = center.y - primitive.style.height / 2\n  primitive.groupStyle = {} as CSSStyleDeclaration\n}\n\n/**\n * 创建组的样式\n * @param groupPrimitive Primitive\n */\nexport function createGroupStyle(groupPrimitive: Primitive) {\n  const parentStyle = groupPrimitive.style as PrimitiveStyle\n  groupPrimitive.childPrimitives?.forEach((primitive: Primitive) => {\n    // primitive.groupStyle 的 top left 是相对于 group 组件的位置\n    if (!Object.keys(primitive.groupStyle).length) {\n      const style = { ...primitive.style } as PrimitiveStyle\n\n      primitive.groupStyle = getStyle(style)\n\n      primitive.groupStyle.left = toPercent(\n        (style.left - parentStyle.left) / parentStyle.width\n      )\n      primitive.groupStyle.top = toPercent(\n        (style.top - parentStyle.top) / parentStyle.height\n      )\n      primitive.groupStyle.width = toPercent(style.width / parentStyle.width)\n      primitive.groupStyle.height = toPercent(style.height / parentStyle.height)\n    }\n  })\n}\n","import CesiumSceneHelper from '@/helper/cesium-scene-helper'\nimport { useCesiumSourceLoader } from '@/hooks/use-cesium-source-loader'\nimport { usePreviewStore } from '@/store/preview'\nimport { Scene as IScene } from '@/views/design-space/chart/scene/use-state'\n\nimport styles from './index.module.scss'\n\nconst Scene = defineComponent({\n  name: 'scene',\n  setup() {\n    const sceneType = ref()\n    const mapViewer = ref()\n\n    const previewStore = usePreviewStore()\n    const { loadCesiumSource } = useCesiumSourceLoader(mapViewer)\n\n    const setEditorScene = async (scene: IScene) => {\n      sceneType.value = scene.type\n      await nextTick()\n      if (scene.type === 'map') {\n        mapViewer.value = CesiumSceneHelper.initViewer('mapScene')\n        loadCesiumSource(scene.dataSource)\n        previewStore.saveCanvasScene({\n          type: 'map',\n          scene: scene.dataSource\n        })\n      }\n    }\n\n    return {\n      sceneType,\n      setEditorScene\n    }\n  },\n  render() {\n    return (\n      <div class={styles.container}>\n        {this.sceneType === 'map' ? (\n          <div id='mapScene'></div>\n        ) : (\n          <div id='threeScene'></div>\n        )}\n      </div>\n    )\n  }\n})\nexport default Scene\n"],"names":["mod360","deg","toPercent","val","needUnit","calcPrimitiveAxis","style","top","left","right","width","bottom","height","getStyle","filter","result","Object","keys","forEach","key","includes","getBoundBoxStyle","pStyle","value","entries","getPrimitiveLocation","decomposePrimitive","primitive","editorRect","parentStyle","rectInfo","document","getElementById","id","getBoundingClientRect","center","parseFloat","groupStyle","createGroupStyle","groupPrimitive","_a","childPrimitives","length","Scene","defineComponent","name","setup","sceneType","ref","mapViewer","previewStore","usePreviewStore","loadCesiumSource","useCesiumSourceLoader","setEditorScene","async","scene","type","render","_createVNode","class","styles","this"],"mappings":"yMAAO,SAASA,EAAOC,GACrB,OAAQA,EAAM,KAAO,GACvB,CAEO,SAASC,EAAUC,GACxB,OAAa,IAANA,EAAY,GACrB,CCDA,MAAMC,EAAW,CACf,WACA,QACA,SACA,MACA,OACA,cACA,gBACA,gBAQK,SAASC,EAAkBC,GACzB,MAAA,CACLC,IAAKD,EAAMC,IACXC,KAAMF,EAAME,KACZC,MAAOH,EAAME,KAAOF,EAAMI,MAC1BC,OAAQL,EAAMC,IAAMD,EAAMM,OAE9B,CAQO,SAASC,EAASP,EAAuBQ,EAAmB,IACjE,MAAMC,EAAS,CAAA,EAUR,OATPC,OAAOC,KAAKX,GAAOY,SAASC,IACrBL,EAAOM,SAASD,IACfb,EAAMa,KACDJ,EAAAI,GAAOb,EAAMa,GAChBf,EAASgB,SAASD,KAAMJ,EAAOI,IAAQ,MAE/C,IAGKJ,CACT,CAMO,SAASM,EAAiBf,GAC/B,MAAMgB,EAAiC,CAAA,EAEvC,IAAA,MAAYH,EAAKI,KAAUP,OAAOQ,QAAQlB,GACpCiB,IAAcD,EAAAH,GAAO,GAAGI,OAGvB,OAAAD,CACT,CAOO,SAASG,EAAqBnB,GAC7B,MAAAK,EAASL,EAAMC,IAAMD,EAAMM,OAC3BH,EAAQH,EAAME,KAAOF,EAAMI,MAE1B,MAAA,CACLF,KAAMF,EAAME,KACZD,IAAKD,EAAMC,IACXE,QACAE,SAEJ,CAGgB,SAAAe,EACdC,EACAC,EACAC,GAEA,MACMC,EADUC,SAASC,eAAe,YAAYL,EAAUM,MACpCC,wBAEpBC,EACDL,EAAStB,KAAOoB,EAAWpB,KAAOsB,EAASpB,MAAQ,EADlDyB,EAEDL,EAASvB,IAAMqB,EAAWrB,IAAMuB,EAASlB,OAAS,EAG7Ce,EAAArB,MAAMI,MACb0B,WAAWT,EAAUU,WAAW3B,OAAS,IAAOmB,EAAYnB,MACrDiB,EAAArB,MAAMM,OACbwB,WAAWT,EAAUU,WAAWzB,QAAU,IAAOiB,EAAYjB,OAEhEe,EAAUrB,MAAME,KAAO2B,EAAWR,EAAUrB,MAAMI,MAAQ,EAC1DiB,EAAUrB,MAAMC,IAAM4B,EAAWR,EAAUrB,MAAMM,OAAS,EAC1De,EAAUU,WAAa,EACzB,CAMO,SAASC,EAAiBC,SAC/B,MAAMV,EAAcU,EAAejC,MACpB,OAAAkC,EAAAD,EAAAE,kBAAAD,EAAiBtB,SAASS,IAEvC,IAAKX,OAAOC,KAAKU,EAAUU,YAAYK,OAAQ,CAC7C,MAAMpC,EAAQ,IAAKqB,EAAUrB,OAEnBqB,EAAAU,WAAaxB,EAASP,GAEhCqB,EAAUU,WAAW7B,KAAON,GACzBI,EAAME,KAAOqB,EAAYrB,MAAQqB,EAAYnB,OAEhDiB,EAAUU,WAAW9B,IAAML,GACxBI,EAAMC,IAAMsB,EAAYtB,KAAOsB,EAAYjB,QAE9Ce,EAAUU,WAAW3B,MAAQR,EAAUI,EAAMI,MAAQmB,EAAYnB,OACjEiB,EAAUU,WAAWzB,OAASV,EAAUI,EAAMM,OAASiB,EAAYjB,OACrE,IAEJ,+BCzHA+B,EAAAC,EAAA,CACEC,KAAAA,QACAC,KAAAA,GACE,MAAAC,EAAAC,IACAC,EAAAD,IAEAE,EAAAC,sBACQC,GAAiBC,EAAAJ,sBAiBvBK,eAfFC,MAAAC,IACET,EAAAA,MAAAA,EAAAA,eAEA,QAAAS,EAAAC,wCAEEL,EAAAA,EAAAA,+BAEEK,KAAAA,2BAGJ,IAQJC,MAAAA,GACE,OAAAC,EAAA,MAAA,CAAAC,MAAAC,GAC8B,CAAA,QAAAC,KAAAf,UAAAY,EAAA,MAAA,CACD1B,GAAA,YAAA,MAAA0B,EAAA,MAAA,CAAA1B,GAAA,qBAO/B"}