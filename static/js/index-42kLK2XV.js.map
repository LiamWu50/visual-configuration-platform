{"version":3,"file":"index-42kLK2XV.js","sources":["../../../node_modules/vueuc/es/overflow/src/index.js"],"sourcesContent":["/* eslint-disable @typescript-eslint/strict-boolean-expressions */\nimport { defineComponent, renderSlot, h, onMounted, ref, nextTick } from 'vue';\nimport { useSsrAdapter } from '@css-render/vue3-ssr';\nimport { c, cssrAnchorMetaName } from '../../shared';\nconst hiddenAttr = 'v-hidden';\nconst style = c('[v-hidden]', {\n    display: 'none!important'\n});\nexport default defineComponent({\n    name: 'Overflow',\n    props: {\n        getCounter: Function,\n        getTail: Function,\n        updateCounter: Function,\n        onUpdateCount: Function,\n        onUpdateOverflow: Function\n    },\n    setup(props, { slots }) {\n        const selfRef = ref(null);\n        const counterRef = ref(null);\n        function deriveCounter(options) {\n            const { value: self } = selfRef;\n            const { getCounter, getTail } = props;\n            let counter;\n            if (getCounter !== undefined)\n                counter = getCounter();\n            else {\n                counter = counterRef.value;\n            }\n            if (!self || !counter)\n                return;\n            if (counter.hasAttribute(hiddenAttr)) {\n                counter.removeAttribute(hiddenAttr);\n            }\n            const { children } = self;\n            if (options.showAllItemsBeforeCalculate) {\n                for (const child of children) {\n                    if (child.hasAttribute(hiddenAttr)) {\n                        child.removeAttribute(hiddenAttr);\n                    }\n                }\n            }\n            const containerWidth = self.offsetWidth;\n            const childWidths = [];\n            const tail = slots.tail ? getTail === null || getTail === void 0 ? void 0 : getTail() : null;\n            let childWidthSum = tail ? tail.offsetWidth : 0;\n            let overflow = false;\n            const len = self.children.length - (slots.tail ? 1 : 0);\n            for (let i = 0; i < len - 1; ++i) {\n                if (i < 0)\n                    continue;\n                const child = children[i];\n                if (overflow) {\n                    if (!child.hasAttribute(hiddenAttr)) {\n                        child.setAttribute(hiddenAttr, '');\n                    }\n                    continue;\n                }\n                else if (child.hasAttribute(hiddenAttr)) {\n                    child.removeAttribute(hiddenAttr);\n                }\n                const childWidth = child.offsetWidth;\n                childWidthSum += childWidth;\n                childWidths[i] = childWidth;\n                if (childWidthSum > containerWidth) {\n                    const { updateCounter } = props;\n                    for (let j = i; j >= 0; --j) {\n                        const restCount = len - 1 - j;\n                        if (updateCounter !== undefined) {\n                            updateCounter(restCount);\n                        }\n                        else {\n                            counter.textContent = `${restCount}`;\n                        }\n                        const counterWidth = counter.offsetWidth;\n                        childWidthSum -= childWidths[j];\n                        if (childWidthSum + counterWidth <= containerWidth || j === 0) {\n                            overflow = true;\n                            i = j - 1;\n                            if (tail) {\n                                // tail too long or 1st element too long\n                                // we only consider tail now\n                                if (i === -1) {\n                                    tail.style.maxWidth = `${containerWidth - counterWidth}px`;\n                                    tail.style.boxSizing = 'border-box';\n                                }\n                                else {\n                                    tail.style.maxWidth = '';\n                                }\n                            }\n                            const { onUpdateCount } = props;\n                            if (onUpdateCount)\n                                onUpdateCount(restCount);\n                            break;\n                        }\n                    }\n                }\n            }\n            const { onUpdateOverflow } = props;\n            if (!overflow) {\n                if (onUpdateOverflow !== undefined) {\n                    onUpdateOverflow(false);\n                }\n                counter.setAttribute(hiddenAttr, '');\n            }\n            else {\n                if (onUpdateOverflow !== undefined) {\n                    onUpdateOverflow(true);\n                }\n            }\n        }\n        const ssrAdapter = useSsrAdapter();\n        style.mount({\n            id: 'vueuc/overflow',\n            head: true,\n            anchorMetaName: cssrAnchorMetaName,\n            ssr: ssrAdapter\n        });\n        onMounted(() => deriveCounter({\n            showAllItemsBeforeCalculate: false\n        }));\n        // besides onMounted, other case should be manually triggered, or we shoud watch items\n        return {\n            selfRef,\n            counterRef,\n            sync: deriveCounter\n        };\n    },\n    render() {\n        const { $slots } = this;\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        nextTick(() => this.sync({\n            showAllItemsBeforeCalculate: false\n        }));\n        // It shouldn't have border\n        return h('div', {\n            class: 'v-overflow',\n            ref: 'selfRef'\n        }, [\n            renderSlot($slots, 'default'),\n            // $slots.counter should only has 1 element\n            $slots.counter\n                ? $slots.counter()\n                : h('span', {\n                    style: {\n                        display: 'inline-block'\n                    },\n                    ref: 'counterRef'\n                }),\n            // $slots.tail should only has 1 element\n            $slots.tail ? $slots.tail() : null\n        ]);\n    }\n});\n"],"names":["hiddenAttr","style","c","display","VOverflow","defineComponent","name","props","getCounter","Function","getTail","updateCounter","onUpdateCount","onUpdateOverflow","setup","slots","selfRef","ref","counterRef","deriveCounter","options","value","self","counter","hasAttribute","removeAttribute","children","showAllItemsBeforeCalculate","child","containerWidth","offsetWidth","childWidths","tail","childWidthSum","overflow","len","length","i","setAttribute","childWidth","j","restCount","textContent","counterWidth","maxWidth","boxSizing","ssrAdapter","useSsrAdapter","mount","id","head","anchorMetaName","cssrAnchorMetaName","ssr","onMounted","sync","render","$slots","this","nextTick","h","class","renderSlot"],"mappings":"8HAIA,MAAMA,EAAa,WACbC,EAAQC,EAAE,aAAc,CAC1BC,QAAS,mBAEbC,EAAeC,EAAgB,CAC3BC,KAAM,WACNC,MAAO,CACHC,WAAYC,SACZC,QAASD,SACTE,cAAeF,SACfG,cAAeH,SACfI,iBAAkBJ,UAEtB,KAAAK,CAAMP,GAAOQ,MAAEA,IACL,MAAAC,EAAUC,EAAI,MACdC,EAAaD,EAAI,MACvB,SAASE,EAAcC,GACb,MAAEC,MAAOC,GAASN,GAClBR,WAAEA,EAAYE,QAAAA,GAAYH,EAC5B,IAAAgB,EAMA,GAJAA,OADe,IAAff,EACUA,IAEAU,EAAWG,OAEpBC,IAASC,EACV,OACAA,EAAQC,aAAaxB,IACrBuB,EAAQE,gBAAgBzB,GAEtB,MAAA0B,SAAEA,GAAaJ,EACrB,GAAIF,EAAQO,4BACR,IAAA,MAAWC,KAASF,EACZE,EAAMJ,aAAaxB,IACnB4B,EAAMH,gBAAgBzB,GAIlC,MAAM6B,EAAiBP,EAAKQ,YACtBC,EAAc,GACdC,EAAOjB,EAAMiB,KAAOtB,aAAyC,EAASA,IAAY,KACpF,IAAAuB,EAAgBD,EAAOA,EAAKF,YAAc,EAC1CI,GAAW,EACf,MAAMC,EAAMb,EAAKI,SAASU,QAAUrB,EAAMiB,KAAO,EAAI,GACrD,IAAA,IAASK,EAAI,EAAGA,EAAIF,EAAM,IAAKE,EAAG,CAC9B,GAAIA,EAAI,EACJ,SACE,MAAAT,EAAQF,EAASW,GACvB,GAAIH,EAAU,CACLN,EAAMJ,aAAaxB,IACd4B,EAAAU,aAAatC,EAAY,IAEnC,QACH,CACQ4B,EAAMJ,aAAaxB,IACxB4B,EAAMH,gBAAgBzB,GAE1B,MAAMuC,EAAaX,EAAME,YAGzB,GAFiBG,GAAAM,EACjBR,EAAYM,GAAKE,EACbN,EAAgBJ,EAAgB,CAC1B,MAAAlB,cAAEA,GAAkBJ,EAC1B,IAAA,IAASiC,EAAIH,EAAGG,GAAK,IAAKA,EAAG,CACnB,MAAAC,EAAYN,EAAM,EAAIK,OACN,IAAlB7B,EACAA,EAAc8B,GAGNlB,EAAAmB,YAAc,GAAGD,IAE7B,MAAME,EAAepB,EAAQO,YAE7B,GADAG,GAAiBF,EAAYS,GACzBP,EAAgBU,GAAgBd,GAAwB,IAANW,EAAS,CAChDN,GAAA,EACXG,EAAIG,EAAI,EACJR,KAGc,IAAVK,GACAL,EAAK/B,MAAM2C,SAAcf,EAAiBc,EAApB,KACtBX,EAAK/B,MAAM4C,UAAY,cAGvBb,EAAK/B,MAAM2C,SAAW,IAGxB,MAAAhC,cAAEA,GAAkBL,EACtBK,GACAA,EAAc6B,GAClB,KACH,CACJ,CACJ,CACJ,CACK,MAAA5B,iBAAEA,GAAqBN,EACxB2B,OAOwB,IAArBrB,GACAA,GAAiB,SAPI,IAArBA,GACAA,GAAiB,GAEbU,EAAAe,aAAatC,EAAY,IAOxC,CACD,MAAM8C,EAAaC,IAWZ,OAVP9C,EAAM+C,MAAM,CACRC,GAAI,iBACJC,MAAM,EACNC,eAAgBC,EAChBC,IAAKP,IAETQ,GAAU,IAAMnC,EAAc,CAC1BQ,6BAA6B,MAG1B,CACHX,UACAE,aACAqC,KAAMpC,EAEb,EACD,MAAAqC,GACU,MAAAC,OAAEA,GAAWC,KAMnB,OAJSC,GAAA,IAAMD,KAAKH,KAAK,CACrB5B,6BAA6B,MAG1BiC,EAAE,MAAO,CACZC,MAAO,aACP5C,IAAK,WACN,CACC6C,EAAWL,EAAQ,WAEnBA,EAAOlC,QACDkC,EAAOlC,UACPqC,EAAE,OAAQ,CACR3D,MAAO,CACHE,QAAS,gBAEbc,IAAK,eAGbwC,EAAOzB,KAAOyB,EAAOzB,OAAS,MAErC","x_google_ignoreList":[0]}