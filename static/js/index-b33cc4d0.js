var e=Object.defineProperty,n=(n,t,r)=>(((n,t,r)=>{t in n?e(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r})(n,"symbol"!=typeof t?t+"":t,r),r);import{d as t,h as r,c as o,f as a,g as i,a2 as l,a1 as d,al as s,am as c,an as u,z as h,Y as f,k as v,n as p,l as g,j as b,J as y,u as m,ao as k,ag as x,m as w,a6 as _,p as C,ak as S,ap as R,aq as T,N as D,Z as N,y as L,ar as P,aj as I,af as B,i as K,w as F,A as M,a3 as A,as as E,ah as O,a9 as z,B as $,H as j}from"./index-7bb835e0.js";import{V,N as U,T as q,M as G}from"./use-form-render-ef347301.js";import{a as H,u as W,S as Y}from"./source-modal-7441b166.js";import{u as J}from"./Button-8cdbb8f8.js";import{u as X,c as Q,d as Z}from"./use-merged-state-6be15dc6.js";import{a as ee,i as ne,X as te}from"./Scrollbar-eb16fdf0.js";import{h as re,f as oe,c as ae,a as ie}from"./create-9f3e5028.js";import{p as le,g as de}from"./Add-b7fedd40.js";import{N as se}from"./Dropdown-3050addb.js";function ce(e){return"string"==typeof e?`s-${e}`:`n-${e}`}const ue=t({name:"Switcher",render:()=>r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},r("path",{d:"M12 8l10 8l-10 8z"}))}),he=r("svg",{viewBox:"0 0 64 64",class:"check-icon"},r("path",{d:"M50.42,16.76L22.34,39.45l-8.1-11.46c-1.12-1.58-3.3-1.96-4.88-0.84c-1.58,1.12-1.95,3.3-0.84,4.88l10.26,14.51  c0.56,0.79,1.42,1.31,2.38,1.45c0.16,0.02,0.32,0.03,0.48,0.03c0.8,0,1.57-0.27,2.2-0.78l30.99-25.03c1.5-1.21,1.74-3.42,0.52-4.92  C54.13,15.78,51.93,15.55,50.42,16.76z"})),fe=r("svg",{viewBox:"0 0 100 100",class:"line-icon"},r("path",{d:"M80.2,55.5H21.4c-2.8,0-5.1-2.5-5.1-5.5l0,0c0-3,2.3-5.5,5.1-5.5h58.7c2.8,0,5.1,2.5,5.1,5.5l0,0C85.2,53.1,82.9,55.5,80.2,55.5z"})),ve=o("n-checkbox-group"),pe=a([i("checkbox","\n line-height: var(--n-label-line-height);\n font-size: var(--n-font-size);\n outline: none;\n cursor: pointer;\n display: inline-flex;\n flex-wrap: nowrap;\n align-items: flex-start;\n word-break: break-word;\n --n-merged-color-table: var(--n-color-table);\n ",[a("&:hover",[i("checkbox-box",[l("border",{border:"var(--n-border-checked)"})])]),a("&:focus:not(:active)",[i("checkbox-box",[l("border","\n border: var(--n-border-focus);\n box-shadow: var(--n-box-shadow-focus);\n ")])]),d("inside-table",[i("checkbox-box","\n background-color: var(--n-merged-color-table);\n ")]),d("checked",[i("checkbox-box","\n background-color: var(--n-color-checked);\n ",[i("checkbox-icon",[a(".check-icon","\n opacity: 1;\n transform: scale(1);\n ")])])]),d("indeterminate",[i("checkbox-box",[i("checkbox-icon",[a(".check-icon","\n opacity: 0;\n transform: scale(.5);\n "),a(".line-icon","\n opacity: 1;\n transform: scale(1);\n ")])])]),d("checked, indeterminate",[a("&:focus:not(:active)",[i("checkbox-box",[l("border","\n border: var(--n-border-checked);\n box-shadow: var(--n-box-shadow-focus);\n ")])]),i("checkbox-box","\n background-color: var(--n-color-checked);\n border-left: 0;\n border-top: 0;\n ",[l("border",{border:"var(--n-border-checked)"})])]),d("disabled",{cursor:"not-allowed"},[d("checked",[i("checkbox-box","\n background-color: var(--n-color-disabled-checked);\n ",[l("border",{border:"var(--n-border-disabled-checked)"}),i("checkbox-icon",[a(".check-icon, .line-icon",{fill:"var(--n-check-mark-color-disabled-checked)"})])])]),i("checkbox-box","\n background-color: var(--n-color-disabled);\n ",[l("border",{border:"var(--n-border-disabled)"}),i("checkbox-icon",[a(".check-icon, .line-icon",{fill:"var(--n-check-mark-color-disabled)"})])]),l("label",{color:"var(--n-text-color-disabled)"})]),i("checkbox-box-wrapper","\n position: relative;\n width: var(--n-size);\n flex-shrink: 0;\n flex-grow: 0;\n user-select: none;\n -webkit-user-select: none;\n "),i("checkbox-box","\n position: absolute;\n left: 0;\n top: 50%;\n transform: translateY(-50%);\n height: var(--n-size);\n width: var(--n-size);\n display: inline-block;\n box-sizing: border-box;\n border-radius: var(--n-border-radius);\n background-color: var(--n-color);\n transition: background-color 0.3s var(--n-bezier);\n ",[l("border","\n transition:\n border-color .3s var(--n-bezier),\n box-shadow .3s var(--n-bezier);\n border-radius: inherit;\n position: absolute;\n left: 0;\n right: 0;\n top: 0;\n bottom: 0;\n border: var(--n-border);\n "),i("checkbox-icon","\n display: flex;\n align-items: center;\n justify-content: center;\n position: absolute;\n left: 1px;\n right: 1px;\n top: 1px;\n bottom: 1px;\n ",[a(".check-icon, .line-icon","\n width: 100%;\n fill: var(--n-check-mark-color);\n opacity: 0;\n transform: scale(0.5);\n transform-origin: center;\n transition:\n fill 0.3s var(--n-bezier),\n transform 0.3s var(--n-bezier),\n opacity 0.3s var(--n-bezier),\n border-color 0.3s var(--n-bezier);\n "),s({left:"1px",top:"1px"})])]),l("label","\n color: var(--n-text-color);\n transition: color .3s var(--n-bezier);\n user-select: none;\n -webkit-user-select: none;\n padding: var(--n-label-padding);\n font-weight: var(--n-label-font-weight);\n ",[a("&:empty",{display:"none"})])]),c(i("checkbox","\n --n-merged-color-table: var(--n-color-table-modal);\n ")),u(i("checkbox","\n --n-merged-color-table: var(--n-color-table-popover);\n "))]),ge=t({name:"Checkbox",props:Object.assign(Object.assign({},m.props),{size:String,checked:{type:[Boolean,String,Number],default:void 0},defaultChecked:{type:[Boolean,String,Number],default:!1},value:[String,Number],disabled:{type:Boolean,default:void 0},indeterminate:Boolean,label:String,focusable:{type:Boolean,default:!0},checkedValue:{type:[Boolean,String,Number],default:!0},uncheckedValue:{type:[Boolean,String,Number],default:!1},"onUpdate:checked":[Function,Array],onUpdateChecked:[Function,Array],privateInsideTable:Boolean,onChange:[Function,Array]}),setup(e){h((()=>{e.onChange&&f("checkbox","`on-change` is deprecated, please use `on-update:checked` instead.")}));const n=v(null),{mergedClsPrefixRef:t,inlineThemeDisabled:r,mergedRtlRef:o}=p(e),a=J(e,{mergedSize(n){const{size:t}=e;if(void 0!==t)return t;if(d){const{value:e}=d.mergedSizeRef;if(void 0!==e)return e}if(n){const{mergedSize:e}=n;if(void 0!==e)return e.value}return"medium"},mergedDisabled(n){const{disabled:t}=e;if(void 0!==t)return t;if(d){if(d.disabledRef.value)return!0;const{maxRef:{value:e},checkedCountRef:n}=d;if(void 0!==e&&n.value>=e&&!R.value)return!0;const{minRef:{value:t}}=d;if(void 0!==t&&n.value<=t&&R.value)return!0}return!!n&&n.disabled.value}}),{mergedDisabledRef:i,mergedSizeRef:l}=a,d=g(ve,null),s=v(e.defaultChecked),c=b(e,"checked"),u=X(c,s),R=y((()=>{if(d){const n=d.valueSetRef.value;return!(!n||void 0===e.value)&&n.has(e.value)}return u.value===e.checkedValue})),T=m("Checkbox","-checkbox",pe,k,e,t);function D(n){if(d&&void 0!==e.value)d.toggleCheckbox(!R.value,e.value);else{const{onChange:t,"onUpdate:checked":r,onUpdateChecked:o}=e,{nTriggerFormInput:i,nTriggerFormChange:l}=a,d=R.value?e.uncheckedValue:e.checkedValue;r&&Q(r,d,n),o&&Q(o,d,n),t&&Q(t,d,n),i(),l(),s.value=d}}const N={focus:()=>{var e;null===(e=n.value)||void 0===e||e.focus()},blur:()=>{var e;null===(e=n.value)||void 0===e||e.blur()}},L=x("Checkbox",o,t),P=w((()=>{const{value:e}=l,{common:{cubicBezierEaseInOut:n},self:{borderRadius:t,color:r,colorChecked:o,colorDisabled:a,colorTableHeader:i,colorTableHeaderModal:d,colorTableHeaderPopover:s,checkMarkColor:c,checkMarkColorDisabled:u,border:h,borderFocus:f,borderDisabled:v,borderChecked:p,boxShadowFocus:g,textColor:b,textColorDisabled:y,checkMarkColorDisabledChecked:m,colorDisabledChecked:k,borderDisabledChecked:x,labelPadding:w,labelLineHeight:C,labelFontWeight:S,[_("fontSize",e)]:R,[_("size",e)]:D}}=T.value;return{"--n-label-line-height":C,"--n-label-font-weight":S,"--n-size":D,"--n-bezier":n,"--n-border-radius":t,"--n-border":h,"--n-border-checked":p,"--n-border-focus":f,"--n-border-disabled":v,"--n-border-disabled-checked":x,"--n-box-shadow-focus":g,"--n-color":r,"--n-color-checked":o,"--n-color-table":i,"--n-color-table-modal":d,"--n-color-table-popover":s,"--n-color-disabled":a,"--n-color-disabled-checked":k,"--n-text-color":b,"--n-text-color-disabled":y,"--n-check-mark-color":c,"--n-check-mark-color-disabled":u,"--n-check-mark-color-disabled-checked":m,"--n-font-size":R,"--n-label-padding":w}})),I=r?C("checkbox",w((()=>l.value[0])),P,e):void 0;return Object.assign(a,N,{rtlEnabled:L,selfRef:n,mergedClsPrefix:t,mergedDisabled:i,renderedChecked:R,mergedTheme:T,labelId:S(),handleClick:function(e){i.value||D(e)},handleKeyUp:function(e){if(!i.value)switch(e.key){case" ":case"Enter":D(e)}},handleKeyDown:function(e){if(" "===e.key)e.preventDefault()},cssVars:r?void 0:P,themeClass:null==I?void 0:I.themeClass,onRender:null==I?void 0:I.onRender})},render(){var e;const{$slots:n,renderedChecked:t,mergedDisabled:o,indeterminate:a,privateInsideTable:i,cssVars:l,labelId:d,label:s,mergedClsPrefix:c,focusable:u,handleKeyUp:h,handleKeyDown:f,handleClick:v}=this;return null===(e=this.onRender)||void 0===e||e.call(this),r("div",{ref:"selfRef",class:[`${c}-checkbox`,this.themeClass,this.rtlEnabled&&`${c}-checkbox--rtl`,t&&`${c}-checkbox--checked`,o&&`${c}-checkbox--disabled`,a&&`${c}-checkbox--indeterminate`,i&&`${c}-checkbox--inside-table`],tabindex:o||!u?void 0:0,role:"checkbox","aria-checked":a?"mixed":t,"aria-labelledby":d,style:l,onKeyup:h,onKeydown:f,onClick:v,onMousedown:()=>{ee("selectstart",window,(e=>{e.preventDefault()}),{once:!0})}},r("div",{class:`${c}-checkbox-box-wrapper`}," ",r("div",{class:`${c}-checkbox-box`},r(R,null,{default:()=>this.indeterminate?r("div",{key:"indeterminate",class:`${c}-checkbox-icon`},fe):r("div",{key:"check",class:`${c}-checkbox-icon`},he)}),r("div",{class:`${c}-checkbox-box__border`}))),null!==s||n.default?r("span",{class:`${c}-checkbox__label`,id:d},n.default?n.default():s):null)}}),be=o("n-tree-select"),ye=o("n-tree"),me=t({name:"NTreeSwitcher",props:{clsPrefix:{type:String,required:!0},expanded:Boolean,selected:Boolean,hide:Boolean,loading:Boolean,onClick:Function},setup(e){const{renderSwitcherIconRef:n}=g(ye,null);return()=>{const{clsPrefix:t}=e;return r("span",{"data-switcher":!0,class:[`${t}-tree-node-switcher`,e.expanded&&`${t}-tree-node-switcher--expanded`,e.hide&&`${t}-tree-node-switcher--hide`],onClick:e.onClick},r("div",{class:`${t}-tree-node-switcher__icon`},r(R,null,{default:()=>{if(e.loading)return r(T,{clsPrefix:t,key:"loading",radius:85,strokeWidth:20});const{value:o}=n;return o?o({expanded:e.expanded,selected:e.selected}):r(D,{clsPrefix:t,key:"switcher"},{default:()=>r(ue,null)})}})))}}}),ke=t({name:"NTreeNodeCheckbox",props:{clsPrefix:{type:String,required:!0},right:Boolean,focusable:Boolean,disabled:Boolean,checked:Boolean,indeterminate:Boolean,onCheck:Function},setup(e){function n(n){const{onCheck:t}=e;t&&t(n)}return{handleUpdateValue:function(t){e.indeterminate?n(!1):n(t)},mergedTheme:g(ye).mergedThemeRef}},render(){const{clsPrefix:e,mergedTheme:n,checked:t,indeterminate:o,disabled:a,focusable:i,handleUpdateValue:l}=this;return r("span",{class:[`${e}-tree-node-checkbox`,this.right&&`${e}-tree-node-checkbox--right`],"data-checkbox":!0},r(ge,{focusable:i,disabled:a,theme:n.peers.Checkbox,themeOverrides:n.peerOverrides.Checkbox,checked:t,indeterminate:o,onUpdateChecked:l}))}}),xe=t({name:"TreeNodeContent",props:{clsPrefix:{type:String,required:!0},disabled:Boolean,checked:Boolean,selected:Boolean,onClick:Function,onDragstart:Function,tmNode:{type:Object,required:!0},nodeProps:Object},setup(e){const{renderLabelRef:n,renderPrefixRef:t,renderSuffixRef:r,labelFieldRef:o}=g(ye);return{selfRef:v(null),renderLabel:n,renderPrefix:t,renderSuffix:r,labelField:o,handleClick:function(n){!function(n){const{onClick:t}=e;t&&t(n)}(n)}}},render(){const{clsPrefix:e,labelField:n,nodeProps:t,checked:o=!1,selected:a=!1,renderLabel:i,renderPrefix:l,renderSuffix:d,handleClick:s,onDragstart:c,tmNode:{rawNode:u,rawNode:{prefix:h,suffix:f,[n]:v}}}=this;return r("span",Object.assign({},t,{ref:"selfRef",class:[`${e}-tree-node-content`,null==t?void 0:t.class],onClick:s,draggable:void 0!==c||void 0,onDragstart:c}),l||h?r("div",{class:`${e}-tree-node-content__prefix`},l?l({option:u,selected:a,checked:o}):N(h)):null,r("div",{class:`${e}-tree-node-content__text`},i?i({option:u,selected:a,checked:o}):N(v)),d||f?r("div",{class:`${e}-tree-node-content__suffix`},d?d({option:u,selected:a,checked:o}):N(f)):null)}});function we({position:e,offsetLevel:n,indent:t,el:o}){const a={position:"absolute",boxSizing:"border-box",right:0};if("inside"===e)a.left=0,a.top=0,a.bottom=0,a.borderRadius="inherit",a.boxShadow="inset 0 0 0 2px var(--n-drop-mark-color)";else{const r="before"===e?"top":"bottom";a[r]=0,a.left=o.offsetLeft+6-n*t+"px",a.height="2px",a.backgroundColor="var(--n-drop-mark-color)",a.transformOrigin=r,a.borderRadius="1px",a.transform="before"===e?"translateY(-4px)":"translateY(4px)"}return r("div",{style:a})}function _e(e,n){return!!e.rawNode[n]}function Ce(e,n,t,r){null==e||e.forEach((e=>{t(e),Ce(e[n],n,t,r),r(e)}))}function Se(e,n,t,r,o){const a=new Set,i=new Set,l=[];return Ce(e,r,(e=>{if(l.push(e),o(n,e)){i.add(e[t]);for(let e=l.length-2;e>=0;--e){if(a.has(l[e][t]))return;a.add(l[e][t])}}}),(()=>{l.pop()})),{expandedKeys:Array.from(a),highlightKeySet:i}}if(ne&&Image){(new Image).src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="}const Re=t({name:"TreeNode",props:{clsPrefix:{type:String,required:!0},tmNode:{type:Object,required:!0}},setup(e){const n=g(ye),{droppingNodeParentRef:t,droppingMouseNodeRef:r,draggingNodeRef:o,droppingPositionRef:a,droppingOffsetLevelRef:i,nodePropsRef:l,indentRef:d,blockLineRef:s,checkboxPlacementRef:c,checkOnClickRef:u,disabledFieldRef:h}=n,f=y((()=>!!e.tmNode.rawNode.checkboxDisabled)),p=y((()=>_e(e.tmNode,h.value))),b=y((()=>n.disabledRef.value||p.value)),m=w((()=>{const{value:n}=l;if(n)return n({option:e.tmNode.rawNode})})),k=v(null),x={value:null};function _(){const{tmNode:t}=e;if(t.isLeaf||t.shallowLoaded)n.handleSwitcherClick(t);else{if(n.loadingKeysRef.value.has(t.key))return;n.loadingKeysRef.value.add(t.key);const{onLoadRef:{value:e}}=n;e&&e(t.rawNode).then((e=>{!1!==e&&n.handleSwitcherClick(t)})).finally((()=>{n.loadingKeysRef.value.delete(t.key)}))}}L((()=>{x.value=k.value.$el}));const C=y((()=>!p.value&&n.selectableRef.value&&(!n.internalTreeSelect||("child"!==n.mergedCheckStrategyRef.value||n.multipleRef.value&&n.cascadeRef.value||e.tmNode.isLeaf)))),S=y((()=>n.checkableRef.value&&(n.cascadeRef.value||"child"!==n.mergedCheckStrategyRef.value||e.tmNode.isLeaf))),R=y((()=>n.displayedCheckedKeysRef.value.includes(e.tmNode.key))),T=y((()=>{const{value:n}=S;if(!n)return!1;const{value:t}=u;return"boolean"==typeof t?t:t(e.tmNode.rawNode)}));function D(t){const{value:r}=n.expandOnClickRef,{value:o}=C,{value:a}=T;if(!o&&!r&&!a)return;if(re(t,"checkbox")||re(t,"switcher"))return;const{tmNode:i}=e;o&&n.handleSelect(i),r&&!i.isLeaf&&_(),a&&N(!R.value)}function N(t){n.handleCheck(e.tmNode,t)}return{showDropMark:y((()=>{const{value:n}=o;if(!n)return;const{value:t}=a;if(!t)return;const{value:i}=r;if(!i)return;const{tmNode:l}=e;return l.key===i.key})),showDropMarkAsParent:y((()=>{const{value:n}=t;if(!n)return!1;const{tmNode:r}=e,{value:o}=a;return("before"===o||"after"===o)&&n.key===r.key})),pending:y((()=>n.pendingNodeKeyRef.value===e.tmNode.key)),loading:y((()=>n.loadingKeysRef.value.has(e.tmNode.key))),highlight:y((()=>{var t;return null===(t=n.highlightKeySetRef.value)||void 0===t?void 0:t.has(e.tmNode.key)})),checked:R,indeterminate:y((()=>n.displayedIndeterminateKeysRef.value.includes(e.tmNode.key))),selected:y((()=>n.mergedSelectedKeysRef.value.includes(e.tmNode.key))),expanded:y((()=>n.mergedExpandedKeysRef.value.includes(e.tmNode.key))),disabled:b,checkable:S,mergedCheckOnClick:T,checkboxDisabled:f,selectable:C,expandOnClick:n.expandOnClickRef,internalScrollable:n.internalScrollableRef,draggable:n.draggableRef,blockLine:s,nodeProps:m,checkboxFocusable:n.internalCheckboxFocusableRef,droppingPosition:a,droppingOffsetLevel:i,indent:d,checkboxPlacement:c,contentInstRef:k,contentElRef:x,handleCheck:N,handleDrop:function(t){t.preventDefault(),null!==a.value&&n.handleDrop({event:t,node:e.tmNode,dropPosition:a.value})},handleDragStart:function(t){n.handleDragStart({event:t,node:e.tmNode})},handleDragEnter:function(t){t.currentTarget===t.target&&n.handleDragEnter({event:t,node:e.tmNode})},handleDragOver:function(t){t.preventDefault(),n.handleDragOver({event:t,node:e.tmNode})},handleDragEnd:function(t){n.handleDragEnd({event:t,node:e.tmNode})},handleDragLeave:function(t){t.currentTarget===t.target&&n.handleDragLeave({event:t,node:e.tmNode})},handleLineClick:function(e){var n,t;s.value&&(b.value||D(e),null===(t=null===(n=m.value)||void 0===n?void 0:n.onClick)||void 0===t||t.call(n,e))},handleContentClick:function(e){var n,t;s.value||(b.value||D(e),null===(t=null===(n=m.value)||void 0===n?void 0:n.onClick)||void 0===t||t.call(n,e))},handleSwitcherClick:_}},render(){const{tmNode:e,clsPrefix:n,checkable:t,expandOnClick:o,selectable:a,selected:i,checked:l,highlight:d,draggable:s,blockLine:c,indent:u,disabled:h,pending:f,internalScrollable:v,nodeProps:p,checkboxPlacement:g}=this,b=s&&!h?{onDragenter:this.handleDragEnter,onDragleave:this.handleDragLeave,onDragend:this.handleDragEnd,onDrop:this.handleDrop,onDragover:this.handleDragOver}:void 0,y=v?ce(e.key):void 0,m="right"===g,k=t?r(ke,{right:m,focusable:this.checkboxFocusable,disabled:h||this.checkboxDisabled,clsPrefix:n,checked:this.checked,indeterminate:this.indeterminate,onCheck:this.handleCheck}):null;return r("div",Object.assign({class:`${n}-tree-node-wrapper`},b),r("div",Object.assign({},c?p:void 0,{class:[`${n}-tree-node`,{[`${n}-tree-node--selected`]:i,[`${n}-tree-node--checkable`]:t,[`${n}-tree-node--highlight`]:d,[`${n}-tree-node--pending`]:f,[`${n}-tree-node--disabled`]:h,[`${n}-tree-node--selectable`]:a,[`${n}-tree-node--clickable`]:a||o||this.mergedCheckOnClick},null==p?void 0:p.class],"data-key":y,draggable:s&&c,onClick:this.handleLineClick,onDragstart:s&&c&&!h?this.handleDragStart:void 0}),P(e.level,r("div",{class:`${n}-tree-node-indent`},r("div",{style:{width:`${u}px`}}))),r(me,{clsPrefix:n,expanded:this.expanded,selected:i,loading:this.loading,hide:e.isLeaf,onClick:this.handleSwitcherClick}),m?null:k,r(xe,{ref:"contentInstRef",clsPrefix:n,checked:l,selected:i,onClick:this.handleContentClick,nodeProps:c?void 0:p,onDragstart:!s||c||h?void 0:this.handleDragStart,tmNode:e}),s?this.showDropMark?we({el:this.contentElRef.value,position:this.droppingPosition,offsetLevel:this.droppingOffsetLevel,indent:u}):this.showDropMarkAsParent?we({el:this.contentElRef.value,position:"inside",offsetLevel:this.droppingOffsetLevel,indent:u}):null:null,m?k:null))}});const Te=t({name:"TreeMotionWrapper",props:{clsPrefix:{type:String,required:!0},height:Number,nodes:{type:Array,required:!0},mode:{type:String,required:!0},onAfterEnter:{type:Function,required:!0}},render(){const{clsPrefix:e}=this;return r(I,{onAfterEnter:this.onAfterEnter,appear:!0,reverse:"collapse"===this.mode},{default:()=>r("div",{class:[`${e}-tree-motion-wrapper`,`${e}-tree-motion-wrapper--${this.mode}`],style:{height:le(this.height)}},this.nodes.map((n=>r(Re,{clsPrefix:e,tmNode:n}))))})}}),De=i("tree","\n font-size: var(--n-font-size);\n outline: none;\n",[a("ul, li","\n margin: 0;\n padding: 0;\n list-style: none;\n "),a(">",[i("tree-node",[a("&:first-child",{marginTop:0})])]),i("tree-node-indent","\n flex-grow: 0;\n flex-shrink: 0;\n height: 0;\n "),i("tree-motion-wrapper",[d("expand",[B({duration:"0.2s"})]),d("collapse",[B({duration:"0.2s",reverse:!0})])]),i("tree-node-wrapper","\n box-sizing: border-box;\n padding: 3px 0;\n "),i("tree-node","\n transform: translate3d(0,0,0);\n position: relative;\n display: flex;\n border-radius: var(--n-node-border-radius);\n transition: background-color .3s var(--n-bezier);\n ",[d("highlight",[i("tree-node-content",[l("text",{borderBottomColor:"var(--n-node-text-color-disabled)"})])]),d("disabled",[i("tree-node-content","\n color: var(--n-node-text-color-disabled);\n cursor: not-allowed;\n ")]),K("disabled",[d("clickable",[i("tree-node-content","\n cursor: pointer;\n ")])])]),d("block-node",[i("tree-node-content","\n flex: 1;\n min-width: 0;\n ")]),K("block-line",[i("tree-node",[K("disabled",[i("tree-node-content",[a("&:hover",{backgroundColor:"var(--n-node-color-hover)"})]),d("selectable",[i("tree-node-content",[a("&:active",{backgroundColor:"var(--n-node-color-pressed)"})])]),d("pending",[i("tree-node-content","\n background-color: var(--n-node-color-hover);\n ")]),d("selected",[i("tree-node-content",{backgroundColor:"var(--n-node-color-active)"})])])])]),d("block-line",[i("tree-node",[K("disabled",[a("&:hover",{backgroundColor:"var(--n-node-color-hover)"}),d("pending","\n background-color: var(--n-node-color-hover);\n "),d("selectable",[K("selected",[a("&:active",{backgroundColor:"var(--n-node-color-pressed)"})])]),d("selected",{backgroundColor:"var(--n-node-color-active)"})]),d("disabled","\n cursor: not-allowed;\n ")])]),i("tree-node-switcher","\n cursor: pointer;\n display: inline-flex;\n flex-shrink: 0;\n height: 24px;\n width: 24px;\n align-items: center;\n justify-content: center;\n transition: transform .15s var(--n-bezier);\n vertical-align: bottom;\n ",[l("icon","\n position: relative;\n height: 14px;\n width: 14px;\n display: flex;\n color: var(--n-arrow-color);\n transition: color .3s var(--n-bezier);\n font-size: 14px;\n ",[i("icon",[s()]),i("base-loading","\n color: var(--n-loading-color);\n position: absolute;\n left: 0;\n top: 0;\n right: 0;\n bottom: 0;\n ",[s()]),i("base-icon",[s()])]),d("hide",{visibility:"hidden"}),d("expanded",{transform:"rotate(90deg)"})]),i("tree-node-checkbox","\n display: inline-flex;\n height: 24px;\n width: 16px;\n vertical-align: bottom;\n align-items: center;\n justify-content: center;\n margin-right: 4px;\n ",[d("right","margin-left: 4px;")]),d("checkable",[i("tree-node-content","\n padding: 0 6px;\n ")]),i("tree-node-content","\n position: relative;\n display: inline-flex;\n align-items: center;\n min-height: 24px;\n box-sizing: border-box;\n line-height: 1.5;\n vertical-align: bottom;\n padding: 0 6px 0 4px;\n cursor: default;\n border-radius: var(--n-node-border-radius);\n text-decoration-color: #0000;\n text-decoration-line: underline;\n color: var(--n-node-text-color);\n transition:\n color .3s var(--n-bezier),\n text-decoration-color .3s var(--n-bezier),\n background-color .3s var(--n-bezier),\n border-color .3s var(--n-bezier);\n ",[a("&:last-child",{marginBottom:0}),l("prefix","\n display: inline-flex;\n margin-right: 8px;\n "),l("text","\n border-bottom: 1px solid #0000;\n transition: border-color .3s var(--n-bezier);\n flex-grow: 1;\n max-width: 100%;\n "),l("suffix","\n display: inline-flex;\n ")]),l("empty","margin: auto;")]);var Ne=globalThis&&globalThis.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{d(r.next(e))}catch(n){a(n)}}function l(e){try{d(r.throw(e))}catch(n){a(n)}}function d(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,l)}d((r=r.apply(e,n||[])).next())}))};const Le={allowCheckingNotLoaded:Boolean,filter:Function,defaultExpandAll:Boolean,expandedKeys:Array,keyField:{type:String,default:"key"},labelField:{type:String,default:"label"},childrenField:{type:String,default:"children"},disabledField:{type:String,default:"disabled"},defaultExpandedKeys:{type:Array,default:()=>[]},indeterminateKeys:Array,renderSwitcherIcon:Function,onUpdateIndeterminateKeys:[Function,Array],"onUpdate:indeterminateKeys":[Function,Array],onUpdateExpandedKeys:[Function,Array],"onUpdate:expandedKeys":[Function,Array]},Pe=t({name:"Tree",props:Object.assign(Object.assign(Object.assign(Object.assign({},m.props),{accordion:Boolean,showIrrelevantNodes:{type:Boolean,default:!0},data:{type:Array,default:()=>[]},expandOnDragenter:{type:Boolean,default:!0},expandOnClick:Boolean,checkOnClick:{type:[Boolean,Function],default:!1},cancelable:{type:Boolean,default:!0},checkable:Boolean,draggable:Boolean,blockNode:Boolean,blockLine:Boolean,disabled:Boolean,checkedKeys:Array,defaultCheckedKeys:{type:Array,default:()=>[]},selectedKeys:Array,defaultSelectedKeys:{type:Array,default:()=>[]},multiple:Boolean,pattern:{type:String,default:""},onLoad:Function,cascade:Boolean,selectable:{type:Boolean,default:!0},indent:{type:Number,default:16},allowDrop:{type:Function,default:function({dropPosition:e,node:n}){return!1===n.isLeaf||(!!n.children||"inside"!==e)}},animated:{type:Boolean,default:!0},checkboxPlacement:{type:String,default:"left"},virtualScroll:Boolean,watchProps:Array,renderLabel:Function,renderPrefix:Function,renderSuffix:Function,nodeProps:Function,keyboard:{type:Boolean,default:!0},getChildren:Function,onDragenter:[Function,Array],onDragleave:[Function,Array],onDragend:[Function,Array],onDragstart:[Function,Array],onDragover:[Function,Array],onDrop:[Function,Array],onUpdateCheckedKeys:[Function,Array],"onUpdate:checkedKeys":[Function,Array],onUpdateSelectedKeys:[Function,Array],"onUpdate:selectedKeys":[Function,Array]}),Le),{internalTreeSelect:Boolean,internalScrollable:Boolean,internalScrollablePadding:String,internalRenderEmpty:Function,internalHighlightKeySet:Object,internalUnifySelectCheck:Boolean,internalCheckboxFocusable:{type:Boolean,default:!0},internalFocusable:{type:Boolean,default:!0},checkStrategy:{type:String,default:"all"},leafOnly:Boolean}),setup(e){h((()=>{e.leafOnly&&f("tree",'`leaf-only` is deprecated, please use `check-strategy="child"` instead')}));const{mergedClsPrefixRef:n,inlineThemeDisabled:t,mergedRtlRef:r}=p(e),o=x("Tree",r,n),a=m("Tree","-tree",De,E,e,n),i=v(null),l=v(null),d=v(null);const s=w((()=>{const{filter:n}=e;if(n)return n;const{labelField:t}=e;return(e,n)=>{if(!e.length)return!0;const r=n[t];return"string"==typeof r&&r.toLowerCase().includes(e.toLowerCase())}})),c=w((()=>{const{pattern:n}=e;return n&&n.length&&s.value?function(e,n,t,r,o){const a=new Set,i=new Set,l=new Set,d=[],s=[],c=[];return function e(d){d.forEach((d=>{if(c.push(d),n(t,d)){a.add(d[r]),l.add(d[r]);for(let e=c.length-2;e>=0;--e){const n=c[e][r];if(i.has(n))break;i.add(n),a.has(n)&&a.delete(n)}}const s=d[o];s&&e(s),c.pop()}))}(e),function e(n,t){n.forEach((n=>{const l=n[r],s=a.has(l),c=i.has(l);if(!s&&!c)return;const u=n[o];if(u)if(s)t.push(n);else{d.push(l);const r=Object.assign(Object.assign({},n),{[o]:[]});t.push(r),e(u,r[o])}else t.push(n)}))}(e,s),{filteredTree:s,highlightKeySet:l,expandedKeys:d}}(e.data,s.value,n,e.keyField,e.childrenField):{filteredTree:e.data,highlightKeySet:null,expandedKeys:void 0}})),u=w((()=>{return ae(e.showIrrelevantNodes?e.data:c.value.filteredTree,(n=e.keyField,t=e.childrenField,r=e.disabledField,{getIsGroup:()=>!1,getKey:e=>e[n],getChildren:e.getChildren||(e=>e[t]),getDisabled:e=>!(!e[r]&&!e.checkboxDisabled)}));var n,t,r})),y=g(be,null),k=e.internalTreeSelect?y.dataTreeMate:u,{watchProps:_}=e,S=v([]);(null==_?void 0:_.includes("defaultCheckedKeys"))?h((()=>{S.value=e.defaultCheckedKeys})):S.value=e.defaultCheckedKeys;const R=b(e,"checkedKeys"),T=X(R,S),D=w((()=>k.value.getCheckedKeys(T.value,{cascade:e.cascade,allowNotLoaded:e.allowCheckingNotLoaded}))),N=function(e){return w((()=>e.leafOnly?"child":e.checkStrategy))}(e),L=w((()=>D.value.checkedKeys)),P=w((()=>{const{indeterminateKeys:n}=e;return void 0!==n?n:D.value.indeterminateKeys})),I=v([]);(null==_?void 0:_.includes("defaultSelectedKeys"))?h((()=>{I.value=e.defaultSelectedKeys})):I.value=e.defaultSelectedKeys;const B=b(e,"selectedKeys"),K=X(B,I),z=v([]),$=n=>{z.value=e.defaultExpandAll?k.value.getNonLeafKeys():void 0===n?e.defaultExpandedKeys:n};(null==_?void 0:_.includes("defaultExpandedKeys"))?h((()=>{$(void 0)})):h((()=>{$(e.defaultExpandedKeys)}));const j=b(e,"expandedKeys"),V=X(j,z),U=w((()=>u.value.getFlattenedNodes(V.value))),{pendingNodeKeyRef:q,handleKeydown:G}=function({props:e,fNodesRef:n,mergedExpandedKeysRef:t,mergedSelectedKeysRef:r,handleSelect:o,handleSwitcherClick:a}){const{value:i}=r,l=g(be,null),d=l?l.pendingNodeKeyRef:v(i.length?i[i.length-1]:null);return{pendingNodeKeyRef:d,handleKeydown:function(r){if(!e.keyboard)return;const{value:i}=d;if(null===i){if("ArrowDown"!==r.key&&"ArrowUp"!==r.key||r.preventDefault(),["ArrowDown","ArrowUp","ArrowLeft","ArrowRight"].includes(r.key)&&null===i){const{value:e}=n;let t=0;for(;t<e.length;){if(!e[t].disabled){d.value=e[t].key;break}t+=1}}}else{const{value:e}=n;let l=e.findIndex((e=>e.key===i));if(!~l)return;if("Enter"===r.key)o(e[l]);else if("ArrowDown"===r.key)for(r.preventDefault(),l+=1;l<e.length;){if(!e[l].disabled){d.value=e[l].key;break}l+=1}else if("ArrowUp"===r.key)for(r.preventDefault(),l-=1;l>=0;){if(!e[l].disabled){d.value=e[l].key;break}l-=1}else if("ArrowLeft"===r.key){const n=e[l];if(n.isLeaf||!t.value.includes(i)){const e=n.getParent();e&&(d.value=e.key)}else a(n)}else if("ArrowRight"===r.key){const n=e[l];if(n.isLeaf)return;if(t.value.includes(i))for(l+=1;l<e.length;){if(!e[l].disabled){d.value=e[l].key;break}l+=1}else a(n)}}}}}({props:e,mergedSelectedKeysRef:K,fNodesRef:U,mergedExpandedKeysRef:V,handleSelect:Ae,handleSwitcherClick:Me});let H=null,W=null;const Y=v(new Set),J=w((()=>e.internalHighlightKeySet||c.value.highlightKeySet)),Z=X(J,Y),ee=v(new Set),ne=w((()=>V.value.filter((e=>!ee.value.has(e)))));let te=0;const re=v(null),le=v(null),de=v(null),se=v(null),ue=v(0),he=w((()=>{const{value:e}=le;return e?e.parent:null}));F(b(e,"data"),(()=>{ee.value.clear(),q.value=null,Ie()}),{deep:!1});let fe=!1;const ve=()=>{fe=!0,A((()=>{fe=!1}))};let pe;function ge(n){return Ne(this,void 0,void 0,(function*(){const{onLoad:t}=e;if(!t)return O("tree","There is unloaded node in data but props.onLoad is not specified."),void(yield Promise.resolve());const{value:r}=ee;if(!r.has(n.key)){r.add(n.key);try{!1===(yield t(n.rawNode))&&Ke()}catch(o){Ke()}r.delete(n.key)}}))}F(b(e,"pattern"),((n,t)=>{if(e.showIrrelevantNodes)if(pe=void 0,n){const{expandedKeys:n,highlightKeySet:t}=Se(e.data,e.pattern,e.keyField,e.childrenField,s.value);Y.value=t,ve(),Te(n,Re(n),{node:null,action:"filter"})}else Y.value=new Set;else if(n.length){t.length||(pe=V.value);const{expandedKeys:e}=c.value;void 0!==e&&(ve(),Te(e,Re(e),{node:null,action:"filter"}))}else void 0!==pe&&(ve(),Te(pe,Re(pe),{node:null,action:"filter"}))})),h((()=>{var e;const{value:n}=u;if(!n)return;const{getNode:t}=n;null===(e=V.value)||void 0===e||e.forEach((e=>{const n=t(e);n&&!n.shallowLoaded&&ge(n)}))}));const me=v(!1),ke=v([]);F(ne,((n,t)=>{if(!e.animated||fe)return void A(Ce);const r=new Set(t);let o=null,a=null;for(const e of n)if(!r.has(e)){if(null!==o)return;o=e}const l=new Set(n);for(const e of t)if(!l.has(e)){if(null!==a)return;a=e}if(null===o&&null===a)return;const{virtualScroll:s}=e,c=(s?d.value.listElRef:i.value).offsetHeight,h=Math.ceil(c/30)+1;let f;if(null!==o&&(f=t),null!==a&&(f=void 0===f?n:f.filter((e=>e!==a))),me.value=!0,ke.value=u.value.getFlattenedNodes(f),null!==o){const e=ke.value.findIndex((e=>e.key===o));if(~e){const t=ke.value[e].children;if(t){const r=oe(t,n);ke.value.splice(e+1,0,{__motion:!0,mode:"expand",height:s?30*r.length:void 0,nodes:s?r.slice(0,h):r})}}}if(null!==a){const e=ke.value.findIndex((e=>e.key===a));if(~e){const t=ke.value[e].children;if(!t)return;me.value=!0;const r=oe(t,n);ke.value.splice(e+1,0,{__motion:!0,mode:"collapse",height:s?30*r.length:void 0,nodes:s?r.slice(0,h):r})}}}));const xe=w((()=>ie(U.value))),we=w((()=>me.value?ke.value:U.value));function Ce(){const{value:e}=l;e&&e.sync()}function Re(e){const{getNode:n}=k.value;return e.map((e=>{var t;return(null===(t=n(e))||void 0===t?void 0:t.rawNode)||null}))}function Te(n,t,r){const{"onUpdate:expandedKeys":o,onUpdateExpandedKeys:a}=e;z.value=n,o&&Q(o,n,t,r),a&&Q(a,n,t,r)}function Le(n,t,r){const{"onUpdate:checkedKeys":o,onUpdateCheckedKeys:a}=e;S.value=n,a&&Q(a,n,t,r),o&&Q(o,n,t,r)}function Pe(n,t,r){const{"onUpdate:selectedKeys":o,onUpdateSelectedKeys:a}=e;I.value=n,a&&Q(a,n,t,r),o&&Q(o,n,t,r)}function Ie(){re.value=null,Be()}function Be(){ue.value=0,le.value=null,de.value=null,se.value=null,Ke()}function Ke(){H&&(window.clearTimeout(H),H=null),W=null}function Fe(n,t){if(e.disabled||_e(n,e.disabledField))return;if(e.internalUnifySelectCheck&&!e.multiple)return void Ae(n);const r=t?"check":"uncheck",{checkedKeys:o,indeterminateKeys:a}=k.value[r](n.key,L.value,{cascade:e.cascade,checkStrategy:N.value,allowNotLoaded:e.allowCheckingNotLoaded});Le(o,Re(o),{node:n.rawNode,action:r}),function(n,t){const{"onUpdate:indeterminateKeys":r,onUpdateIndeterminateKeys:o}=e;r&&Q(r,n,t),o&&Q(o,n,t)}(a,Re(a))}function Me(n){e.disabled||me.value||function(n){if(e.disabled)return;const{key:t}=n,{value:r}=V,o=r.findIndex((e=>e===t));if(~o){const e=Array.from(r);e.splice(o,1),Te(e,Re(e),{node:n.rawNode,action:"collapse"})}else{const o=u.value.getNode(t);if(!o||o.isLeaf)return;let a;if(e.accordion){const e=new Set(n.siblings.map((({key:e})=>e)));a=r.filter((n=>!e.has(n))),a.push(t)}else a=r.concat(t);Te(a,Re(a),{node:n.rawNode,action:"expand"})}}(n)}function Ae(n){if(!e.disabled&&e.selectable){if(q.value=n.key,e.internalUnifySelectCheck){const{value:{checkedKeys:t,indeterminateKeys:r}}=D;e.multiple?Fe(n,!(t.includes(n.key)||r.includes(n.key))):Le([n.key],Re([n.key]),{node:n.rawNode,action:"check"})}if(e.multiple){const t=Array.from(K.value),r=t.findIndex((e=>e===n.key));~r?e.cancelable&&t.splice(r,1):~r||t.push(n.key),Pe(t,Re(t),{node:n.rawNode,action:~r?"unselect":"select"})}else{K.value.includes(n.key)?e.cancelable&&Pe([],[],{node:n.rawNode,action:"unselect"}):Pe([n.key],Re([n.key]),{node:n.rawNode,action:"select"})}}}function Ee({event:n,node:t},r=!0){var o;if(!e.draggable||e.disabled||_e(t,e.disabledField))return;const{value:a}=re;if(!a)return;const{allowDrop:i,indent:l}=e;r&&function(n){const{onDragover:t}=e;t&&Q(t,n)}({event:n,node:t.rawNode});const d=n.currentTarget,{height:s,top:c}=d.getBoundingClientRect(),u=n.clientY-c;let h;h=i({node:t.rawNode,dropPosition:"inside",phase:"drag"})?u<=8?"before":u>=s-8?"after":"inside":u<=s/2?"before":"after";const{value:f}=xe;let v,p;const g=f(t.key);if(null===g)return void Be();let b=!1;"inside"===h?(v=t,p="inside"):"before"===h?t.isFirstChild?(v=t,p="before"):(v=U.value[g-1],p="after"):(v=t,p="after"),!v.isLeaf&&V.value.includes(v.key)&&(b=!0,"after"===p&&(v=U.value[g+1],v?p="before":(v=t,p="inside")));const y=v;if(de.value=y,!b&&a.isLastChild&&a.key===v.key&&(p="after"),"after"===p){let e=te-n.clientX,t=0;for(;e>=l/2&&null!==v.parent&&v.isLastChild&&t<1;)e-=l,t+=1,v=v.parent;ue.value=t}else ue.value=0;if(!(a.contains(v)||"inside"===p&&(null===(o=a.parent)||void 0===o?void 0:o.key)===v.key)||a.key===y.key&&a.key===v.key)if(i({node:v.rawNode,dropPosition:p,phase:"drag"})){if(a.key===v.key)Ke();else if(W!==v.key)if("inside"===p){if(e.expandOnDragenter){if(function(e){if(H&&(window.clearTimeout(H),H=null),e.isLeaf)return;W=e.key;const n=()=>{if(W!==e.key)return;const{value:n}=de;if(n&&n.key===e.key&&!V.value.includes(e.key)){const n=V.value.concat(e.key);Te(n,Re(n),{node:e.rawNode,action:"expand"})}H=null,W=null};H=e.shallowLoaded?window.setTimeout((()=>{n()}),1e3):window.setTimeout((()=>{ge(e).then((()=>{n()}))}),1e3)}(v),!v.shallowLoaded&&W!==v.key)return void Ie()}else if(!v.shallowLoaded)return void Ie()}else Ke();else"inside"!==p&&Ke();se.value=p,le.value=v}else Be();else Be()}F(q,(n=>{var t,r;if(null!==n)if(e.virtualScroll)null===(t=d.value)||void 0===t||t.scrollTo({key:n});else if(e.internalScrollable){const{value:e}=l;if(null===e)return;const t=null===(r=e.contentRef)||void 0===r?void 0:r.querySelector(`[data-key="${ce(n)}"]`);if(!t)return;e.scrollTo({el:t})}})),M(ye,{loadingKeysRef:ee,highlightKeySetRef:Z,displayedCheckedKeysRef:L,displayedIndeterminateKeysRef:P,mergedSelectedKeysRef:K,mergedExpandedKeysRef:V,mergedThemeRef:a,mergedCheckStrategyRef:N,nodePropsRef:b(e,"nodeProps"),disabledRef:b(e,"disabled"),checkableRef:b(e,"checkable"),selectableRef:b(e,"selectable"),expandOnClickRef:b(e,"expandOnClick"),onLoadRef:b(e,"onLoad"),draggableRef:b(e,"draggable"),blockLineRef:b(e,"blockLine"),indentRef:b(e,"indent"),cascadeRef:b(e,"cascade"),checkOnClickRef:b(e,"checkOnClick"),checkboxPlacementRef:e.checkboxPlacement,droppingMouseNodeRef:de,droppingNodeParentRef:he,draggingNodeRef:re,droppingPositionRef:se,droppingOffsetLevelRef:ue,fNodesRef:U,pendingNodeKeyRef:q,disabledFieldRef:b(e,"disabledField"),internalScrollableRef:b(e,"internalScrollable"),internalCheckboxFocusableRef:b(e,"internalCheckboxFocusable"),internalTreeSelect:e.internalTreeSelect,renderLabelRef:b(e,"renderLabel"),renderPrefixRef:b(e,"renderPrefix"),renderSuffixRef:b(e,"renderSuffix"),renderSwitcherIconRef:b(e,"renderSwitcherIcon"),labelFieldRef:b(e,"labelField"),multipleRef:b(e,"multiple"),handleSwitcherClick:Me,handleDragEnd:function({event:n,node:t}){Ie(),!e.draggable||e.disabled||_e(t,e.disabledField)||function(n){const{onDragend:t}=e;t&&Q(t,n)}({event:n,node:t.rawNode})},handleDragEnter:function({event:n,node:t}){!e.draggable||e.disabled||_e(t,e.disabledField)||(Ee({event:n,node:t},!1),function(n){const{onDragenter:t}=e;t&&Q(t,n)}({event:n,node:t.rawNode}))},handleDragLeave:function({event:n,node:t}){!e.draggable||e.disabled||_e(t,e.disabledField)||function(n){const{onDragleave:t}=e;t&&Q(t,n)}({event:n,node:t.rawNode})},handleDragStart:function({event:n,node:t}){!e.draggable||e.disabled||_e(t,e.disabledField)||(te=n.clientX,re.value=t,function(n){const{onDragstart:t}=e;t&&Q(t,n)}({event:n,node:t.rawNode}))},handleDrop:function({event:n,node:t,dropPosition:r}){if(!e.draggable||e.disabled||_e(t,e.disabledField))return;const{value:o}=re,{value:a}=le,{value:i}=se;if(o&&a&&i&&e.allowDrop({node:a.rawNode,dropPosition:i,phase:"drag"})&&o.key!==a.key){if("before"===i){const e=o.getNext({includeDisabled:!0});if(e&&e.key===a.key)return void Be()}if("after"===i){const e=o.getPrev({includeDisabled:!0});if(e&&e.key===a.key)return void Be()}!function(n){const{onDrop:t}=e;t&&Q(t,n)}({event:n,node:a.rawNode,dragNode:o.rawNode,dropPosition:r}),Ie()}},handleDragOver:Ee,handleSelect:Ae,handleCheck:Fe});const Oe={handleKeydown:G,scrollTo:function(e){var n;null===(n=d.value)||void 0===n||n.scrollTo(e)},getCheckedData:()=>{if(!e.checkable)return{keys:[],options:[]};const{checkedKeys:n}=D.value;return{keys:n,options:Re(n)}},getIndeterminateData:()=>{if(!e.checkable)return{keys:[],options:[]};const{indeterminateKeys:n}=D.value;return{keys:n,options:Re(n)}}},ze=w((()=>{const{common:{cubicBezierEaseInOut:e},self:{fontSize:n,nodeBorderRadius:t,nodeColorHover:r,nodeColorPressed:o,nodeColorActive:i,arrowColor:l,loadingColor:d,nodeTextColor:s,nodeTextColorDisabled:c,dropMarkColor:u}}=a.value;return{"--n-arrow-color":l,"--n-loading-color":d,"--n-bezier":e,"--n-font-size":n,"--n-node-border-radius":t,"--n-node-color-active":i,"--n-node-color-hover":r,"--n-node-color-pressed":o,"--n-node-text-color":s,"--n-node-text-color-disabled":c,"--n-drop-mark-color":u}})),$e=t?C("tree",void 0,ze,e):void 0;return Object.assign(Object.assign({},Oe),{mergedClsPrefix:n,mergedTheme:a,rtlEnabled:o,fNodes:we,aip:me,selfElRef:i,virtualListInstRef:d,scrollbarInstRef:l,handleFocusout:function(n){var t;if(e.virtualScroll||e.internalScrollable){const{value:e}=l;if(null===(t=null==e?void 0:e.containerRef)||void 0===t?void 0:t.contains(n.relatedTarget))return;q.value=null}else{const{value:e}=i;if(null==e?void 0:e.contains(n.relatedTarget))return;q.value=null}},handleDragLeaveTree:function(e){e.target===e.currentTarget&&Be()},handleScroll:function(){Ce()},getScrollContainer:function(){var e;return null===(e=d.value)||void 0===e?void 0:e.listElRef},getScrollContent:function(){var e;return null===(e=d.value)||void 0===e?void 0:e.itemsElRef},handleAfterEnter:function(){me.value=!1,e.virtualScroll&&A(Ce)},handleResize:function(){Ce()},cssVars:t?void 0:ze,themeClass:null==$e?void 0:$e.themeClass,onRender:null==$e?void 0:$e.onRender})},render(){var e;const{fNodes:n,internalRenderEmpty:t}=this;if(!n.length&&t)return t();const{mergedClsPrefix:o,blockNode:a,blockLine:i,draggable:l,disabled:d,internalFocusable:s,checkable:c,handleKeydown:u,rtlEnabled:h,handleFocusout:f}=this,v=s&&!d,p=v?"0":void 0,g=[`${o}-tree`,h&&`${o}-tree--rtl`,c&&`${o}-tree--checkable`,(i||a)&&`${o}-tree--block-node`,i&&`${o}-tree--block-line`],b=e=>"__motion"in e?r(Te,{height:e.height,nodes:e.nodes,clsPrefix:o,mode:e.mode,onAfterEnter:this.handleAfterEnter}):r(Re,{key:e.key,tmNode:e,clsPrefix:o});if(this.virtualScroll){const{mergedTheme:e,internalScrollablePadding:n}=this,t=de(n||"0");return r(te,{ref:"scrollbarInstRef",onDragleave:l?this.handleDragLeaveTree:void 0,container:this.getScrollContainer,content:this.getScrollContent,class:g,theme:e.peers.Scrollbar,themeOverrides:e.peerOverrides.Scrollbar,tabindex:p,onKeydown:v?u:void 0,onFocusout:v?f:void 0},{default:()=>{var e;return null===(e=this.onRender)||void 0===e||e.call(this),r(V,{ref:"virtualListInstRef",items:this.fNodes,itemSize:30,ignoreItemResize:this.aip,paddingTop:t.top,paddingBottom:t.bottom,class:this.themeClass,style:[this.cssVars,{paddingLeft:t.left,paddingRight:t.right}],onScroll:this.handleScroll,onResize:this.handleResize,showScrollbar:!1,itemResizable:!0},{default:({item:e})=>b(e)})}})}const{internalScrollable:y}=this;return g.push(this.themeClass),null===(e=this.onRender)||void 0===e||e.call(this),y?r(te,{class:g,tabindex:p,onKeydown:v?u:void 0,onFocusout:v?f:void 0,style:this.cssVars,contentStyle:{padding:this.internalScrollablePadding}},{default:()=>r("div",{onDragleave:l?this.handleDragLeaveTree:void 0,ref:"selfElRef"},this.fNodes.map(b))}):r("div",{class:g,tabindex:p,ref:"selfElRef",style:this.cssVars,onKeydown:v?u:void 0,onFocusout:v?f:void 0,onDragleave:l?this.handleDragLeaveTree:void 0},n.length?n.map(b):Z(this.$slots.empty,(()=>[r(U,{class:`${o}-tree__empty`,theme:this.mergedTheme.peers.Empty,themeOverrides:this.mergedTheme.peerOverrides.Empty})])))}});class Ie{constructor(e){n(this,"_viewer"),n(this,"_dataSource"),n(this,"_options"),this._viewer=e,this._dataSource=new Map,this._options=new Map}get add(){return this._add}get delete(){return this._delete}get setVisibleById(){return this._setVisibleById}get flyTo(){return this._flyTo}async _add(e,n){const t=n.feature,r=await Cesium.GeoJsonDataSource.load(e,{stroke:t.stroke||Cesium.Color.HOTPINK,strokeWidth:t.strokeWidth||3,fill:Cesium.Color.fromCssColorString(t.fill)||Cesium.Color.PINK,markerColor:Cesium.Color.fromCssColorString(t.markerColor)||Cesium.Color.PINK,clampToGround:t.clampToGround||!0});this._viewer.dataSources.add(r),this._dataSource.set(n.id,r),this._viewer.flyTo(r)}_getLayerById(e){return this._dataSource.get(e)}_delete(e){const n=this._getLayerById(e);n&&(this._viewer.dataSources.remove(n),this._options.delete(e))}_setVisibleById(e,n){const t=this._getLayerById(e);t&&(t.show=n)}_flyTo(e){const n=this._getLayerById(e);n&&this._viewer.flyTo(n)}}class Be{constructor(e){n(this,"_viewer"),n(this,"_dataSource"),n(this,"_options"),this._viewer=e,this._dataSource=new Map,this._options=new Map}get add(){return this._add}get delete(){return this._delete}get flyTo(){return this._flyTo}get setVisibleById(){return this._setVisibleById}_add(e,n){const{longitude:t,latitude:r,altitude:o}=n.position,a=Cesium.Transforms.eastNorthUpToFixedFrame(Cesium.Cartesian3.fromDegrees(t,r,0)),i=Cesium.Model.fromGltf({url:e,modelMatrix:a,scale:n.scale||100,heightReference:n.heightReference});this._viewer.scene.primitives.add(i),i.readyPromise.then((()=>{this._dataSource.set(n.id,i),this._options.set(n.id,n),this._flyTo(n.id)})).catch((e=>{}))}_getModelById(e){return this._dataSource.get(e)}_delete(e){const n=this._getModelById(e);n&&(this._viewer.scene.primitives.remove(n),this._options.delete(e))}_setVisibleById(e,n){const t=this._getModelById(e);t&&(t.show=n)}_flyTo(e){const n=this._getModelById(e);if(!n)return;const t=n.boundingSphere;this._viewer.camera.flyToBoundingSphere(t)}}const Ke={arcGisMapServer:function(e){return new Cesium.ArcGisMapServerImageryProvider({url:e,enablePickFeatures:!1})},bingMap:function(e,n){return new Cesium.BingMapsImageryProvider({url:e,key:n.key,mapStyle:Cesium.BingMapsStyle.AERIAL})},tileMapServer:function(e){return new Cesium.TileMapServiceImageryProvider({url:e})},mapBox:function(e,n){return e=Cesium.defaultValue(e,"https://api.mapbox.com/v4/"),n.mapId=Cesium.defaultValue(n.mapId,"mapbox.streets"),new Cesium.MapboxImageryProvider({mapId:"mapbox.satellite",accessToken:"pk.eyJ1IjoibGlhbS13dSIsImEiOiJja2lqeTJwY2owMjhhMnpxbGcwODh5ZGhoIn0.fLOknIfMlTVbjkkh9dmYbg"})},singleTile:function(e,n){return n.rectangle=Cesium.defaultValue(n.rectangle,Cesium.Rectangle.fromDegrees(-180,-90,180,90)),new Cesium.SingleTileImageryProvider({url:e,rectangle:n.rectangle})},urlTemplate:function(e){return new Cesium.UrlTemplateImageryProvider({url:e})},webMapService:function(e,n){return new Cesium.WebMapServiceImageryProvider({url:e,layers:n.laers,parameters:n.parameters})},webMapTileService:function(e,n){return new Cesium.WebMapTileServiceImageryProvider({url:e,layer:n.layer,style:n.style,tileMatrixSetID:n.tileMatrixSetID,format:n.format,maximumLevel:n.maximumLevel})}};class Fe{constructor(e){n(this,"_viewer"),n(this,"_dataSource"),n(this,"_options"),this._viewer=e,this._dataSource=new Map,this._options=new Map}get add(){return this._add}get delete(){return this._delete}get setVisibleById(){return this._setVisibleById}get flyTo(){return this._flyTo}_add(e,n){if(!n.imageryType)throw new Error("未选择影像服务类型！");const t=n.imageryType,r=Ke[t],o=new Cesium.ImageryLayer(r(e,n));this._viewer.imageryLayers.add(o),this._dataSource.set(n.id,o),this._options.set(n.id,n),this._viewer.flyTo(o)}_getLayerById(e){return this._dataSource.get(e)}_delete(e){const n=this._getLayerById(e);n&&(this._viewer.imageryLayers.remove(n),this._options.delete(e),window.$message.success("影像服务删除成功！"))}_setVisibleById(e,n){const t=this._getLayerById(e);t&&(t.show=n)}_flyTo(e){const n=this._getLayerById(e);n&&this._viewer.flyTo(n)}}class Me{constructor(e){n(this,"_viewer"),n(this,"_dataSource"),n(this,"_options"),this._viewer=e,this._dataSource=new Map,this._options=new Map}get add(){return this._add}get delete(){return this._delete}get setVisibleById(){return this._setVisibleById}get flyTo(){return this._flyTo}async _add(e,n){const t=await this._getFeatures(e),r=this._createPrimitive(t,n);this._viewer.scene.primitives.add(r)}async _getFeatures(e){var n;try{const t=await H.get(e);return(null==(n=null==t?void 0:t.data)?void 0:n.features)||[]}catch(t){}}_createPrimitive(e,n){const t=new Cesium.BillboardCollection;return e.forEach((e=>{const r=e.geometry.coordinates,o=z.imageOverlayText(n.special.icon,n.special.text);t.add({position:Cesium.Cartesian3.fromDegrees(...r),image:o,scale:.6,disableDepthTestDistance:Number.POSITIVE_INFINITY})})),t}_getLayerById(e){return this._dataSource.get(e)}_delete(e){const n=this._getLayerById(e);n&&(this._viewer.dataSources.remove(n),this._options.delete(e))}_setVisibleById(e,n){const t=this._getLayerById(e);t&&(t.show=n)}_flyTo(e){const n=this._getLayerById(e);n&&this._viewer.flyTo(n)}}function Ae(){return new Cesium.EllipsoidTerrainProvider}class Ee{constructor(e){n(this,"_viewer"),n(this,"_terrainProvider"),n(this,"_visible"),n(this,"_options"),this._viewer=e,this._terrainProvider=Ae(),this._visible=!1,this._options=null}get add(){return this._add}get show(){return this._show}get delete(){return this._delete}_add(e,n={}){const t=Cesium.defaultValue(n.terrainType,q.ellipsoidTerrain);t===q.ellipsoidTerrain?this._terrainProvider=Ae():t===q.cesiumTerrain?this._terrainProvider=function(e,n){return new Cesium.CesiumTerrainProvider({url:e,requestVertexNormals:n.requestVertexNormals})}(e,n):t===q.worldTerrain&&(this._terrainProvider=function(e){return Cesium.createWorldTerrain({requestVertexNormals:null==e?void 0:e.requestVertexNormals,requestWaterMask:null==e?void 0:e.requestWaterMask})}(n)),this._viewer.terrainProvider=this._terrainProvider,this._viewer.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(116.6749,40.7731,5e3)}),this._options=n}_show(e){if(e!==this._visible){const n=new Cesium.EllipsoidTerrainProvider;this._viewer.terrainProvider=e?this._terrainProvider:n,this._visible=e}}_delete(){const e=new Cesium.EllipsoidTerrainProvider;this._viewer.terrainProvider=e}}class Oe{constructor(e){n(this,"_viewer"),n(this,"_dataSource"),n(this,"_options"),this._viewer=e,this._dataSource=new Map,this._options=new Map}get add(){return this._add}get delete(){return this._delete}get flyTo(){return this._flyTo}get setVisibleById(){return this._setVisibleById}_add(e,n){const t=new Cesium.Cesium3DTileset({url:e,maximumMemoryUsage:n.maximumMemoryUsage||128,maximumScreenSpaceError:n.maximumScreenSpaceError||64});this._viewer.scene.primitives.add(t),t.readyPromise.then((()=>{this._dataSource.set(n.id,t),this._options.set(n.id,n),this._viewer.flyTo(t)})).catch((e=>{}))}_getTilesetById(e){return this._dataSource.get(e)}_delete(e){const n=this._getTilesetById(e);n&&(this._viewer.scene.primitives.remove(n),this._options.delete(e))}_setVisibleById(e,n){const t=this._getTilesetById(e);t&&(t.show=n)}_flyTo(e){const n=this._getTilesetById(e);n&&this._viewer.flyTo(n)}}class ze{constructor(e){n(this,"_imageryLayerManager"),n(this,"_tilesetLayerManager"),n(this,"_gltfModelManager"),n(this,"_terrainManager"),n(this,"_featureLayerManager"),n(this,"_specialLayerManager"),this._imageryLayerManager=new Fe(e),this._tilesetLayerManager=new Oe(e),this._gltfModelManager=new Be(e),this._terrainManager=new Ee(e),this._featureLayerManager=new Ie(e),this._specialLayerManager=new Me(e)}get addSource(){return this._addSource}get deleteSource(){return this._deleteSource}get flyTo(){return this._flyTo}get _typeManager(){return{[G.IMAGE_SERVICE]:this._imageryLayerManager,[G.TERRAIN_SERVICE]:this._terrainManager,[G.TILE_SET]:this._tilesetLayerManager,[G.GLTF_MODEL]:this._gltfModelManager,[G.FEATURE]:this._featureLayerManager,[G.FEATURE]:this._featureLayerManager,[G.SPECIAL_SUBJECT]:this._specialLayerManager}}_addSource(e,n,t){this._typeManager[n].add(e,t)}_deleteSource(e,n){this._typeManager[n].delete(e)}_flyTo(e,n){this._typeManager[n].flyTo(e)}}const $e=Symbol("mapViewer"),je="_resourceTree_dcrzl_1",Ve="_jumpBtn_dcrzl_9",Ue=t({name:"ResourceTree",emits:["toChartEdirtor"],setup(e,n){const t=v(null),{stateRef:r,nodeProps:o}=W(),a=g($e),i=new ze(a.value),l=e=>{"ADD"===e?t.value.openModal(r.rightObj.key):"DELETE"===e?c():"FLY_TO"===e&&u(),r.showDropdown=!1},d=()=>{r.showDropdown=!1},s=({url:e,type:n,options:t})=>{i.addSource(e,n,t);const o=r.treeData.find((e=>e.key===n));null==o||o.children.push({label:t.name,key:t.id,isLeaf:!0,parentType:n})},c=()=>{const{key:e,parentType:n}=r.rightObj;i.deleteSource(e,n);const t=r.treeData.find((e=>e.key===n)),o=null==t?void 0:t.children.findIndex((n=>n.key===e));!o||o<0||null==t||t.children.splice(o,1)},u=()=>{const{key:e,parentType:n}=r.rightObj;i.flyTo(e,n)},h=()=>{n.emit("toChartEdirtor")};return()=>$("div",{class:je},[$(Pe,{data:r.treeData,"node-props":o,checkable:!0,"expand-on-click":!0,"default-expand-all":!0,selectable:!0},null),$(se,{trigger:"manual",placement:"bottom-start",show:r.showDropdown,options:r.options,x:r.x,y:r.y,onSelect:l,onClickoutside:d},null),$(Y,{ref:t,onLoadMapSource:s},null),$("div",{class:Ve,onClick:h},[j("进入图表配置")])])}}),qe=Object.freeze(Object.defineProperty({__proto__:null,default:Ue},Symbol.toStringTag,{value:"Module"}));export{Ue as R,qe as i,$e as v};
//# sourceMappingURL=index-b33cc4d0.js.map
