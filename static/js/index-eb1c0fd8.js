var e=Object.defineProperty,t=(t,r,i)=>(((t,r,i)=>{r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[r]=i})(t,"symbol"!=typeof r?r+"":r,i),i);import{M as r,T as i}from"./map-base-9f9b199e.js";import{a as s}from"./axios-743c2fba.js";import{R as a}from"./index-09144989.js";class o{constructor(e){t(this,"viewer"),t(this,"dataSource"),t(this,"options"),this.viewer=e,this.dataSource=new Map,this.options=new Map}async add(e){const t=e.feature,r=await Cesium.GeoJsonDataSource.load(e.url,{stroke:t.stroke||Cesium.Color.HOTPINK,strokeWidth:t.strokeWidth||3,fill:Cesium.Color.fromCssColorString(t.fill).withAlpha(.6)||Cesium.Color.PINK.withAlpha(.6),markerColor:Cesium.Color.fromCssColorString(t.markerColor)||Cesium.Color.PINK,clampToGround:t.clampToGround||!0});this.viewer.dataSources.add(r),this.dataSource.set(e.id,r),this.options.set(e.id,e),this.viewer.flyTo(r)}getLayerById(e){return this.dataSource.get(e)}delete(e){const t=this.getLayerById(e);t&&(this.viewer.dataSources.remove(t),this.options.delete(e))}setVisibleById(e,t){const r=this.getLayerById(e);r&&(r.show=t)}flyTo(e){const t=this.getLayerById(e);t&&this.viewer.flyTo(t)}getLoadedSource(){return{type:r.FEATURE,value:Object.fromEntries(this.options)}}}class n{constructor(e){t(this,"viewer"),t(this,"dataSource"),t(this,"options"),this.viewer=e,this.dataSource=new Map,this.options=new Map}add(e){const{longitude:t,latitude:r,altitude:i}=e.position,s=Cesium.Transforms.eastNorthUpToFixedFrame(Cesium.Cartesian3.fromDegrees(t,r,i)),a=Cesium.Model.fromGltf({url:e.url,modelMatrix:s,scale:e.scale||100,heightReference:e.heightReference});this.viewer.scene.primitives.add(a),a.readyPromise.then((()=>{this.dataSource.set(e.id,a),this.options.set(e.id,e),this.flyTo(e.id)})).catch((e=>{}))}getModelById(e){return this.dataSource.get(e)}delete(e){const t=this.getModelById(e);t&&(this.viewer.scene.primitives.remove(t),this.options.delete(e))}setVisibleById(e,t){const r=this.getModelById(e);r&&(r.show=t)}flyTo(e){const t=this.getModelById(e);if(!t)return;const r=t.boundingSphere;this.viewer.camera.flyToBoundingSphere(r)}getLoadedSource(){return{type:r.GLTF_MODEL,value:Object.fromEntries(this.options)}}}const l={arcGisMapServer:function(e){return new Cesium.ArcGisMapServerImageryProvider({url:e,enablePickFeatures:!1})},bingMap:function(e,t){return new Cesium.BingMapsImageryProvider({url:e,key:t.key,mapStyle:Cesium.BingMapsStyle.AERIAL})},tileMapServer:function(e){return new Cesium.TileMapServiceImageryProvider({url:e})},mapBox:function(e,t){return e=Cesium.defaultValue(e,"https://api.mapbox.com/v4/"),t.mapId=Cesium.defaultValue(t.mapId,"mapbox.streets"),new Cesium.MapboxImageryProvider({mapId:"mapbox.satellite",accessToken:"pk.eyJ1IjoibGlhbS13dSIsImEiOiJja2lqeTJwY2owMjhhMnpxbGcwODh5ZGhoIn0.fLOknIfMlTVbjkkh9dmYbg"})},singleTile:function(e,t){return t.rectangle=Cesium.defaultValue(t.rectangle,Cesium.Rectangle.fromDegrees(-180,-90,180,90)),new Cesium.SingleTileImageryProvider({url:e,rectangle:t.rectangle})},urlTemplate:function(e){return new Cesium.UrlTemplateImageryProvider({url:e})},webMapService:function(e,t){return new Cesium.WebMapServiceImageryProvider({url:e,layers:t.laers,parameters:t.parameters})},webMapTileService:function(e,t){return new Cesium.WebMapTileServiceImageryProvider({url:e,layer:t.layer,style:t.style,tileMatrixSetID:t.tileMatrixSetID,format:t.format,maximumLevel:t.maximumLevel})}};class d{constructor(e){t(this,"viewer"),t(this,"dataSource"),t(this,"options"),this.viewer=e,this.dataSource=new Map,this.options=new Map}add(e){if(!e.imageryType)throw new Error("未选择影像服务类型！");const t=e.imageryType,r=l[t],i=new Cesium.ImageryLayer(r(e.url,e));this.viewer.imageryLayers.add(i),this.dataSource.set(e.id,i),this.options.set(e.id,e),this.viewer.flyTo(i)}getLayerById(e){return this.dataSource.get(e)}delete(e){const t=this.getLayerById(e);t&&(this.viewer.imageryLayers.remove(t),this.options.delete(e),window.$message.success("影像服务删除成功！"))}setVisibleById(e,t){const r=this.getLayerById(e);r&&(r.show=t)}flyTo(e){const t=this.getLayerById(e);t&&this.viewer.flyTo(t)}getLoadedSource(){return{type:r.IMAGE_SERVICE,value:Object.fromEntries(this.options)}}}class u{constructor(e){t(this,"viewer"),t(this,"dataSource"),t(this,"options"),this.viewer=e,this.dataSource=new Map,this.options=new Map}async add(e){const t=await this.getFeatures(e.url),r=this.createCollectioon(t,e);this.viewer.scene.primitives.add(r),this.dataSource.set(e.id,r),this.options.set(e.id,e),this.flyTo(e.id)}async getFeatures(e){var t;try{const r=await s.get(e);return(null==(t=null==r?void 0:r.data)?void 0:t.features)||[]}catch(r){}}createCollectioon(e,t){const r=new Cesium.BillboardCollection({scene:this.viewer.scene});return e.forEach((async e=>{const i=e.geometry.coordinates,s=await a.imageOverlayText(t.special.icon,e.properties[t.special.label]);r.add({position:Cesium.Cartesian3.fromDegrees(...i),image:s,scale:.6,width:t.special.size,disableDepthTestDistance:Number.POSITIVE_INFINITY,heightReference:Cesium.HeightReference.RELATIVE_TO_GROUND})})),r}getLayerById(e){return this.dataSource.get(e)}delete(e){const t=this.getLayerById(e);t&&(this.viewer.scene.primitives.remove(t),this.options.delete(e))}setVisibleById(e,t){const r=this.getLayerById(e);r&&(r.show=t)}flyTo(e){const t=this.getLayerById(e);if(!t)return;const r=t._billboards.map((e=>e.position)),i=Cesium.Rectangle.fromCartesianArray(r);this.viewer.camera.flyTo({destination:i})}getLoadedSource(){return{type:r.SPECIAL_SUBJECT,value:Object.fromEntries(this.options)}}}function h(){return new Cesium.EllipsoidTerrainProvider}class c{constructor(e){t(this,"viewer"),t(this,"terrainProvider"),t(this,"visible"),t(this,"options"),this.viewer=e,this.terrainProvider=h(),this.visible=!1,this.options=null}add(e={}){const t=Cesium.defaultValue(e.terrainType,i.ellipsoidTerrain);t===i.ellipsoidTerrain?this.terrainProvider=h():t===i.cesiumTerrain?this.terrainProvider=function(e,t){return new Cesium.CesiumTerrainProvider({url:e,requestVertexNormals:t.requestVertexNormals})}(e.url,e):t===i.worldTerrain&&(this.terrainProvider=function(e){return Cesium.createWorldTerrain({requestVertexNormals:null==e?void 0:e.requestVertexNormals,requestWaterMask:null==e?void 0:e.requestWaterMask})}(e)),this.viewer.terrainProvider=this.terrainProvider,this.options=e}show(e){if(e!==this.visible){const t=new Cesium.EllipsoidTerrainProvider;this.viewer.terrainProvider=e?this.terrainProvider:t,this.visible=e}}delete(){const e=new Cesium.EllipsoidTerrainProvider;this.viewer.terrainProvider=e}flyTo(){}getLoadedSource(){return{type:r.TERRAIN_SERVICE,value:this.options}}}class m{constructor(e){t(this,"viewer"),t(this,"dataSource"),t(this,"options"),this.viewer=e,this.dataSource=new Map,this.options=new Map}add(e){const t=new Cesium.Cesium3DTileset({url:e.url,maximumMemoryUsage:e.maximumMemoryUsage||128,maximumScreenSpaceError:e.maximumScreenSpaceError||64});this.viewer.scene.primitives.add(t),t.readyPromise.then((()=>{this.dataSource.set(e.id,t),this.options.set(e.id,e),this.viewer.flyTo(t)})).catch((e=>{}))}getTilesetById(e){return this.dataSource.get(e)}delete(e){const t=this.getTilesetById(e);t&&(this.viewer.scene.primitives.remove(t),this.options.delete(e))}setVisibleById(e,t){const r=this.getTilesetById(e);r&&(r.show=t)}flyTo(e){const t=this.getTilesetById(e);t&&this.viewer.flyTo(t)}getLoadedSource(){return{type:r.TILE_SET,value:Object.fromEntries(this.options)}}}class y{constructor(e){t(this,"imageryLayerManager"),t(this,"tilesetLayerManager"),t(this,"gltfModelManager"),t(this,"terrainManager"),t(this,"featureLayerManager"),t(this,"specialLayerManager"),this.imageryLayerManager=new d(e),this.tilesetLayerManager=new m(e),this.gltfModelManager=new n(e),this.terrainManager=new c(e),this.featureLayerManager=new o(e),this.specialLayerManager=new u(e)}get typeManager(){return{[r.IMAGE_SERVICE]:this.imageryLayerManager,[r.TERRAIN_SERVICE]:this.terrainManager,[r.TILE_SET]:this.tilesetLayerManager,[r.GLTF_MODEL]:this.gltfModelManager,[r.FEATURE]:this.featureLayerManager,[r.SPECIAL_SUBJECT]:this.specialLayerManager}}addSource(e,t){this.typeManager[e].add(t)}deleteSource(e,t){this.typeManager[t].delete(e)}flyTo(e,t){this.typeManager[t].flyTo(e)}getTypeDataSource(){return Object.keys(this.typeManager).map((e=>this.typeManager[e].getLoadedSource()))}}export{y as C};
//# sourceMappingURL=index-eb1c0fd8.js.map
