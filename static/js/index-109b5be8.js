var e=Object.defineProperty,t=(t,l,o)=>(((t,l,o)=>{l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[l]=o})(t,"symbol"!=typeof l?l+"":l,o),o);import{a7 as l,k as o,d as n,m as i,B as r,Q as a,z as s,s as c,v as u,C as d,y as h,a8 as p,a9 as v,D as m,aa as f,w as g,I as y,ab as b,ac as w,ad as S,x as A,F as C,ae as x,af as R,ag as N,ah as E,ai as k,R as B,h as L,P as D,aj as M}from"./index-2249f8f9.js";import{u as O}from"./index-89fb1299.js";import{l as P}from"./lodash-5a87719c.js";import{u as I}from"./use-message-13520057.js";const U=l("areaSelect",(()=>{const e=o(null),t=o([]),l=o(!1);return{groupStyle:e,selectedPrimitives:t,areaSelectVisible:l,clearPrimitives:()=>{t.value=[]},setAreaSelectOptions:(l,o)=>{e.value=l,t.value=o},setAreaSelectVisible:e=>{l.value=e}}}));function X(e){return 100*e+"%"}const j=["fontSize","width","height","top","left","borderWidth","letterSpacing","borderRadius"];function Y(e){return{top:e.top,left:e.left,right:e.left+e.width,bottom:e.top+e.height}}function T(e,t=[]){const l={};return Object.keys(e).forEach((o=>{t.includes(o)||e[o]&&(l[o]=e[o],j.includes(o)&&(l[o]+="px"))})),l}function Q(e){const t={};for(const[l,o]of Object.entries(e))o&&(t[l]=`${o}px`);return t}function G(e,t,l){const o=document.getElementById(`primitive${e.id}`).getBoundingClientRect(),n=o.left-t.left+o.width/2,i=o.top-t.top+o.height/2;e.style.width=parseFloat(e.groupStyle.width)/100*l.width,e.style.height=parseFloat(e.groupStyle.height)/100*l.height,e.style.left=n-e.style.width/2,e.style.top=i-e.style.height/2,e.groupStyle={}}const F="_areaSelect_xqv8e_1",V=n({name:"AreaSelect",props:{options:{type:Object,default:()=>{}}},setup:e=>({style:i((()=>({left:e.options.start.x+"px",top:e.options.start.y+"px",width:e.options.width+"px",height:e.options.height+"px"})))}),render(){return r("div",{style:this.style,class:F},null)}});const q=new class{constructor(){t(this,"events",{})}on(e,t){this.events[e]||(this.events[e]=[]),this.events[e].includes(t)||this.events[e].push(t)}off(e,t){const l=this.events[e];l&&(this.events[e]=l.filter((e=>e!==t)))}emit(e,t){const l=this.events[e];if(l&&l.length>0)for(const o of l)o(t)}once(e,t){const l=o=>{t(o),this.off(e,l)};this.on(e,l)}},_="_markLine_18mj9_1",K="_line_18mj9_5",z="_xline_18mj9_11",W="_yline_18mj9_16",H=n({name:"AuxiliaryLine",setup(){const e=O(),t=o([]),l=["xt","xc","xb","yl","yc","yr"],n=o(3),i=a({xt:!1,xc:!1,xb:!1,yl:!1,yc:!1,yr:!1}),d=e=>{t.value.push(e)},h=()=>{Object.keys(i).forEach((e=>{i[e]=!1}))},p=(l,o)=>{const{primitives:n}=e,i=e.curPrimitive;if(!i)return;const{top:r,left:a,right:s,bottom:c}=Y(i.style),u=(s-a)/2,d=(c-r)/2;h(),n.forEach((e=>{if(e==i)return;const n=Y(e.style),{top:h,left:p,bottom:f,right:g}=n,y=(g-p)/2,b=(f-h)/2,w={top:[{isNearly:m(r,h),lineNode:t.value[0],line:"xt",dragShift:h,lineShift:h},{isNearly:m(c,h),lineNode:t.value[0],line:"xt",dragShift:h-(c-r||0),lineShift:h},{isNearly:m((r||0)+d,h+b),lineNode:t.value[1],line:"xc",dragShift:h+b-d,lineShift:h+b},{isNearly:m(r,f),lineNode:t.value[2],line:"xb",dragShift:f,lineShift:f},{isNearly:m(c,f),lineNode:t.value[2],line:"xb",dragShift:f-(c-r||0),lineShift:f}],left:[{isNearly:m(a,p),lineNode:t.value[3],line:"yl",dragShift:p,lineShift:p},{isNearly:m(s,p),lineNode:t.value[3],line:"yl",dragShift:p-(s-a||0),lineShift:p},{isNearly:m((a||0)+u,p+y),lineNode:t.value[4],line:"yc",dragShift:p+y-u,lineShift:p+y},{isNearly:m(a,g),lineNode:t.value[5],line:"yr",dragShift:g,lineShift:g},{isNearly:m(s,g),lineNode:t.value[5],line:"yr",dragShift:g-(s-a||0),lineShift:g}]},S=[];Object.keys(w).forEach((e=>{w[e].forEach((t=>{t.isNearly&&(i.updateStyleByKey(e,t.dragShift),t.lineNode.style[e]=`${t.lineShift}px`,S.push(t.line))}))})),v(S,l,o)}))},v=(e,t,l)=>{l?e.includes("yr")?i.yr=!0:e.includes("yc")?i.yc=!0:e.includes("yl")&&(i.yl=!0):e.includes("yl")?i.yl=!0:e.includes("yc")?i.yc=!0:e.includes("yr")&&(i.yr=!0),t?e.includes("xb")?i.xb=!0:e.includes("xc")?i.xc=!0:e.includes("xt")&&(i.xt=!0):e.includes("xt")?i.xt=!0:e.includes("xc")?i.xc=!0:e.includes("xb")&&(i.xb=!0)},m=(e,t)=>Math.abs(e-t)<=n.value;return s((()=>{q.on("move",(({isDownward:e,isRightward:t})=>{p(e,t)})),q.on("unmove",(()=>{h()})),p(!1,!1)})),()=>r("div",{class:_},[l.map((e=>c(r("div",{key:e,ref:d,class:`${K} ${e.includes("x")?z:W}`},null),[[u,i[e]]])))])}}),Z="_boundBox_112du_1",J="_active_112du_8",$="_point_112du_14";const ee=n({name:"BoundBox",props:{primitive:{type:Object,default:()=>{}},pStyle:{type:Object,default:()=>{}},index:{required:!0,type:Number,default:0}},emits:["closeContextmenu"],setup(e,{slots:t,emit:l}){const n=O(),a=U(),{curPrimitive:s}=d(n),{areaSelectVisible:c}=d(a),{curRef:u,cursors:p,angleToCursor:v,drawPoints:m}={curRef:o(null),cursors:o({}),angleToCursor:[{start:338,end:23,cursor:"nw"},{start:23,end:68,cursor:"n"},{start:68,end:113,cursor:"ne"},{start:113,end:158,cursor:"e"},{start:158,end:203,cursor:"se"},{start:203,end:248,cursor:"s"},{start:248,end:293,cursor:"sw"},{start:293,end:338,cursor:"w"}],drawPoints:{lt:0,t:45,rt:90,r:135,rb:180,b:225,lb:270,l:315}},f=t=>{const{width:l=0,height:o=0}=e.pStyle,n=t.includes("t"),i=t.includes("b"),r=t.includes("l"),a=t.includes("r");let s=r?0:l,c=n?0:o;return!n&&!i||r||a?n||i||!r&&!a||(s=r?0:l,c=Math.floor(o/2)):(s=l/2,c=n?0:o),{marginLeft:"-4px",marginTop:"-4px",left:`${s}px`,top:`${c}px`,cursor:p.value[t]}},g=()=>{const e={};let t=-1;for(const l in m){const o=(m[l]+360)%360;for(let n=0;n<v.length;n++){t=(t+1)%v.length;const n=v[t];if(o<23||o>=338){e[l]="nw-resize";break}if(n.start<=o&&o<n.end){e[l]=n.cursor+"-resize";break}}}return e},y=t=>{if(t.stopPropagation(),t.preventDefault(),c.value)return;n.setClickPrimitiveStatus(!0),n.setCurPrimitive(e.primitive),p.value=g();const l=e.pStyle,o=t.clientY,i=t.clientX,r=l.top||0,a=l.left||0,s=t=>{const l=t.clientX,n=t.clientY,s={top:P.ceil(t.clientY-o+r),left:P.ceil(t.clientX-i+a)};e.primitive.updateStyle(s);const c=n-o>0,u=l-i>0;q.emit("move",{isDownward:c,isRightward:u})},u=()=>{q.emit("unmove"),document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",u)};document.addEventListener("mousemove",s),document.addEventListener("mouseup",u)};h((()=>{s.value&&(p.value=g())}));const b=e=>{e.stopPropagation(),e.preventDefault(),l("closeContextmenu")},w=i((()=>{var t;return(null==(t=s.value)?void 0:t.id)===e.primitive.id})),S=()=>Object.keys(m).map((t=>r("div",{key:t,class:$,style:f(t),onMousedown:l=>((t,l)=>{l.stopPropagation(),l.preventDefault();const{pStyle:o}=e,{height:n=0,width:i=0,top:r=0,left:a=0}=o,s=l.clientX,c=l.clientY,u=e=>{const l=e.clientX,u=e.clientY-c,d=l-s,h=/t/.test(t),p=/b/.test(t),v=/l/.test(t),m=/r/.test(t),f=n+(h?-u:p?u:0),g=i+(v?-d:m?d:0);Object.assign(o,{height:Math.max(f,0),width:Math.max(g,0),left:a+(v?d:0),top:r+(h?u:0)})},d=()=>{document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",d)};document.addEventListener("mousemove",u),document.addEventListener("mouseup",d)})(t,l)},null)));return()=>{var e;return r("div",{ref:u,class:[Z,w.value&&J],onClick:b,onMousedown:y},[w.value?S():null,null==(e=t.default)?void 0:e.call(t)])}}}),te="_contextmenu_1mk8d_1";function le(){const e=O(),t=U(),{curPrimitive:l}=d(e),{groupStyle:o,selectedPrimitives:n}=d(t);return{handleCompose:()=>{const l=[],i=n.value,r=document.querySelector("#editor").getBoundingClientRect();i.forEach((e=>{var t;if("Group"===e.cName){const o={...e.style};null==(t=e.childPrimitives)||t.forEach((e=>{G(e,r,o),l.push(e)}))}else l.push(e)}));const a=n.value,s=new p;s.childPrimitives=l,s.style={...o.value},function(e){var t;const l=e.style;null==(t=e.childPrimitives)||t.forEach((e=>{if(!Object.keys(e.groupStyle).length){const t={...e.style};e.groupStyle=T(t),e.groupStyle.left=X((t.left-l.left)/l.width),e.groupStyle.top=X((t.top-l.top)/l.height),e.groupStyle.width=X(t.width/l.width),e.groupStyle.height=X(t.height/l.height)}}))}(s),e.addPrimitive(s),e.setCurPrimitive(s),e.batchDeletePrimitive(a),t.setAreaSelectVisible(!1),t.clearPrimitives()},handleDecompose:()=>{var t,o;const n={...null==(t=l.value)?void 0:t.style},i=null==(o=l.value)?void 0:o.childPrimitives,r=document.querySelector("#editor"),a=null==r?void 0:r.getBoundingClientRect();e.deleteCurPrimitive(),i.forEach((t=>{G(t,a,n),e.addPrimitive(t)}))}}}const oe=n({name:"ContextMenu",setup(e,{expose:t}){const{menuState:l,operations:n}=(()=>{const e=a({top:o(0),left:o(0),copyData:o(null)}),t=I(),l=O(),{curPrimitive:n}=d(l),{handleCompose:i,handleDecompose:r}=le();return{menuState:e,operations:{handleCopy:()=>{const l=P.cloneDeep(n.value);l.id=v.createId(),e.copyData=l,t.success("复制成功！")},handlePaste:()=>{if(!e.copyData)return void t.warning("请选择组件！");const o=e.copyData;o.style.top=e.top,o.style.left=e.left,l.addPrimitive(o)},handleClearCanvas:()=>{l.clear()},handelDelete:()=>{l.deleteCurPrimitive(),t.success("删除成功！")},handleUp:()=>{l.upCurComponent()},handleDown:()=>{l.downCurComponent()},handleTop:()=>{l.moveCurPrimitiveByIndex(1)},handleBottom:()=>{l.moveCurPrimitiveByIndex(-1)},handleCreateGroup:()=>{i()},handleDeleteGroup:()=>{r()}}}})(),s=O(),h=U(),{areaSelectVisible:p}=d(h),g=a({visible:o(!1),contextType:o(""),contextOptions:o([])}),y=()=>{s.setClickPrimitiveStatus(!0)},b=[{label:"复制",handler:n.handleCopy},{label:"粘贴",handler:n.handlePaste},{label:"删除",handler:n.handelDelete},{label:"置顶",handler:n.handleUp},{label:"置底",handler:n.handleDown},{label:"上移",handler:n.handleTop},{label:"下移",handler:n.handleBottom}],w=[{label:"组合",handler:n.handleCreateGroup},{label:"删除",handler:n.handleDeleteGroup}],S=[{label:"粘贴",handler:n.handlePaste},{label:"清空画布",handler:n.handleClearCanvas}],A=()=>{p.value?g.contextOptions=[...w]:"Editor"===g.contextType?g.contextOptions=[...S]:(g.contextOptions=[...b],"Group"===g.contextType&&g.contextOptions.unshift({label:"解除分组",handler:n.handleDeleteGroup}))},C=i((()=>({top:`${l.top}px`,left:`${l.left}px`})));return t({show:({top:e,left:t,contextType:o})=>{l.top=e,l.left=t,g.contextType=o,A(),g.visible=!0},close:()=>{g.visible=!1}}),()=>r(f,{to:"body"},{default:()=>[c(r("div",{class:te,style:C.value},[r("ul",{onMouseup:y,onMousedown:e=>e.stopPropagation()},[g.contextOptions.map((e=>r("li",{onClick:e.handler},[e.label,m(" "),e.disabled])))])]),[[u,g.visible]])]})}});function ne(){const e=o(null),t=o(null),{groupState:l,onDrawGroupBoundry:n}=function(){const e=O(),t=U(),{primitives:l,editorScale:o}=d(e),n=a({editorX:0,editorY:0,start:{x:0,y:0},width:0,height:0}),i=()=>{n.width=0,n.height=0,t.setAreaSelectVisible(!1),t.setAreaSelectOptions(null,[])},r=()=>{const e=s();if(e.length<=1)return void i();let l=1/0,o=1/0,r=-1/0,a=-1/0;e.forEach((e=>{var t;let i={};"Group"===e.cName?null==(t=e.childPrimitives)||t.forEach((e=>{const t=document.getElementById(`primitive${e.id}`).getBoundingClientRect();i.left=t.left-n.editorX,i.top=t.top-n.editorY,i.right=t.right-n.editorX,i.bottom=t.bottom-n.editorY,i.left<o&&(o=i.left),i.top<l&&(l=i.top),i.right>r&&(r=i.right),i.bottom>a&&(a=i.bottom)})):i=function(e){const t=e.top+e.height,l=e.left+e.width;return{left:e.left,top:e.top,right:l,bottom:t}}(e.style),i.left<o&&(o=i.left),i.top<l&&(l=i.top),i.right>r&&(r=i.right),i.bottom>a&&(a=i.bottom)})),n.start.x=o,n.start.y=l,n.width=r-o,n.height=a-l;const c={left:o,top:l,width:n.width,height:n.height};t.setAreaSelectOptions(c,e)},s=()=>{const{x:e,y:t}=n.start;return l.value.filter((l=>{const{left:o,top:i,width:r,height:a}=l.style;if(e<=o&&t<=i&&o+r<=e+n.width&&i+a<=t+n.height)return l}))};return{groupState:n,onDrawGroupBoundry:e=>{i();const l=document.getElementById("editor").getBoundingClientRect(),a=e.clientX,s=e.clientY;n.editorX=l.x,n.editorY=l.y,n.start.x=100*(a-n.editorX)/o.value,n.start.y=100*(s-n.editorY)/o.value,t.setAreaSelectVisible(!0);const c=e=>{n.width=100*Math.abs(e.clientX-a)/o.value,n.height=100*Math.abs(e.clientY-s)/o.value,e.clientX<a&&(n.start.x=e.clientX-n.editorX),e.clientY<s&&(n.start.y=e.clientY-n.editorY)},u=e=>{document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",u),e.clientX!=a||e.clientY!=s?r():i()};document.addEventListener("mousemove",c),document.addEventListener("mouseup",u)}}}(),i=O(),{curPrimitive:r,primitives:s,editorScale:c}=d(i),u=e=>{if(!e||!e.parentNode)return;const t=e.parentNode;if(!t.getAttribute)return;const l=t.getAttribute("data-context");return l||u(t)};return{groupState:l,editorScale:c,primitives:s,contextMenuRef:e,sketchRulerRef:t,handleMouseUp:t=>{var l;i.isClickPrimitive||i.setCurPrimitive(null),2!==t.button&&(null==(l=e.value)||l.close())},handleMouseDown:e=>{0===e.button&&(i.setClickPrimitiveStatus(!1),r||e.preventDefault(),n(e))},handleMouseWheel:e=>{var l;if(e.ctrlKey||e.metaKey){e.preventDefault(),null==(l=t.value)||l.handleResizeRuler();let o=c.value;if(e.wheelDelta>=0&&o<200)return o+=5,void i.setEditorScale(o);e.wheelDelta<0&&o>10&&(o-=5,i.setEditorScale(o))}},handleMouseScroll:()=>{var e;null==(e=t.value)||e.handleResizeRuler()},handleShowContextMenu:t=>{var l;if(t.stopPropagation(),t.preventDefault(),!t.target)return;const o=t.clientY,n=t.clientX,i=u(t.target);null==(l=e.value)||l.show({top:o,left:n,contextType:i})}}}const ie="_screen_1bmdy_1",re="_container_1bmdy_12",ae="_editor_1bmdy_17",se="_primitive_1bmdy_28",ce=n({name:"PixelGrid",render:()=>r("svg",{style:{position:"absolute",top:0,left:0},width:"100%",height:"100%",xmlns:"http://www.w3.org/2000/svg"},[r("defs",null,[r("pattern",{id:"smallGrid",width:"7.236328125",height:"7.236328125",patternUnits:"userSpaceOnUse"},[r("path",{d:"M 7.236328125 0 L 0 0 0 7.236328125",fill:"none",stroke:"#E5E5E5","stroke-width":"1"},null)]),r("pattern",{id:"grid",width:"36.181640625",height:"36.181640625",patternUnits:"userSpaceOnUse"},[r("rect",{width:"36.181640625",height:"36.181640625",fill:"url(#smallGrid)"},null),r("path",{d:"M 36.181640625 0 L 0 0 0 36.181640625",fill:"none",stroke:"#eee","stroke-width":"1"},null)])]),r("rect",{width:"100%",height:"100%",fill:"url(#grid)"},null)])});
/*!vue3-sketch-ruler v1.3.62022年11月Fri Nov 04 2022 18:18:02 GMT+0800 (中国标准时间)制作*/
var ue=(e,t)=>{const l=e.__vccOpts||e;for(const[o,n]of t)l[o]=n;return l};const de=n({name:"LineRuler",props:{scale:Number,thick:Number,palette:Object,index:Number,start:Number,vertical:Boolean,value:Number,isShowReferLine:Boolean},emits:["onMouseDown","onRelease","onRemove"],setup(e,{emit:t}){const l=o(0),n=o(!0);h((()=>{l.value=e.value}));const r=i((()=>{const t=(l.value-e.start)*e.scale;(e=>{n.value=e>=0})(t);const o=t+"px";return e.vertical?{top:o}:{left:o}})),a=i((()=>{var t;const l=`1px solid ${null==(t=e.palette)?void 0:t.lineColor}`,o=e.vertical?{borderTop:l}:{borderLeft:l};return{cursor:e.isShowReferLine?e.vertical?"ns-resize":"ew-resize":"none",...o}})),s=i((()=>e.vertical?{left:e.thick+"px"}:{top:e.thick+"px"}));return{startValue:l,showLine:n,offset:r,borderCursor:a,actionStyle:s,handleDown:o=>{const n=e.vertical?o.clientY:o.clientX,i=l.value;t("onMouseDown");const r=t=>{const o=e.vertical?t.clientY:t.clientX,r=Math.round(i+(o-n)/e.scale);l.value=r},a=()=>{t("onRelease",l.value,e.index),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",a)};document.addEventListener("mousemove",r),document.addEventListener("mouseup",a)},handleRemove:()=>{t("onRemove",e.index)}}}}),he={class:"value"};var pe=ue(de,[["render",function(e,t,l,o,n,i){return c((b(),w("div",{class:"line",style:A([e.offset,e.borderCursor]),onMousedown:t[1]||(t[1]=(...t)=>e.handleDown&&e.handleDown(...t))},[S("div",{class:"action",style:A(e.actionStyle)},[S("span",{class:"del",onClick:t[0]||(t[0]=(...t)=>e.handleRemove&&e.handleRemove(...t))},"×"),S("span",he,R(e.startValue),1)],4)],36)),[[u,e.showLine]])}],["__scopeId","data-v-5dea28d6"]]);const ve=n({name:"CanvasRuler",props:{showIndicator:Boolean,valueNum:Number,scale:Number,ratio:Number,palette:Object,vertical:Boolean,start:Number,width:Number,height:Number,selectStart:Number,selectLength:Number},emits:["onAddLine","update:showIndicator","update:valueNum"],setup(e,{emit:t}){const l=a({canvasContext:null});let n=1;const i=o(null);h((()=>{n=e.ratio||window.devicePixelRatio||1,r(),s(n),c(n)}));const r=()=>{l.canvasContext=i.value&&i.value.getContext("2d")},s=t=>{if(i.value){i.value.width=e.width*t,i.value.height=e.height*t;const o=l.canvasContext;o&&(o.font=12*t+'px -apple-system,\n                "Helvetica Neue", ".SFNSText-Regular",\n                "SF UI Text", Arial, "PingFang SC", "Hiragino Sans GB",\n                "Microsoft YaHei", "WenQuanYi Zen Hei", sans-serif',o.lineWidth=1,o.textBaseline="middle")}},c=t=>{const o={scale:e.scale,width:e.width,height:e.height,palette:e.palette,ratio:t};l.canvasContext&&((e,t,l,o,n,i)=>{const{scale:r,width:a,height:s,ratio:c,palette:u}=n,{bgColor:d,fontColor:h,shadowColor:p,longfgColor:v,shortfgColor:m}=u;if(e.scale(c,c),e.clearRect(0,0,a,s),e.fillStyle=d,e.fillRect(0,0,a,s),o){const n=(l-t)*r,c=o*r;e.fillStyle=p,i?e.fillRect(n,0,c,3*s/8):e.fillRect(0,n,3*a/8,c)}const f=(e=>e<=.25?40:e<=.5?20:e<=1?10:e<=2?5:e<=4?2:1)(r),g=f*r,y=10*f,b=y*r,w=Math.floor(t/f)*f,S=Math.floor(t/y)*y,A=(w-t)/f*g,C=(S-t)/y*b,x=t+Math.ceil((i?a:s)/r);e.beginPath(),e.fillStyle=h,e.strokeStyle=v;for(let R=S,N=0;R<x;R+=y,N++){const t=C+N*b+.5;i?e.moveTo(t,0):e.moveTo(0,t),e.save(),i?e.translate(t,.4*s):e.translate(.4*a,t),i||e.rotate(-Math.PI/2),e.scale(.83/c,.83/c),e.fillText(R.toString(),4*c,7*c),e.restore(),i?e.lineTo(t,9*s/16):e.lineTo(9*a/16,t)}e.stroke(),e.closePath(),e.beginPath(),e.strokeStyle=m;for(let R=w,N=0;R<x;R+=f,N++){const t=A+N*g+.5;i?e.moveTo(t,0):e.moveTo(0,t),R%y!=0&&(i?e.lineTo(t,1*s/4):e.lineTo(1*a/4,t))}e.stroke(),e.closePath(),e.setTransform(1,0,0,1,0,0)})(l.canvasContext,e.start,e.selectStart,e.selectLength,o,!e.vertical)};g((()=>e.start),(()=>c(n))),g([()=>e.width,()=>e.height],(()=>{s(n),c(n)}));return{handle:(l,o)=>{const n=e.vertical?l.offsetY:l.offsetX,i=(r=n,a=e.start,s=e.scale,Math.round(a+r/s));var r,a,s;switch(o){case"click":t("onAddLine",i);break;case"enter":t("update:valueNum",i),t("update:showIndicator",!0);break;default:t("update:valueNum",i)}},canvas:i}}});const me=n({name:"RulerWrapper",components:{CanvasRuler:ue(ve,[["render",function(e,t,l,o,n,i){return b(),w("canvas",{ref:"canvas",class:"ruler",onClick:t[0]||(t[0]=t=>e.handle(t,"click")),onMouseenter:t[1]||(t[1]=t=>e.handle(t,"enter")),onMousemove:t[2]||(t[2]=t=>e.handle(t,"move")),onMouseleave:t[3]||(t[3]=t=>e.$emit("update:showIndicator",!1))},null,544)}]]),RulerLine:pe},props:{scale:Number,ratio:Number,thick:Number,palette:Object,vertical:{type:Boolean,default:!0},width:{type:Number,default:200},height:{type:Number,default:200},start:{type:Number,default:0},lines:{type:Array,default:()=>[]},selectStart:{type:Number},selectLength:{type:Number},isShowReferLine:{type:Boolean}},setup(e){const t=o(!1),l=o(0),n=i((()=>e.vertical?"v-container":"h-container")),r=i((()=>{const t={width:`calc(100% - ${e.thick}px)`,height:`${e.thick+1}px`,left:`${e.thick}px`},l={width:`${e.thick&&e.thick+1}px`,height:`calc(100% - ${e.thick}px)`,top:`${e.thick}px`};return e.vertical?l:t})),a=i((()=>{var t;const o=(l.value-e.start)*e.scale;let n="top",i="borderLeft";return n=e.vertical?"top":"left",i=e.vertical?"borderBottom":"borderLeft",{[n]:o+"px",[i]:`1px solid ${null==(t=e.palette)?void 0:t.lineColor}`}})),s=t=>{e.lines.splice(t,1)};return{showIndicator:t,valueNum:l,rwClassName:n,rwStyle:r,indicatorStyle:a,handleNewLine:t=>{e.lines.push(t)},handleLineRelease:(t,l)=>{const o=t-e.start,n=(e.vertical?e.height:e.width)/e.scale;o<0||o>n?s(l):e.lines[l]=t},handleLineRemove:s}}}),fe={class:"lines"},ge={class:"value"};const ye=n({name:"SketchRule",components:{RulerWrapper:ue(me,[["render",function(e,t,l,o,n,i){const a=y("CanvasRuler"),s=y("RulerLine");return b(),w("div",{class:N(e.rwClassName),style:A(e.rwStyle)},[r(a,{vertical:e.vertical,scale:e.scale,width:e.width,height:e.height,start:e.start,ratio:e.ratio,"select-start":e.selectStart,"select-length":e.selectLength,palette:e.palette,valueNum:e.valueNum,"onUpdate:valueNum":t[0]||(t[0]=t=>e.valueNum=t),showIndicator:e.showIndicator,"onUpdate:showIndicator":t[1]||(t[1]=t=>e.showIndicator=t),onOnAddLine:e.handleNewLine},null,8,["vertical","scale","width","height","start","ratio","select-start","select-length","palette","valueNum","showIndicator","onOnAddLine"]),c(S("div",fe,[(b(!0),w(C,null,x(e.lines,((t,l)=>(b(),E(s,{key:t+l,index:l,value:t>>0,scale:e.scale,start:e.start,thick:e.thick,palette:e.palette,vertical:e.vertical,"is-show-refer-line":e.isShowReferLine,onOnRemove:e.handleLineRemove,onOnRelease:e.handleLineRelease},null,8,["index","value","scale","start","thick","palette","vertical","is-show-refer-line","onOnRemove","onOnRelease"])))),128))],512),[[u,e.isShowReferLine]]),c(S("div",{class:"indicator",style:A(e.indicatorStyle)},[S("div",ge,R(e.valueNum),1)],4),[[u,e.showIndicator]])],6)}],["__scopeId","data-v-b6c23352"]])},props:{eyeIcon:{type:String},closeEyeIcon:{type:String},scale:{type:Number,default:1},ratio:{type:Number},thick:{type:Number,default:16},palette:Object,startX:{type:Number},startY:{type:Number,default:0},width:{type:Number,default:200},height:{type:Number,default:200},shadow:{type:Object,default:()=>({x:0,y:0,width:0,height:0})},lines:{type:Object,default:()=>({h:[],v:[]})},isShowReferLine:{type:Boolean,default:!0}},emits:["onCornerClick"],setup(e,{emit:t}){let l=o(!0);l.value=e.isShowReferLine;const n=i((()=>{const t=function e(t,l){return Object.keys(t).forEach((o=>{o&&t.hasOwnProperty(o)&&("object"==typeof l.key?t[o]=e(t[o],l[o]):l.hasOwnProperty(o)&&(t[o]=l[o]))})),t}({bgColor:"rgba(225,225,225, 0)",longfgColor:"#BABBBC",shortfgColor:"#C8CDD0",fontColor:"#7D8694",shadowColor:"#E8E8E8",lineColor:"#EB5648",borderColor:"#DADADC",cornerActiveColor:"rgb(235, 86, 72, 0.6)",menu:{bgColor:"#fff",dividerColor:"#DBDBDB",listItem:{textColor:"#415058",hoverTextColor:"#298DF8",disabledTextColor:"rgba(65, 80, 88, 0.4)",bgColor:"#fff",hoverBgColor:"#F2F2F2"}}},e.palette||{});return t})),r=i((()=>({backgroundImage:l.value?`url(${e.eyeIcon||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAopJREFUOE/FlE9IVEEcx7+/N9ouds1Mu0QUSFZYdIgoUqQoKPBQHsKozpXE7jbTO/U8xLJvn6usBHWQ6hBFXupSkQeVbh0KJEPp0sH+eLGTsKs77xcj78m0ax0E8cHjzZv5zef3/c33xxA24KENYGJzoEEQbNNaN4Zh2OQ4znwYhr9c1/39vwrXVDo0NNS0tLR0GYB5D64BmAMwzMyvlFKz1es10Hw+f4mZ7wHYBeA9gNdENFepVOaEEM3M3OI4Thczn41gt6WUgQ3+C+r7/h0AWQD3mXnYqPA8L9nQ0HCemduIaFpKOWoAhUJhT6VSuQXgOjP3K6W8GLwKzeVyp4jonR0QBEErM48w8zFLyayUsjX+z+VyHhHdZebTSqkxM78CHRgYOKS1/ghgVErZY214RkQ7ADyRUj72ff8qgCtmXUrZGcf5vv8CwEUhxOF0Ov1pBRpla5dSdseBhUJhpznH6tIsZb1KqacW+BGArUaUXX63UuplHJTNZjuEEONSyhozfd/n6mQ1RkXZL2itz7mu+80EDA4ONi8vL/8AcM2UbikyR2BU9cSmmTU70YqKIAj2hWFo2uenlHK/BRg3Y2aeNO5GyU8S0ZbFxcUuz/NKEXAGQKPjOCcymcyX1dIi8DSAiWQyeaavr68cbSgCuBknYubnQoj+TCYzUywWE6VS6S2ADsdx2gxw1X3L7SNENMbMnwE8qK+vf5NKpRaMaeVyeW8ikfiaSqW+R7BuZr5BRMe11p2u607U9Gk8kc/ntzPzQwCmExYATDLzVBiGE0KIowAOADDf3QA+aK2VDaxRajto3K+rq+tl5nYAzQBamHmeiOYBTGmtR6ph/1Rqg9c73pz7dD1qN0TpHyNQRCUDJXrAAAAAAElFTkSuQmCC"})`:`url(${e.closeEyeIcon||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAVCAYAAACpF6WWAAAAAXNSR0IArs4c6QAAAjtJREFUOE/NlD9oFEEUxn9v9ghC0hpRUogIAUmniGAT/5Q2FrETPSNRJILg7RwimI0ox85eQFCEBGIUO1PYpFM0jSConQoBEZGgGPsgl+w+2eM2bC57SopAFqYZ3v7m+977ZoQt+GQLmGxPaBiGgYiMWWvXBHZUGoZhH3BERPYC+4F+4Keq/urt7b1RLpf/ZEBVHa9Wq0HWyg3QKIoGVPU8cA7wgK/pUtXPQJ8xZk+pVBpuNBqXUoUiEvi+P56fzTpo6+SbwHNg1lo7WzTITGEKXFlZeeB53tVCpa3CK8AFa+1cBgvD8LKIXAQOJkkyICJDeYVBEJS6u7s/qeoLa+1o+l9TqXNuBLhmjDlbqVQ+5ICjInIfOBPH8W9jzGCR5YmJiRNxHM+papgqzqDvgSlr7VTernPuO3An3c9bBt74vv+yrdaKyLDv+/1Sq9UGPc97nY9EVuycU2AQOA7cAm4Dr4D5TvVxHB9rKo2iaEFVp621Ln96FEUngaOqGmSxabVqsh3a2h+x1h5qQjNrae/yE4+iaCwDJkky73neTuBZe129Xk+H+BS4l7ZqLVIZ2BhzuFKpvMsDVXXWGPMxFdAedOfcKeCRqj7MYrUhpz09PfXl5eXrectFWXXODQHpOq2qd/95o/JXr6ura3J1dXU6SZIfwKKIHAD2tVYMPBGRx77vN10UXtO85fTkmZmZHUtLSzUR2QXsBhaAL6r6DXhbrVYXi1yss59GqOgub/bN3Z7v6X/tb9Zmp/q/kN8s+lJb8oEAAAAASUVORK5CYII="})`,width:e.thick+"px",height:e.thick+"px",borderRight:`1px solid ${n.value.borderColor}`,borderBottom:`1px solid ${n.value.borderColor}`})));return g([()=>e.isShowReferLine],(()=>{l.value=e.isShowReferLine})),{showReferLine:l,paletteCpu:n,cornerStyle:r,onCornerClick:e=>{l.value=!l.value,t("onCornerClick",l.value)}}}}),be={id:"mb-ruler",class:"style-ruler mb-ruler"};var we=ue(ye,[["render",function(e,t,l,o,n,i){const a=y("RulerWrapper");return b(),w("div",be,[r(a,{vertical:!1,width:e.width,height:e.thick,"is-show-refer-line":e.showReferLine,thick:e.thick,ratio:e.ratio,start:e.startX,lines:e.lines.h,"select-start":e.shadow.x,"select-length":e.shadow.width,scale:e.scale,palette:e.paletteCpu},null,8,["width","height","is-show-refer-line","thick","ratio","start","lines","select-start","select-length","scale","palette"]),r(a,{vertical:!0,width:e.thick,height:e.height,"is-show-refer-line":e.showReferLine,thick:e.thick,ratio:e.ratio,start:e.startY,lines:e.lines.v,"select-start":e.shadow.y,"select-length":e.shadow.height,scale:e.scale,palette:e.paletteCpu},null,8,["width","height","is-show-refer-line","thick","ratio","start","lines","select-start","select-length","scale","palette"]),S("a",{class:"corner",style:A(e.cornerStyle),onClick:t[0]||(t[0]=(...t)=>e.onCornerClick&&e.onCornerClick(...t))},null,4)])}]]);const Se="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABmJLR0QA/wD/AP+gvaeTAAAA7ElEQVQ4je3SvS5EURSG4ccMmXYUQ0hoRoErEXMJ4iaE6GVqYlTojWugEf8/LZdApRLKCcVZh5PJOScTjUjmTb5irb3X2t/eezHkXzGHHTzhI/SIbTSLiio5uSrauMIbVtAIreId19iKvaVU0MUJJkr2TeIURwWmvtnEGWoRj+MAL3jGPuqxVsM5NspOfcVMxKO4xS6mQh3c+LnqbNQ08hquh5uUVjjIMoJLLGdyh1hLg+z9F3Cciedx39fwE3exltLFYp7Dflq4GMDhwFQlb9jBdGhPMjKF41L25T0sSX7zITQW7nq/cTjkj/gC6vIqCPem75wAAAAASUVORK5CYII=",Ae="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABmJLR0QA/wD/AP+gvaeTAAABEUlEQVQ4jdXTu0oDQRiG4ccDBqw8YAIWWkgaBcHeYrG1iQRyARbegdjnAhRLRUEQjHoLIoh4QBRRFCvRWo2Fhb1FJjAGlqSIYF5YZv+Z4eX7d2foJO6RtFM4izfM/XtpgvcwTuAB3+F5xGqYb5luHARBXTqAfsygrNZFGT3NZF2o4BjFKGkjORxhLwRIZQVnyIS6GCWdxwYGw1oGp1hOk+XwgfFQ9+IWO1HSRVyENRhDFSN1SfwNlvCJ3VAXMI0FXOMQm3hFFs/4Qh6juNTQ/xT2ozqPq/B+glKQvuA82lfBZFrbMYUgiklCqqQVQSN9uMGaWktZrONJ+t9vyhC2g6CKLQz7ffjbRmfd/bt2Cv+WH7FAOwOy5F6RAAAAAElFTkSuQmCC",Ce="_sketchRule_1i7jl_1",xe=n({name:"SketchRuler",setup(){const e=a({thick:16,startX:o(0),startY:o(0),lines:a({h:[],v:[]})}),t=O(),l=k(),{editorScale:n}=d(t),r=i((()=>{const e=document.getElementById("editorContainer");return e?{width:e.clientWidth,height:e.clientHeight}:{width:width.value,height:height.value}})),s=i((()=>l.darkTheme?{bgColor:"#18181c",longfgColor:"#4d4d4d",shortfgColor:"#4d4d4d",fontColor:"#4d4d4d",shadowColor:"#18181c",borderColor:"#18181c",cornerActiveColor:"#18181c"}:{bgColor:"#fff",longfgColor:"#cbcbcb",shortfgColor:"#cbcbcb",fontColor:"#ababab",shadowColor:"#fff",borderColor:"#e2e2e2",cornerActiveColor:"blue"}));return{...B(e),editorScale:n,containerRect:r,handleResizeRuler:()=>{var t,l;const o=null==(t=document.querySelector("#screen"))?void 0:t.getBoundingClientRect(),i=null==(l=document.querySelector("#editor"))?void 0:l.getBoundingClientRect(),r=(o.left+e.thick-i.left)/n.value*100,a=(o.top+e.thick-i.top)/n.value*100;e.startX=r,e.startY=a},paletteStyle:s,eyeIcon:Se,closeEyeIcon:Ae}},render(){return r(we,{class:Ce,thick:this.thick,eyeIcon:Se,closeEyeIcon:Ae,scale:this.editorScale/100,width:1014.66,height:795,startX:this.startX,startY:this.startY,lines:this.lines,palette:this.paletteStyle},null)}});const Re=n({name:"Editor",components:{PixelGrid:ce,SketchRuler:xe,AreaSelect:V,ContextMenu:oe},setup(){const e=o(null),t=o(null),l=o(null),n=U(),{areaSelectVisible:r}=d(n),a=["width","height","top","left"],{groupState:s,editorScale:c,...u}=ne(),p=i((()=>({transform:`scale(${c.value/100})`})));return h((()=>{const l=t.value.getBoundingClientRect();e.value.scrollLeft=l.width/2-100,e.value.scrollTop=l.height/2-160})),{...u,screenRef:e,groupState:s,editorStyle:p,contextMenuRef:l,editorContaineRef:t,getPrimitiveStyle:e=>T(e,a),areaSelectVisible:r,handleCloseContextMenu:()=>{var e;null==(e=l.value)||e.close()}}},render(){return r(C,null,[r(xe,{ref:"sketchRulerRef"},null),r("div",{id:"screen",ref:"screenRef",class:ie,onWheel:this.handleMouseWheel,onScroll:this.handleMouseScroll},[r("div",{id:"editorContainer",ref:"editorContaineRef",class:re},[r("div",{id:"editor","data-context":"Editor",class:ae,style:this.editorStyle,onMousedown:this.handleMouseDown,onMouseup:this.handleMouseUp,onContextmenu:this.handleShowContextMenu},[c(r(V,{options:this.groupState},null),[[u,this.areaSelectVisible]]),r(H,null,null),r(oe,{ref:"contextMenuRef"},null),(()=>this.primitives.map(((e,t)=>{let l;return r(ee,{index:t,style:Q(e.style),primitive:e,pStyle:e.style,onCloseContextmenu:this.handleCloseContextMenu},"function"==typeof(o=l=L(y(e.cName),{id:`primitive${e.id}`,class:se,style:this.getPrimitiveStyle(e.style),"data-context":e.cName,dataSource:e}))||"[object Object]"===Object.prototype.toString.call(o)&&!D(o)?l:{default:()=>[l]});var o})))()])])])])}}),Ne="_container_79xjy_1",Ee=n({name:"Container",components:{Editor:Re},setup(){const{...e}=(()=>{const e=O();return{handleDrop:t=>{t.preventDefault(),t.stopPropagation();const l=t.dataTransfer.getData("name"),o=document.querySelector("#editor").getBoundingClientRect(),n=new M[l],i={top:P.ceil(t.clientY-o.y),left:P.ceil(t.clientX-o.x)};n.updateStyle(i),e.addPrimitive(n)},handleDragOver:e=>{e.preventDefault(),e.dataTransfer.dropEffect="copy"},handleMouseDown:e=>{e.stopPropagation()},handleMouseUp:()=>{}}})();return{...e}},render(){return r(C,null,[r("div",{class:Ne,onDrop:this.handleDrop,onDragover:this.handleDragOver,onMousedown:this.handleMouseDown,onMouseup:this.handleMouseUp},[r(Re,null,null)])])}});export{Ee as default};
//# sourceMappingURL=index-109b5be8.js.map
